<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.545">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam Kemberling">
<meta name="dcterms.date" content="2022-08-11">
<meta name="description" content="Differential Growth Rates of Northeast US Fishes Following Temperature Regime Shift">

<title>Size at Age Regimes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="size_at_age_regimes_files/libs/clipboard/clipboard.min.js"></script>
<script src="size_at_age_regimes_files/libs/quarto-html/quarto.js"></script>
<script src="size_at_age_regimes_files/libs/quarto-html/popper.min.js"></script>
<script src="size_at_age_regimes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="size_at_age_regimes_files/libs/quarto-html/anchor.min.js"></script>
<link href="size_at_age_regimes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="size_at_age_regimes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="size_at_age_regimes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="size_at_age_regimes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="size_at_age_regimes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<link href="size_at_age_regimes_files/libs/panelset-0.2.6/panelset.css" rel="stylesheet">
<script src="size_at_age_regimes_files/libs/panelset-0.2.6/panelset.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#growth-regimes-in-the-nw-atlantic-following-temperature-regime-shift" id="toc-growth-regimes-in-the-nw-atlantic-following-temperature-regime-shift" class="nav-link active" data-scroll-target="#growth-regimes-in-the-nw-atlantic-following-temperature-regime-shift">Growth Regimes in the NW Atlantic Following Temperature Regime Shift</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#sea-surface-temperature" id="toc-sea-surface-temperature" class="nav-link" data-scroll-target="#sea-surface-temperature">Sea Surface Temperature</a></li>
  <li><a href="#distribution-shift-analyses" id="toc-distribution-shift-analyses" class="nav-link" data-scroll-target="#distribution-shift-analyses">Distribution Shift Analyses</a></li>
  <li><a href="#size-at-age-analyses" id="toc-size-at-age-analyses" class="nav-link" data-scroll-target="#size-at-age-analyses">Size at Age Analyses</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#temperature-regime-shift-1" id="toc-temperature-regime-shift-1" class="nav-link" data-scroll-target="#temperature-regime-shift-1">Temperature Regime Shift</a></li>
  <li><a href="#distribution-shifts" id="toc-distribution-shifts" class="nav-link" data-scroll-target="#distribution-shifts">Distribution Shifts</a></li>
  <li><a href="#changes-to-growth" id="toc-changes-to-growth" class="nav-link" data-scroll-target="#changes-to-growth">Changes to Growth</a></li>
  <li><a href="#changes-in-l_infty" id="toc-changes-in-l_infty" class="nav-link" data-scroll-target="#changes-in-l_infty">Changes in <span class="math inline">\(L_\infty\)</span></a></li>
  <li><a href="#vb-fits-to-data" id="toc-vb-fits-to-data" class="nav-link" data-scroll-target="#vb-fits-to-data">VB Fits to Data:</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#bonus-data-explorations" id="toc-bonus-data-explorations" class="nav-link" data-scroll-target="#bonus-data-explorations">Bonus: Data Explorations</a>
  <ul class="collapse">
  <li><a href="#age-data-availability" id="toc-age-data-availability" class="nav-link" data-scroll-target="#age-data-availability">Age Data Availability</a></li>
  <li><a href="#growth-increment-changes" id="toc-growth-increment-changes" class="nav-link" data-scroll-target="#growth-increment-changes">Growth Increment Changes</a></li>
  <li><a href="#length-at-age-changes" id="toc-length-at-age-changes" class="nav-link" data-scroll-target="#length-at-age-changes">Length at Age Changes</a></li>
  <li><a href="#weight-at-age-changes" id="toc-weight-at-age-changes" class="nav-link" data-scroll-target="#weight-at-age-changes">Weight at Age Changes</a></li>
  <li><a href="#shifts-in-growth" id="toc-shifts-in-growth" class="nav-link" data-scroll-target="#shifts-in-growth">Shifts in Growth</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Size at Age Regimes</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>

<div>
  <div class="description">
    <p>Differential Growth Rates of Northeast US Fishes Following Temperature Regime Shift</p>
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://github.com/adamkemberling">Adam Kemberling</a> 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Gulf of Maine Research Institute
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 11, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>


<style type="text/css">/********** GMRI Rmarkdown Core Style Sheet - Do Not Modify!!! **********/


/********** Begin Style Sheet **********/

/* Avenir Font from Fonts.com for GMRI Branding */

@import url("http://fast.fonts.net/t/1.css?apiType=css&projectid=806f61f6-d695-4965-a878-820b50bc0269");
    @font-face{
        font-family:"Avenir LT W01_35 Light1475496";
        src:url("Fonts/0078f486-8e52-42c0-ad81-3c8d3d43f48e.woff2") format("woff2"),url("Fonts/908c4810-64db-4b46-bb8e-823eb41f68c0.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_35 Light_1475502";
        src:url("Fonts/a59168c1-917d-4de9-a244-0316c057c357.woff2") format("woff2"),url("Fonts/6dc0e7d8-9284-44e1-8f05-984a41daa3a4.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_45 Book1475508";
        src:url("Fonts/065a6b14-b2cc-446e-9428-271c570df0d9.woff2") format("woff2"),url("Fonts/65d75eb0-2601-4da5-a9a4-9ee67a470a59.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_45 Book O1475514";
        src:url("Fonts/476612d9-282d-4f76-95cd-b4dd31e7ed21.woff2") format("woff2"),url("Fonts/f1ebae2b-5296-4244-8771-5f40e60a564a.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_55 Roman1475520";
        src:url("Fonts/b290e775-e0f9-4980-914b-a4c32a5e3e36.woff2") format("woff2"),url("Fonts/4b978f72-bb48-46c3-909a-2a8cd2f8819c.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_55 Obliqu1475526";
        src:url("Fonts/1a7173fa-062b-49ad-9915-bc57d3bfc1f5.woff2") format("woff2"),url("Fonts/cdda031e-26e9-4269-83d1-5a218caa10db.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_65 Medium1475532";
        src:url("Fonts/17b90ef5-b63f-457b-a981-503bb7afe3c0.woff2") format("woff2"),url("Fonts/c9aeeabd-dd65-491d-b4be-3e0db9ae47a0.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_65 Medium1475538";
        src:url("Fonts/deb5e718-7abb-4df3-9365-edfa95317090.woff2") format("woff2"),url("Fonts/04801919-17ee-4c6b-8b17-eb1965cb3ed6.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_85 Heavy1475544";
        src:url("Fonts/d513e15e-8f35-4129-ad05-481815e52625.woff2") format("woff2"),url("Fonts/61bd362e-7162-46bd-b67e-28f366c4afbe.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_85 Heavy_1475550";
        src:url("Fonts/3c210c80-960f-4684-850b-25390b4d08af.woff2") format("woff2"),url("Fonts/cb5c71ad-e582-4d00-929c-67fbfaeb1c27.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_95 Black1475556";
        src:url("Fonts/c78eb7af-a1c8-4892-974b-52379646fef4.woff2") format("woff2"),url("Fonts/75b36c58-2a02-4057-a537-09af0832ae46.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_95 Black_1475562";
        src:url("Fonts/a2477e08-09d9-4d4b-97a9-23a1e22cb44c.woff2") format("woff2"),url("Fonts/19d12bba-92b1-43ad-9bab-cd36a4195c2a.woff") format("woff");
    }





/* PRE-Avenir Fonts: Lato + Raleway font import from google fonts */
@import url('https://fonts.googleapis.com/css?family=Lato');
@import url('https://fonts.googleapis.com/css?family=Raleway&display=swap');

/* add font families as needed: font-family: 'Lato', sans-serif; */


/* Level 1 Headers */
h1 { text-align: left;
     margin: 10px 0 15px 0; 
     font-size: 38px; 
     font-family: Avenir;
} 


/* Headers 2 - 6 */
h2, h3, h4, h5, h6 { 
    color: #333333; 
    margin: 20px 0 5px 0; 
    text-align: left;
    font-family: Avenir;}


/* Sizing/font For Each Header Type */
h2 { font-size: 24px; }
h3 { font-size: 20px; }
h4 { font-size: 18px; }
h5 { font-size: 16px; font-weight: normal; color: #3069aa; text-decoration: underline;}
h6 { font-size: 14px; font-weight: normal; color: #3069aa; }


/* Paragraph Text */
p, ol { margin-top: 10px; 
    font-family: 'Raleway', sans-serif;}


/* Title Author and Date Headers */
h1.title.toc-ignore {margin-top: 10px;}
h4.author, h4.date {
    color: rgb(0,115,109);
    margin-top: 0px; 
    margin-bottom: 5px; 
    font-size: 12px;}



/* Add Spacing Above Headers */
h1, .h1, h2, .h2, h3, .h3 {
    margin-top: 40px;
}


/* Links */
a {
    color: rgb(234,79,18)
}


/***********************************************/


/********  Table of Contents  **********/

/* Highlighted TOC Element */
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    z-index: 2;
    color: #fff;
    background-color: rgb(0,96,138);
    border-color: rgb(0,96,138);
}

/* Default TOC Elements */
.list-group-item, .list-group-item:focus, .list-group-item:hover {
    z-index: 2;
    color: rgb(0,96,138);
    background-color: #fff;
    border-color: rgb(0,96,138);
}


/********  Tab Panels  **********/

/* Navigation Tabs - Highlighted Tabset Pills */
.nav-pills > li.active > a, .nav-pills > li.active > a:hover, .nav-pills > li.active > a:focus {
    color: #fff;
    background-color: rgb(0,115,109) ;
    }

/* Navigation Tabs - Default Tabset Pills */
.nav-pills > li > a, .nav-pills > li > a:hover, .nav-pills > li > a:focus {
    color: rgb(0,115,109);
    background-color: #fff;
    }


/* Second Level Tabs - Active */
.nav.nav-tabs > li.active  > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {
    color: #fff;
    background-color: rgb(83,83,83) ;
    }

/* Second Level Tabs - Inactive */
.nav.nav-tabs > li  > a, .nav-tabs > li > a:hover, .nav-tabs > li > a:focus {
    color: rgb(83,83,83);
    background-color: #fff;
    }



/********** End Core Style Sheet **********/
/********** End Core Style Sheet **********/



</style>
<section id="growth-regimes-in-the-nw-atlantic-following-temperature-regime-shift" class="level1">
<h1>Growth Regimes in the NW Atlantic Following Temperature Regime Shift</h1>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<section id="literature-on-tsr-and-growth-expectations" class="level3">
<h3 class="anchored" data-anchor-id="literature-on-tsr-and-growth-expectations">Literature on TSR and Growth Expectations</h3>
</section>
<section id="introduce-study-area-and-existing-research" class="level3">
<h3 class="anchored" data-anchor-id="introduce-study-area-and-existing-research">Introduce Study Area and Existing Research</h3>
<p>Recent changes in Gulf stream positioning have altered the relative influences of the Gulf stream and Labrador current on temperature and salinity regimes for the region. Understanding that this new temperature and salinity regime should alter both the energetics of the region, as well as food-web dynamics. We seek to identify whether these changes have had a measurable impact on the growth of several groundfish species.</p>
<p>Despite many of these species living at or near the bottom, research suggests that the forces driving these thermal regimes should have far-reaching impacts biological impacts. These impacts may directly change the near-bottom environment through mixing patterns, and/or indirectly through food-web impacts.</p>
<p>Through the lens of an environmental regime change we will assess changes to body size, size-at-age, and growth characteristics derived using the von-bertalanffy growth equation.</p>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="sea-surface-temperature" class="level2">
<h2 class="anchored" data-anchor-id="sea-surface-temperature">Sea Surface Temperature</h2>
<p>Global Sea surface temperature data was obtained via NOAA’s optimally interpolated SST analysis, providing daily temperature values at a 0.25° latitude x 0.25° longitude resolution (Reynolds et al.&nbsp;2007). A daily climatology for every 0.25° pixel in the global data set was created using average daily temperatures spanning the period of 1982-2011. Daily anomalies were then computed as the difference between observed temperatures and the daily climatological average. OISSTv2 data used in these analyses were provided by the NOAA PSL, Boulder, Colorado, USA from their website at https://psl.noaa.gov.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the regional temperatures from {targets}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(regional_oisst))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get regional averages</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>temp_regimes <span class="ot">&lt;-</span> regional_oisst <span class="sc">%&gt;%</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yr <span class="sc">&gt;</span> <span class="dv">1981</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">regime =</span> <span class="fu">ifelse</span>(yr <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"1982-2009 Average"</span>, <span class="st">"2010-2021 Average"</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey_area =</span> <span class="fu">ifelse</span>(survey_area <span class="sc">==</span> <span class="st">"all"</span>, <span class="st">"Full Region"</span>, survey_area),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey_area =</span> <span class="fu">factor</span>(survey_area, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Full Region"</span>, <span class="st">"GoM"</span>, <span class="st">"GB"</span>, <span class="st">"SNE"</span>, <span class="st">"MAB"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(survey_area, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_temp_c =</span> <span class="fu">round</span>(<span class="fu">mean</span>(sst), <span class="dv">2</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_label =</span> <span class="fu">str_c</span>(avg_temp_c, <span class="st">"\u00b0C"</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_anom_c =</span> <span class="fu">mean</span>(sst_anom),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_anom_c = ifelse(regime == "1982-2009 Regime", 0, avg_anom_c),</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>, <span class="fl">1981.5</span>, <span class="fl">2009.5</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>, <span class="fl">2009.5</span>, <span class="fl">2021.5</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="temperature-study-region" class="level3">
<h3 class="anchored" data-anchor-id="temperature-study-region">Temperature Study Region</h3>
<p>Temperature data was regionally averaged to match the sampling area for the fisheries independent survey program providing the age-at-length data. SST anomalies were averaged over the entire sampling region, consisting of continental shelf habitats from Cape Hatteras to Nova Scotia, to produce a daily time series. This time series was then processed into an annual timeseries of surface temperatures and anomalies. All area-averaging was done with area-weighting to account for differences in the relative areas of the latitude/longitude grid of the OISSTv2 data.</p>
</section>
<section id="temperature-regime-shift" class="level3">
<h3 class="anchored" data-anchor-id="temperature-regime-shift">Temperature Regime Shift</h3>
<p><strong>Text about identifying the regime shift</strong></p>
</section>
<section id="warming-trends" class="level3">
<h3 class="anchored" data-anchor-id="warming-trends">Warming Trends</h3>
<p>We computed the linear trend (<span class="math inline">\(°C/Decade\)</span>) in the daily Gulf of Maine SST time series using standard linear regression. We considered the full time period (1982-2009) and the last decade (2010-2019), estimating warming rates and long-term averages independently for each period.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># warming trends</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1982-2019"</span> <span class="ot">=</span> <span class="fu">filter</span>(temp_regimes, <span class="fu">between</span>(yr, <span class="dv">1982</span>, <span class="dv">2009</span>)),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2010-2019"</span> <span class="ot">=</span> <span class="fu">filter</span>(temp_regimes, <span class="fu">between</span>(yr, <span class="dv">2010</span>, <span class="dv">2019</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(.x){</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    mod_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(sst <span class="sc">~</span> yr, <span class="at">data =</span> .x)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    rate <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod_x)[[<span class="st">"yr"</span>]] <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    rate_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Decadal Rate"</span> <span class="ot">=</span> <span class="fu">round</span>(rate, <span class="dv">2</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(rate_df)}, <span class="at">.id =</span> <span class="st">"Period"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">Period</th>
<th style="text-align: right;">Decadal Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1982-2019</td>
<td style="text-align: right;">0.07</td>
</tr>
<tr class="even">
<td style="text-align: left;">2010-2019</td>
<td style="text-align: right;">-0.02</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Temperatures prior to the 2010 regime shift rose at a rate of 0.7 <span class="math inline">\(°C/Decade\)</span>. Regional temperatures then peaked in 2012 and have remained high while decreasing slowly at a rate of 0.02 <span class="math inline">\(°C/Decade\)</span>.</p>
</section>
</section>
<section id="distribution-shift-analyses" class="level2">
<h2 class="anchored" data-anchor-id="distribution-shift-analyses">Distribution Shift Analyses</h2>
<p>Fishery Independent data on groundfish size-at-age was collected as part of the NEFSC’s northeast trawl survey. This survey is conducted each year in the Spring and in the fall, with sample locations determined following a stratified-random survey design with effort allocated in proportion to stratum area. <strong>Add an Explanation of the Strata we Exclude</strong>. Correction factors were applied for changes in vessels, gear, and doors when appropriate. Prior to sampling, a CTD cast is performed to collect environmental conditions for the water column at/near the start of the trawl sample providing information on bottom habitat conditions like bottom temperatures. Distribution shift analyses were limited to data from the Spring survey season. Previous work has shown no significant changes in timing of sampling, or the mean annual latitude and longitude of the Spring survey sampling (Nye et al.&nbsp;2009).</p>
<p><strong>What do we calculate and for how many species?</strong></p>
<p>Our analyses followed the continued movements of 30 species consistent with Nye et al.&nbsp;2009. These species were originally selected for being consistently sampled across all years, and as representatives of a wide range of taxonomic groups.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the tidy survdat Data with {targets}</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(survdat_clean))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to Just spring?</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>dist_dat <span class="ot">&lt;-</span> survdat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"Spring"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Just the Species, or as Stocks?</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>nye_species <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"spiny dogfish"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"little skate"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"thorny skate"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"winter skate"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"alewife"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"american shad"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic herring"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic cod"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"haddock"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pollock"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"silver hake"</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"red hake"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"spotted hake"</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"white hake"</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cusk"</span>,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"goosefish"</span>,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"american plaice"</span>,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic halibut"</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"yellowtail flounder"</span>,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"winter flounder"</span>,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fourspot flounder"</span>,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"summer flounder"</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"windowpane"</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic mackerel"</span>,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ocean pout"</span>,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic wolffish"</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"blackbelly rosefish"</span>,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"longhorn sculpin"</span>,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sea raven"</span>,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"acadian redfish"</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to those species</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>dist_dat <span class="ot">&lt;-</span> dist_dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(comname <span class="sc">%in%</span> nye_species)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the total biomass at each station</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Totals up the abundance and biomass across sex*</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>station_totals <span class="ot">&lt;-</span> dist_dat <span class="sc">%&gt;%</span> </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(est_year, survey_area, stratum, tow, est_towdate, avgdepth, bottemp, decdeg_beglat, decdeg_beglon, comname) <span class="sc">%&gt;%</span> </span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">biomass_kg =</span> <span class="fu">sum</span>(biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="calculating-spatial-metrics" class="level3">
<h3 class="anchored" data-anchor-id="calculating-spatial-metrics">Calculating Spatial Metrics</h3>
<p>Movements through time were characterized for each species using the following metrics: center of biomass, area-occupied, mean depth of occurrence, and the mean temperature of occurrence. Each metric was weighted by the biomass of a species sampled at each station such that.</p>
<p><span class="math display">\[X_j = \frac{ \sum_{}^{}  w_iX_{ij}  }{  \sum~w_i  }\]</span></p>
<p>Where <span class="math inline">\(X\)</span> is the spatial metric, <span class="math inline">\(j\)</span> is the year, &amp; <span class="math inline">\(w\)</span> is the biomass (in kg) for each station <span class="math inline">\(i\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to run the group weighted means on different groups using ...</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Does all variables: depth, temp, lat, lon &amp; their variance (sd)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>group_spat_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(station_totals, ...){</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  station_totals <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(comname, ...) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_biomass   =</span> <span class="fu">sum</span>(biomass_kg),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_biomass     =</span> <span class="fu">mean</span>(biomass_kg),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">biomass_sd      =</span> <span class="fu">sd</span>(biomass_kg),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_depth       =</span> <span class="fu">weightedMean</span>(avgdepth, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_temp        =</span> <span class="fu">weightedMean</span>(bottemp, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_lat         =</span> <span class="fu">weightedMean</span>(decdeg_beglat, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_lon         =</span> <span class="fu">weightedMean</span>(decdeg_beglon, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">depth_sd        =</span> <span class="fu">weightedSd</span>(avgdepth, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">temp_sd         =</span> <span class="fu">weightedSd</span>(bottemp, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">lat_sd          =</span> <span class="fu">weightedSd</span>(decdeg_beglat, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">lon_sd          =</span> <span class="fu">weightedSd</span>(decdeg_beglon, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate weighted mean &amp; median across biomass variables</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># returns a common format that can join easily to global benchmarks</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>biomass_weighted_var <span class="ot">&lt;-</span> <span class="cf">function</span>(station_totals, var_col, ...){</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  var_lab <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(var_col))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  mean_df <span class="ot">&lt;-</span> station_totals <span class="sc">%&gt;%</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(comname, ...) <span class="sc">%&gt;%</span> </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">biom_median  =</span> <span class="fu">weightedMedian</span>({{var_col}}, biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">biom_mu      =</span> <span class="fu">weightedMean</span>({{var_col}},   biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">biom_sd      =</span> <span class="fu">weightedSd</span>({{var_col}}, biomass_kg, <span class="at">na.rm =</span> T), </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var =</span> var_lab)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mean_df)</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Yearly Spatial Metrics</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>year_avgs <span class="ot">&lt;-</span> <span class="fu">group_spat_metrics</span>(station_totals, est_year) </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Average Metrics Across Temperature Regimes</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>regime_avgs <span class="ot">&lt;-</span> station_totals <span class="sc">%&gt;%</span> </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(est_year <span class="sc">&gt;=</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_regime =</span> <span class="fu">ifelse</span>(est_year <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"Early Regime"</span>, <span class="st">"Warm Regime"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_spat_metrics</span>(., temp_regime) </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance across all years within each species</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>global_benchmarks <span class="ot">&lt;-</span> <span class="fu">group_spat_metrics</span>(station_totals) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="analysis-of-spatial-metrics" class="level3">
<h3 class="anchored" data-anchor-id="analysis-of-spatial-metrics">Analysis of Spatial Metrics</h3>
</section>
</section>
<section id="size-at-age-analyses" class="level2">
<h2 class="anchored" data-anchor-id="size-at-age-analyses">Size at Age Analyses</h2>
<p>The available age data is a subset of the overall catch data, which contains additional information on individual fishes such as otolith-derived aging that require additional workup to ascertain. Not all fish species have age available for the full time period, with special attention being given to aid in the management of commercially valuable species.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access Biological Data with {targets}</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(survdat_biological))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Prepare Bio Data for Age analysis for regimes:</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NA age data, restrict to summer and fall</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>nmfs_bio <span class="ot">&lt;-</span> survdat_biological <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(age) <span class="sc">==</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>         season <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Spring"</span>, <span class="st">"Fall"</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Add regime and decade labels</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>nmfs_bio <span class="ot">&lt;-</span> nmfs_bio <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearclass =</span> est_year <span class="sc">-</span> (age<span class="dv">-1</span>),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">regime =</span> <span class="fu">ifelse</span>(est_year <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"Early Regime"</span>, <span class="st">"Warm Regime"</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">decade =</span> <span class="fu">floor_decade</span>(est_year)) </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(survdat_biological)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="do">####  Growth Data Prep  #### </span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to just the data for the two regimes</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>regime_dat <span class="ot">&lt;-</span> <span class="fu">filter</span>(nmfs_bio, est_year <span class="sc">&gt;=</span> <span class="dv">2000</span>, est_year <span class="sc">&lt;=</span> <span class="dv">2019</span>)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank species by how many measurements there are</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>species_abunds <span class="ot">&lt;-</span> regime_dat <span class="sc">%&gt;%</span> </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(comname) <span class="sc">%&gt;%</span> </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="co"># ordered by number measured</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reorder alphabetically And take</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># vonbert_species &lt;- sort(species_abunds$comname[1:17])</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the ones that don't work</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>vonbert_species <span class="ot">&lt;-</span> species_abunds <span class="sc">%&gt;%</span> </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(comname <span class="sc">%not in%</span> <span class="fu">c</span>(<span class="st">"goosefish"</span>, <span class="st">"fourspot flounder"</span>, <span class="st">"cusk"</span>, <span class="st">"ocean pout"</span>, <span class="st">"bluefish"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(comname) <span class="sc">%&gt;%</span> </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(comname)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Size at age analyses were performed on 18 species. Species were omitted from analyses if age data was not available across both temperature regimes (bluefish &amp; ocean pout) or if their physiology prevented accurate aging (elasmobranch species). The following 18 species had sufficient age data across both temperature regimes to be included in the analysis: <strong><em>acadian redfish</em>, <em>american plaice</em>, <em>atlantic cod</em>, <em>atlantic herring</em>, <em>atlantic mackerel</em>, <em>black sea bass</em>, <em>butterfish</em>, <em>haddock</em>, <em>pollock</em>, <em>red hake</em>, <em>scup</em>, <em>silver hake</em>, <em>summer flounder</em>, <em>white hake</em>, <em>windowpane</em>, <em>winter flounder</em>, <em>witch flounder</em> and <em>yellowtail flounder</em></strong>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Name the list so it carries through</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vonbert_species) <span class="ot">&lt;-</span> vonbert_species</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="do">##### Reorganize species data into the list, and make group id for later</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>vonbert_species_agedat <span class="ot">&lt;-</span>  <span class="fu">map_dfr</span>(vonbert_species, <span class="cf">function</span>(species_name){</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to the vonbert species</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  regime_dat <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> species_name) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group_id =</span> <span class="fu">str_c</span>(regime, comname, <span class="at">sep =</span> <span class="st">"-"</span>)) </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}, <span class="at">.id =</span> <span class="st">"common name"</span>) </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Species we want panels for:</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>key_species <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"american plaice"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic cod"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic herring"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"butterfish"</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"haddock"</span>, </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pollock"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scup"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"silver hake"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"summer flounder"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"winter flounder"</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"yellowtail flounder"</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="growth-by-temperature-regime" class="level3">
<h3 class="anchored" data-anchor-id="growth-by-temperature-regime">Growth by Temperature Regime</h3>
<p>To assess the impact of an elevated temperature regime, the size-at-age data was grouped into decadal periods relating to the shift in surface temperature regimes (2000-2009 &amp; 2010-2019). Growth in fishes is commonly modeled using the “Von-Bertalanffy” growth function (VBGF) to capture how a fishes size (length or weight) changes with age. For each species the growth was modeled by fitting the VGBF to the length distribution-at-age.</p>
<p><span class="math display">\[L_t~=~L_{\infty}(1-e^{-K(t-t_0)})\]</span></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the function for nls() to solve</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>vb <span class="ot">&lt;-</span> <span class="fu">vbFuns</span>(<span class="at">param=</span><span class="st">"Typical"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Single Species Example</strong></p>
<div class="cell">

</div>
<p><strong>Model Output Collector</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to Pull Vonbert Coefficients, </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># In development: boot strapped intervals</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>vonbert_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(length_age_dat, start_points, <span class="at">min_obs =</span> <span class="dv">20</span>){</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">####  Von Bert Fitting Using: {FSA}  ####</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Don't run on fewer than a minimum number of observations</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  num_aged <span class="ot">&lt;-</span> <span class="fu">nrow</span>(length_age_dat)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If number aged less than the minimum observations:</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fill output with NA's, but preserve structure to build table</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_aged <span class="sc">&lt;</span> min_obs){</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataframe structure for coefficients</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    na_coef_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Linf"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"K"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"t0"</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataframe structure for parameters</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    na_param_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>      <span class="st">"parameter"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">"estimate"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">"std_error"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"t_value"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pr_t"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"converged"</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># What to return when it fails/aborts:</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"model"</span>  <span class="ot">=</span> <span class="cn">NA</span>, </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">"coef"</span>   <span class="ot">=</span> na_df, </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">"params"</span> <span class="ot">=</span> na_param_df))</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># Close conditional for sample size</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="do">####  Fitting Model When Sample Size is Sufficient  ####</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use nls to estimate VBGF parameters using starting points</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  vbert_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(length_cm <span class="sc">~</span> <span class="fu">vb</span>(age, Linf, K, t0),</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> length_age_dat,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> start_points)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Access parameters with coef()</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  vbert_coef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">coef</span>(vbert_fit)))</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get Summary Info (For convergence and std. error)</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  vbert_summ <span class="ot">&lt;-</span> <span class="fu">summary</span>(vbert_fit)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convergence Info</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  vbert_conv <span class="ot">&lt;-</span> vbert_summ<span class="sc">$</span>convInfo<span class="sc">$</span>isConv</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parameters w/ Standard Error</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  vbert_params <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(vbert_summ<span class="sc">$</span>parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add convergence information in</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>  vbert_params<span class="sc">$</span>converged <span class="ot">&lt;-</span> vbert_conv</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  <span class="do">####  Work in Progress / Debugging  ####</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This section fails, can't find namespace/object "length_age_dat"</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Use bootstrapping for confidence intervals:</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vbert_boot &lt;- Boot(vbert_fit)  # Be patient! Be aware of some non-convergence</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vbert_conf &lt;- confint(vbert_boot)</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output list</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  out_l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">"model"</span> <span class="ot">=</span> vbert_fit,</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coef"</span>  <span class="ot">=</span> vbert_coef,</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">"params"</span> <span class="ot">=</span> vbert_params<span class="co">#,</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"conf"  = vbert_conf</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the list</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out_l)</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Wrapper for estimation function</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Second Function for running that for a single Species, split by a factor column</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Function does these things:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. grab data for one species</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Get starting points for VB using all data on that species</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fit Vonbert to  both Regimes</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>process_group_vbert <span class="ot">&lt;-</span> <span class="cf">function</span>(spec_name, split_col, min_obs){</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the data using the species</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  spec_dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(vonbert_species_agedat, comname <span class="sc">==</span> spec_name)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get starting points from all data</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  test_starts <span class="ot">&lt;-</span>  <span class="fu">vbStarts</span>(length_cm <span class="sc">~</span> age, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> spec_dat)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get coefficients for groups</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  spec_dat <span class="sc">%&gt;%</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(.[split_col]) <span class="sc">%&gt;%</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="at">.f =</span> vonbert_coef,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">start_points =</span> test_starts, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_obs =</span> min_obs) <span class="sc">%&gt;%</span> </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># map_dfr(pluck, "coef", .id = split_col) %&gt;%  # Pull  out just the coefficients</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(pluck, <span class="st">"params"</span>, <span class="at">.id =</span> split_col) <span class="sc">%&gt;%</span>  <span class="co"># Pull out the parameters and stderr</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comname =</span> spec_name)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Processing Coeficients</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running Each Species * Regime</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>species_coef <span class="ot">&lt;-</span> vonbert_species <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process_group_vbert</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">spec_name =</span> x, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">split_col =</span>  <span class="st">"regime"</span>, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_obs =</span> <span class="dv">30</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="growth-impacts-on-productivity" class="level3">
<h3 class="anchored" data-anchor-id="growth-impacts-on-productivity">Growth Impacts on Productivity</h3>
<p>Yield-per-recruit analysis similar to Baudron et al.&nbsp;2014?</p>
</section>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="temperature-regime-shift-1" class="level2">
<h2 class="anchored" data-anchor-id="temperature-regime-shift-1">Temperature Regime Shift</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull the whole area's temps</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>survey_temps <span class="ot">&lt;-</span> <span class="fu">filter</span>(temp_regimes, survey_area <span class="sc">==</span> <span class="st">"Full Region"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull the regime averages out</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>regime_avgs <span class="ot">&lt;-</span> survey_temps <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(regime, avg_temp_c, avg_anom_c, temp_label) </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the regime averages separately for in text values</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>regime_1 <span class="ot">&lt;-</span> regime_avgs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>regime_2 <span class="ot">&lt;-</span> regime_avgs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(regime <span class="sc">==</span> <span class="st">"2010-2021 Average"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions developed in 10_change_points.R</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bcp)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co"># run bcp and flag changepoints using threshold</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>flag_bcp <span class="ot">&lt;-</span> <span class="cf">function</span>(response_var,  </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">predictor_var =</span> <span class="cn">NULL</span>, </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                     id_var, </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">burnin =</span> <span class="dv">10000</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mcmc =</span> <span class="dv">10000</span>, </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">return.mcmc =</span> T, </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">threshold_prob =</span> <span class="fl">0.3</span>){</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use bcp to find support for change points</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  bcp_x <span class="ot">&lt;-</span> <span class="fu">bcp</span>(<span class="at">y =</span> response_var, </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> predictor_var, </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">burnin =</span> burnin, </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">mcmc =</span> mcmc, </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">return.mcmc =</span> return.mcmc)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sink</span>(<span class="st">"/dev/null"</span>)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert summary to a dataframe</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  bcp_sum <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(bcp_x))</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sink</span>()</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Label the id variable</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  bcp_sum<span class="sc">$</span>id <span class="ot">&lt;-</span> id_var</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Only pull records with support above desired threshold</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  flag_dat <span class="ot">&lt;-</span> bcp_sum[<span class="fu">which</span>(bcp_x<span class="sc">$</span>posterior.prob <span class="sc">&gt;</span> threshold_prob), ]</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>  flag_dat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(flag_dat)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(flag_dat)</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3905</span>)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform BCP regions temp breakpoints</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>anom_bcp <span class="ot">&lt;-</span> <span class="fu">flag_bcp</span>(<span class="at">response_var =</span> survey_temps<span class="sc">$</span>sst_anom, </span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>                     <span class="at">id_var =</span> survey_temps<span class="sc">$</span>yr, </span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>                     <span class="at">threshold_prob =</span> <span class="fl">0.3</span>)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a><span class="co"># in-text values</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>prob_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">round</span>(anom_bcp<span class="sc">$</span>Probability <span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="at">collapse =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>SST anomaly time series of the region indicate a jump in annual temperature anomalies indicative of a regime shift centered around 2010. A bayesian change point analysis showed highest support for a regime shift among 3 the years: 2009-2011. Change point probabilities for these years were 33.66, 32.51, 32.49% respectively.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot bcp breaks, highlighting their support</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plot_bcp_breaks <span class="ot">&lt;-</span> <span class="cf">function</span>(bcp_data, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                            bcp_breaks, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                            region_label, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y_label =</span> <span class="st">"sizeSpectra Exponent (b)"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y_col =</span> <span class="st">"b"</span>){</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set label elevation</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  label_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">as.data.frame</span>(bcp_data)[, y_col], <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot with breakpoint</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(bcp_data, <span class="fu">aes_string</span>(<span class="st">"yr"</span>, y_col)) <span class="sc">+</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">data =</span> bcp_breaks, <span class="fu">aes</span>(<span class="at">xintercept =</span> id), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> bcp_breaks, </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">aes</span>(<span class="at">x =</span> id, <span class="at">y =</span> label_y, <span class="at">label =</span> <span class="fu">str_c</span>(<span class="fu">round</span>(Probability, <span class="dv">2</span>), <span class="st">"%"</span>))) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> y_label, </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="fu">str_c</span>(region_label, <span class="st">" - Bayesian Change Points"</span>))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the bcp breaks for the Sea surface temperature anomalies</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bcp_breaks</span>(<span class="at">bcp_data =</span> survey_temps, </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">bcp_breaks =</span> anom_bcp, </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">y_label =</span> <span class="st">"Temperature Anomalies"</span>, </span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">region_label =</span> <span class="st">"Northeastern US Continental Shelf"</span>, </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">y_col =</span> <span class="st">"sst_anom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Average temperatures following a break in 2010, during the period of 2010-2021, were on average 1.09°C warmer than the than the average over the previous 28 years from 1982-2009. Temperatures within each regime were relatively stable, indicative of a jump in mean temperatures rather than rate change between them.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot how each one exhibits a break in the temperature across the region</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>temp_regimes <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(survey_area <span class="sc">==</span> <span class="st">"Full Region"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(yr, sst_anom)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> regime),  <span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using geomtextpath for label</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textpath</span>(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> yr, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> avg_anom_c, </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> temp_label, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">linecolor =</span> regime,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">colour =</span> regime), </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">4</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line segments for the regime averages:</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> xend,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> avg_anom_c, </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> avg_anom_c,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> regime),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#key_glyph = "rect",</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">8</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>))) <span class="sc">+</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">suffix =</span> <span class="st">" \u00b0C"</span>)) <span class="sc">+</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>() <span class="sc">+</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"transparent"</span>)) <span class="sc">+</span> </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Northwest-Atlantic Temperature Regime Shift"</span>,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Surface Temperature Anomaly"</span>,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Anomalies calculated using 1982-2011 reference period."</span>) <span class="sc">+</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">label =</span> <span class="st">"none"</span>,</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>), ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/temp%20regimes-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="distribution-shifts" class="level2">
<h2 class="anchored" data-anchor-id="distribution-shifts">Distribution Shifts</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the values for each of them in a standardized format</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize to global benchmarks</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Latitude</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>lat_yrly <span class="ot">&lt;-</span> <span class="fu">biomass_weighted_var</span>(station_totals, decdeg_beglat, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(global_benchmarks, <span class="fu">c</span>(<span class="st">"comname"</span>, <span class="st">"avg_lat"</span>, <span class="st">"lat_sd"</span>)), <span class="at">by =</span> <span class="st">"comname"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biom_z =</span> (biom_mu <span class="sc">-</span> avg_lat) <span class="sc">/</span> lat_sd) </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>lon_yrly <span class="ot">&lt;-</span> <span class="fu">biomass_weighted_var</span>(station_totals, decdeg_beglon, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(global_benchmarks, <span class="fu">c</span>(<span class="st">"comname"</span>, <span class="st">"avg_lon"</span>, <span class="st">"lon_sd"</span>)), <span class="at">by =</span> <span class="st">"comname"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biom_z =</span> (biom_mu <span class="sc">-</span> avg_lon) <span class="sc">/</span> lon_sd) </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom Temperature</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>t_yrly <span class="ot">&lt;-</span> <span class="fu">biomass_weighted_var</span>(station_totals, bottemp, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(global_benchmarks, <span class="fu">c</span>(<span class="st">"comname"</span>, <span class="st">"avg_temp"</span>, <span class="st">"temp_sd"</span>)), <span class="at">by =</span> <span class="st">"comname"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biom_z =</span> (biom_mu <span class="sc">-</span> avg_temp) <span class="sc">/</span> temp_sd) </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Depth</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>d_yrly <span class="ot">&lt;-</span> <span class="fu">biomass_weighted_var</span>(station_totals, avgdepth, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(global_benchmarks, <span class="fu">c</span>(<span class="st">"comname"</span>, <span class="st">"avg_depth"</span>, <span class="st">"depth_sd"</span>)), <span class="at">by =</span> <span class="st">"comname"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biom_z =</span> (biom_mu <span class="sc">-</span> avg_depth) <span class="sc">/</span> depth_sd) </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Put them together in one table for heatmap</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>standardized_changes <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Latitude"</span> <span class="ot">=</span> lat_yrly,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Longitude"</span> <span class="ot">=</span> lon_yrly,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bottom Temperature"</span> <span class="ot">=</span> t_yrly,</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Depth"</span> <span class="ot">=</span> d_yrly) <span class="sc">%&gt;%</span> </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){<span class="fu">select</span>(x, comname, est_year, var, biom_z)}, <span class="at">.id =</span> <span class="st">"var_neat"</span>)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Organize them by their global average latitude</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>global_benchmarks <span class="ot">&lt;-</span> global_benchmarks <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">comname =</span> <span class="fu">fct_reorder</span>(<span class="at">.f =</span> comname, <span class="at">.x =</span> avg_lat, <span class="at">.fun =</span> median))</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Relevel the standardized changes</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>standardized_changes <span class="ot">&lt;-</span> standardized_changes <span class="sc">%&gt;%</span> </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comname =</span> <span class="fu">factor</span>(comname, </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">levels</span>(global_benchmarks<span class="sc">$</span>comname)))</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>standardized_changes <span class="sc">%&gt;%</span> </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, comname, <span class="at">fill =</span> biom_z)) <span class="sc">+</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>var_neat, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"fixed"</span>) <span class="sc">+</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>                       <span class="at">oob =</span> scales<span class="sc">::</span>oob_squish,</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>), </span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="sc">-</span>.<span class="dv">75</span>, <span class="dv">0</span>, .<span class="dv">75</span>, <span class="fl">1.5</span>),</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span><span class="fu">c</span>(<span class="st">"&lt;-1.5"</span>, <span class="st">"-.75"</span>, <span class="st">"0"</span>, <span class="st">".75"</span>, <span class="st">"&gt;1.5"</span>)) <span class="sc">+</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Center of Biomass Movements Through Time"</span>,</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Center of Biomass Metric Change (z)"</span>,</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Species ordered based on center of biomass latitude across all years."</span>) <span class="sc">+</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">"top"</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>, <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">6</span>, <span class="st">"cm"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<section id="center-of-biomass-trends" class="level3">
<h3 class="anchored" data-anchor-id="center-of-biomass-trends">Center of Biomass Trends</h3>
</section>
<div class="{panel-tabset}">
<section id="latitude" class="level3">
<h3 class="anchored" data-anchor-id="latitude">Latitude</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized Plots</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>lat_yrly <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, biom_z, <span class="at">group =</span> comname)) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(aes(group = comname), linetype = 1, color = "gray50", size = 0.5, alpha = 0.2) +</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"Overall Average"</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Center of Biomass Latitudes"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly averages weighted by biomass, scaled against all-year average."</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Center of Biomass Latitude (z)"</span>,  </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span>, </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Time Period"</span>) <span class="sc">+</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="longitude" class="level3">
<h3 class="anchored" data-anchor-id="longitude">Longitude</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>lon_yrly <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, biom_z, <span class="at">group =</span> comname)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(aes(group = comname), linetype = 1, color = "gray50", size = 0.5, alpha = 0.2) +</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"Overall Average"</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_flip() +</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Center of Biomass Longtitudes"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly averages weighted by biomass, scaled against all-year average."</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Center of Biomass Longitude (z)"</span>,  </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span>, </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Time Period"</span>) <span class="sc">+</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="mean-temperature" class="level3">
<h3 class="anchored" data-anchor-id="mean-temperature">Mean Temperature</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>t_yrly <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, biom_z, <span class="at">group =</span> comname)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(aes(group = comname), linetype = 1, color = "gray50", size = 0.5, alpha = 0.2) +</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"Overall Average"</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_flip() +</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Center of Biomass Temperature"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly averages weighted by biomass, scaled against all-year average."</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Center of Biomass Bottom Temperature (z)"</span>,  </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span>, </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Time Period"</span>) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="mean-depth" class="level3">
<h3 class="anchored" data-anchor-id="mean-depth">Mean Depth</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Depth</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>d_yrly <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, biom_z, <span class="at">group =</span> comname)) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(aes(group = comname), linetype = 1, color = "gray50", size = 0.5, alpha = 0.2) +</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"Overall Average"</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_flip() +</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Center of Biomass Depth"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly averages weighted by biomass, scaled against all-year average."</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Center of Biomass Depth (z)"</span>,  </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span>, </span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Time Period"</span>) <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</div>
</section>
<section id="changes-to-growth" class="level2">
<h2 class="anchored" data-anchor-id="changes-to-growth">Changes to Growth</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the first part from the previous plot:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># takes each species</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for age 0 - max_age, solve what the size would be based on vb fit</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>regime_curve_prep <span class="ot">&lt;-</span> <span class="cf">function</span>(spec_name){</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The raw size/age data:</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  t_dat <span class="ot">&lt;-</span> vonbert_species_agedat <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name)  </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The group coefficients, augmented with x values across a range</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  age_max <span class="ot">&lt;-</span> <span class="fu">max</span>(t_dat<span class="sc">$</span>age)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> age_max, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(comname, regime, parameter, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="st">"estimate"</span>, <span class="at">names_from =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name) <span class="sc">%&gt;%</span> </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Make a dataframe that covers the size range for the species</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">regime =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime), <span class="fu">length</span>(x_range)),</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> <span class="fu">rep</span>(x_range, <span class="fu">length</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime)))),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"regime"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the length at age</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_length =</span> Linf <span class="sc">*</span> (<span class="dv">1</span>  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> K <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot wider?</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Take the size at age from each regime and get the difference</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> t_coef <span class="sc">%&gt;%</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Linf, K, t0)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"regime"</span>, <span class="at">values_from =</span> <span class="st">"pred_length"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_shift =</span> <span class="st">`</span><span class="at">Warm Regime</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>,</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_frac =</span> (growth_shift <span class="sc">/</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>),</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">size_change  =</span> <span class="fu">ifelse</span>(growth_shift <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Increase"</span>, <span class="st">"Decrease"</span>)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(t_coef)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Do it for all the species</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>regime_comparison <span class="ot">&lt;-</span> vonbert_species <span class="sc">%&gt;%</span> </span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="at">.f =</span> regime_curve_prep, <span class="at">.id =</span> <span class="st">"comname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Changes in the size-at-age growth relationship varied across species, with the majority (14/18) of the species exhibiting smaller L-infinity during the warmer temperature regime.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try geom_waffle to just count each species as an individual and show that they are growing to smaller sizes in new regime:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggwaffle)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>age_set <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">waffle_iron</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">filter</span>(regime_comparison, age <span class="sc">==</span> age_set), </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes_d</span>(<span class="at">group =</span> size_change), <span class="at">rows =</span> <span class="dv">2</span>), </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(x, y, <span class="at">fill =</span> <span class="fu">fct_rev</span>(group))) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_waffle</span>() <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_waffle</span>() <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="fu">str_c</span>(<span class="st">"Warm Regime Growth Impacts on "</span>, age_set,<span class="st">" Body Length:"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The species that showed larger asymptotic lengths include the three hake species: <strong>red hake, silver hake, &amp; white hake</strong> as well as <strong>Atlantic herring.</strong> These species are all among the majority group of species that is found primarily in the Northern part of the survey area, in and around the Gulf of Maine.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape things so you can show confidence intervals here</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>plot_dat <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">!=</span> <span class="st">"t0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">llim =</span> estimate <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> std_error,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">rlim =</span> estimate <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> std_error,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">residence =</span> <span class="fu">ifelse</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>           comname <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"atlantic mackerel"</span>, <span class="st">"scup"</span>, <span class="st">"black sea bass"</span>, <span class="st">"butterfish"</span>),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Southern</span><span class="sc">\n</span><span class="st">Resident"</span>, </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Gulf of Maine</span><span class="sc">\n</span><span class="st">Resident"</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">regime =</span> <span class="fu">fct_rev</span>(regime),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">comname =</span> <span class="fu">fct_rev</span>(comname))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_dat, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> comname, <span class="at">group =</span> regime, <span class="at">color =</span> regime)) <span class="sc">+</span> </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># need to nudge groups separately</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Early Regime</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">data =</span> <span class="fu">filter</span>(plot_dat, regime <span class="sc">==</span> <span class="st">"Early Regime"</span>), </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> llim, <span class="at">xend =</span> rlim, <span class="at">yend =</span> comname), </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span> <span class="fu">filter</span>(plot_dat, regime <span class="sc">==</span> <span class="st">"Warm Regime"</span>), </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> llim, <span class="at">xend =</span> rlim, <span class="at">yend =</span> comname), </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#facet_grid(. ~ parameter, scales = "free", space = "free_y") +</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(residence <span class="sc">~</span> parameter, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> F) <span class="sc">+</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient Estimate"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Temperature Regime:"</span>) <span class="sc">+</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Everything</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>species_coef <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(comname, regime, parameter, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">"estimate"</span>), <span class="at">names_from =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"vbcoef"</span>, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"val"</span>, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"K"</span>, <span class="st">"Linf"</span>, <span class="st">"t0"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(vbcoef <span class="sc">!=</span> <span class="st">"t0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residence =</span> <span class="fu">ifelse</span>(comname <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"atlantic mackerel"</span>, <span class="st">"scup"</span>, <span class="st">"black sea bass"</span>, <span class="st">"butterfish"</span>), <span class="st">"Southern</span><span class="sc">\n</span><span class="st">Resident"</span>, <span class="st">"Gulf of Maine</span><span class="sc">\n</span><span class="st">Resident"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> val, <span class="at">y =</span> <span class="fu">fct_rev</span>(comname), <span class="at">fill =</span> <span class="fu">fct_rev</span>(regime))) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># facet_grid(. ~ vbcoef, scales = "free", space = "free_y") +</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(residence <span class="sc">~</span> vbcoef, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient Estimate"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Temperature Regime:"</span>) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="changes-in-l_infty" class="level2">
<h2 class="anchored" data-anchor-id="changes-in-l_infty">Changes in <span class="math inline">\(L_\infty\)</span></h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(comname, regime, parameter, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="st">"estimate"</span>, <span class="at">names_from =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regime_2 =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"Early Regime"</span>, <span class="st">"early"</span>, <span class="st">"warm"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(comname, regime_2, Linf) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> Linf, <span class="at">names_from =</span> regime_2) <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linf_diff =</span> warm <span class="sc">-</span> early,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_perc =</span> (linf_diff <span class="sc">/</span> early) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(diff_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Common Name"</span>, <span class="st">"Early Regime Linf"</span>, <span class="st">"Warm Regime Linf"</span>, <span class="st">"Change in Linf"</span>, <span class="st">"Percent Change"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="yagwpvqmkc" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yagwpvqmkc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yagwpvqmkc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yagwpvqmkc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yagwpvqmkc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yagwpvqmkc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yagwpvqmkc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yagwpvqmkc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yagwpvqmkc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yagwpvqmkc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yagwpvqmkc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yagwpvqmkc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yagwpvqmkc .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yagwpvqmkc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yagwpvqmkc .gt_from_md > :first-child {
  margin-top: 0;
}

#yagwpvqmkc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yagwpvqmkc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yagwpvqmkc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#yagwpvqmkc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yagwpvqmkc .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#yagwpvqmkc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yagwpvqmkc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yagwpvqmkc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yagwpvqmkc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yagwpvqmkc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yagwpvqmkc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#yagwpvqmkc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yagwpvqmkc .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#yagwpvqmkc .gt_left {
  text-align: left;
}

#yagwpvqmkc .gt_center {
  text-align: center;
}

#yagwpvqmkc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yagwpvqmkc .gt_font_normal {
  font-weight: normal;
}

#yagwpvqmkc .gt_font_bold {
  font-weight: bold;
}

#yagwpvqmkc .gt_font_italic {
  font-style: italic;
}

#yagwpvqmkc .gt_super {
  font-size: 65%;
}

#yagwpvqmkc .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Common Name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Early Regime Linf</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Warm Regime Linf</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Change in Linf</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Percent Change</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">silver hake</td>
<td class="gt_row gt_right">49.85</td>
<td class="gt_row gt_right">59.58</td>
<td class="gt_row gt_right">9.73</td>
<td class="gt_row gt_right">19.51</td></tr>
    <tr><td class="gt_row gt_left">white hake</td>
<td class="gt_row gt_right">164.88</td>
<td class="gt_row gt_right">187.04</td>
<td class="gt_row gt_right">22.16</td>
<td class="gt_row gt_right">13.44</td></tr>
    <tr><td class="gt_row gt_left">red hake</td>
<td class="gt_row gt_right">43.67</td>
<td class="gt_row gt_right">46.28</td>
<td class="gt_row gt_right">2.61</td>
<td class="gt_row gt_right">5.97</td></tr>
    <tr><td class="gt_row gt_left">windowpane</td>
<td class="gt_row gt_right">30.05</td>
<td class="gt_row gt_right">31.36</td>
<td class="gt_row gt_right">1.31</td>
<td class="gt_row gt_right">4.36</td></tr>
    <tr><td class="gt_row gt_left">atlantic herring</td>
<td class="gt_row gt_right">29.13</td>
<td class="gt_row gt_right">29.56</td>
<td class="gt_row gt_right">0.44</td>
<td class="gt_row gt_right">1.50</td></tr>
    <tr><td class="gt_row gt_left">atlantic mackerel</td>
<td class="gt_row gt_right">45.60</td>
<td class="gt_row gt_right">45.77</td>
<td class="gt_row gt_right">0.17</td>
<td class="gt_row gt_right">0.37</td></tr>
    <tr><td class="gt_row gt_left">acadian redfish</td>
<td class="gt_row gt_right">36.94</td>
<td class="gt_row gt_right">36.53</td>
<td class="gt_row gt_right">-0.41</td>
<td class="gt_row gt_right">-1.12</td></tr>
    <tr><td class="gt_row gt_left">black sea bass</td>
<td class="gt_row gt_right">78.72</td>
<td class="gt_row gt_right">77.42</td>
<td class="gt_row gt_right">-1.30</td>
<td class="gt_row gt_right">-1.65</td></tr>
    <tr><td class="gt_row gt_left">pollock</td>
<td class="gt_row gt_right">128.71</td>
<td class="gt_row gt_right">123.33</td>
<td class="gt_row gt_right">-5.38</td>
<td class="gt_row gt_right">-4.18</td></tr>
    <tr><td class="gt_row gt_left">butterfish</td>
<td class="gt_row gt_right">26.30</td>
<td class="gt_row gt_right">24.80</td>
<td class="gt_row gt_right">-1.50</td>
<td class="gt_row gt_right">-5.71</td></tr>
    <tr><td class="gt_row gt_left">haddock</td>
<td class="gt_row gt_right">64.14</td>
<td class="gt_row gt_right">59.66</td>
<td class="gt_row gt_right">-4.48</td>
<td class="gt_row gt_right">-6.98</td></tr>
    <tr><td class="gt_row gt_left">summer flounder</td>
<td class="gt_row gt_right">84.12</td>
<td class="gt_row gt_right">77.44</td>
<td class="gt_row gt_right">-6.68</td>
<td class="gt_row gt_right">-7.95</td></tr>
    <tr><td class="gt_row gt_left">yellowtail flounder</td>
<td class="gt_row gt_right">47.77</td>
<td class="gt_row gt_right">43.55</td>
<td class="gt_row gt_right">-4.22</td>
<td class="gt_row gt_right">-8.84</td></tr>
    <tr><td class="gt_row gt_left">winter flounder</td>
<td class="gt_row gt_right">52.17</td>
<td class="gt_row gt_right">47.18</td>
<td class="gt_row gt_right">-4.99</td>
<td class="gt_row gt_right">-9.57</td></tr>
    <tr><td class="gt_row gt_left">atlantic cod</td>
<td class="gt_row gt_right">122.77</td>
<td class="gt_row gt_right">110.31</td>
<td class="gt_row gt_right">-12.46</td>
<td class="gt_row gt_right">-10.15</td></tr>
    <tr><td class="gt_row gt_left">witch flounder</td>
<td class="gt_row gt_right">51.76</td>
<td class="gt_row gt_right">45.96</td>
<td class="gt_row gt_right">-5.81</td>
<td class="gt_row gt_right">-11.22</td></tr>
    <tr><td class="gt_row gt_left">american plaice</td>
<td class="gt_row gt_right">57.39</td>
<td class="gt_row gt_right">44.40</td>
<td class="gt_row gt_right">-12.98</td>
<td class="gt_row gt_right">-22.63</td></tr>
    <tr><td class="gt_row gt_left">scup</td>
<td class="gt_row gt_right">68.32</td>
<td class="gt_row gt_right">42.36</td>
<td class="gt_row gt_right">-25.96</td>
<td class="gt_row gt_right">-38.00</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="vb-fits-to-data" class="level2">
<h2 class="anchored" data-anchor-id="vb-fits-to-data">VB Fits to Data:</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the plot for each species</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>vb_fits_plot <span class="ot">=</span> <span class="cf">function</span>(spec_name){</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The raw size/age data:</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  t_dat <span class="ot">&lt;-</span> vonbert_species_agedat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name)  </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The group coefficients, augmented with x values across a range</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  age_max <span class="ot">&lt;-</span> <span class="fu">max</span>(t_dat<span class="sc">$</span>age)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> age_max, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(comname, regime, parameter, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="st">"estimate"</span>, <span class="at">names_from =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name) <span class="sc">%&gt;%</span> </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">regime =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime), <span class="fu">length</span>(x_range)),</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> <span class="fu">rep</span>(x_range, <span class="fu">length</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime)))),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"regime"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the length at age</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_length =</span> Linf <span class="sc">*</span> (<span class="dv">1</span>  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> K <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make plot?</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(t_dat, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> length_cm)) <span class="sc">+</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#facet_wrap(~regime, ncol = 1) +</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> t_coef,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred_length, <span class="at">group =</span> regime, <span class="at">color =</span> regime), </span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, age_max, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, age_max),</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>                       <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, .<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>() <span class="sc">+</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="at">data =</span> t_coef, </span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred_length, <span class="at">label =</span> regime, <span class="at">color =</span> regime), </span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">method=</span> <span class="fu">list</span>(<span class="st">"last.qp"</span>, <span class="at">cex =</span> <span class="fl">0.65</span>, <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">15</span>),</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Length (cm)"</span>,</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> spec_name,</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Temperature Regime:"</span>,</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Length at Age Regimes"</span>)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>     plot_panelset, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot_fun =</span> vb_fits_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-21-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<hr>
</section>
<section id="bonus-data-explorations" class="level1">
<h1>Bonus: Data Explorations</h1>
<section id="age-data-availability" class="level2">
<h2 class="anchored" data-anchor-id="age-data-availability">Age Data Availability</h2>
<p>The availability of age data varied by species and through time, with older ages becoming less frequently sampled in recent years across many species.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting age distribution as ggridges</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plot_age_ridgeplot <span class="ot">&lt;-</span> <span class="cf">function</span>(species){</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  vonbert_species_agedat <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> species,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>           age <span class="sc">&lt;=</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">yr =</span> <span class="fu">factor</span>(est_year),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">yr =</span> <span class="fu">fct_rev</span>(yr)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> yr)) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density_ridges</span>(<span class="fu">aes</span>(<span class="at">fill =</span> regime), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>comname) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title.position =</span> <span class="st">"top"</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_age_ridgeplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice-1">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod-1">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring-1">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish-1">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock-1">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock-1">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup-1">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake-1">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder-1">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder-1">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder-1">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
<p>Strong age classes were particularly prominent in the following species, showing lasting numbers in subsequent years.</p>
<table class="table">
<thead>
<tr class="header">
<th>Species</th>
<th>Strong Year Classes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Atlantic Cod</td>
<td>2003, 2013</td>
</tr>
<tr class="even">
<td>Haddock</td>
<td>2003, 2010, 2013</td>
</tr>
<tr class="odd">
<td>Atlantic Herring</td>
<td>2008, 2011</td>
</tr>
<tr class="even">
<td>Pollock</td>
<td>2000, 2012</td>
</tr>
</tbody>
</table>
</section>
<section id="growth-increment-changes" class="level2">
<h2 class="anchored" data-anchor-id="growth-increment-changes">Growth Increment Changes</h2>
<p>Annual Growth increments for each species were computed to track the change in growth of specific age-groups through time.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Age-Size Increments Differences</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>vb_incs <span class="ot">&lt;-</span> vonbert_species_agedat <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, est_year,  age, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_len =</span> <span class="fu">mean</span>(length_cm, <span class="at">na.rm =</span> T),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_wt  =</span> <span class="fu">mean</span>(indwt, <span class="at">na.rm =</span> T),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, age) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%&gt;%</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># What age is being subtracted from</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">lead_age   =</span> <span class="fu">lead</span>(age, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># String built from the value to confirm</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">diff_name  =</span> <span class="fu">str_c</span>(age, <span class="st">" - "</span>, lead_age),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Length/Weight at age + 1</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_age_p1 =</span> <span class="fu">lead</span>(avg_len, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_age_p1  =</span> <span class="fu">lead</span>(avg_wt, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Length/Weight Growth Increments</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_inc    =</span> len_age_p1 <span class="sc">-</span> avg_len,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_inc     =</span> wt_age_p1 <span class="sc">-</span> avg_wt,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Percent change in bodymass for going from age to age+1</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_perc_change =</span> (len_inc <span class="sc">/</span> avg_len) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_perc_change =</span> (wt_inc <span class="sc">/</span> avg_wt) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>((lead_age <span class="sc">-</span> age <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Age specific growth (annual growth increments) help detail where in a species life cycle it may be experiencing favorable or less-favorable conditions for growth. These can be a result of differences in habitat use or prey resources at different ages, and/or a change in exposure to temperature or other stressors that inflict a metabolic cost.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put together a timeseries of:</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># how big were the age 0's,</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># how big were the age 1's</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Age Increments</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>plot_age_increments <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    spec_choice, </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_choice =</span> <span class="st">"length"</span>, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">gam_knots =</span> <span class="dv">15</span>, </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_prefix =</span> <span class="st">"Age Increment: "</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_suffix =</span> <span class="st">""</span>){</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Code to switch variables and their labels:</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  var_sym <span class="ot">&lt;-</span> <span class="cf">switch</span>(var_choice,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"len_inc"</span>),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"wt_inc"</span>))</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  var_label <span class="ot">&lt;-</span> <span class="cf">switch</span>(var_choice,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"length"</span> <span class="ot">=</span> <span class="st">"Annual Growth  (cm)"</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"weight"</span> <span class="ot">=</span> <span class="st">"Annual Growth  (kg)"</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add pre/suffix to facet labels</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">prefix =</span> facet_prefix, <span class="at">suffix =</span> facet_suffix) {</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(prefix, string)}</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the plot</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  vb_incs <span class="sc">%&gt;%</span> </span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span> <span class="sc">==</span> spec_choice,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>           lead_age <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>({{var_sym}}) <span class="sc">%&gt;%</span> </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, {{var_sym}})) <span class="sc">+</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>      <span class="co"># geom_col(fill = gmri_cols("gmri blue")) +</span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"gmri blue"</span>)) <span class="sc">+</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"gmri blue"</span>), <span class="at">group =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">k =</span> gam_knots),</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>diff_name, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labeller =</span> <span class="fu">as_labeller</span>(appender))  <span class="sc">+</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> var_label,</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"Age Increment"</span>,</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">str_to_title</span>(spec_choice),</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">"Changes in annual "</span>, var_choice, <span class="st">" growth increments."</span>))</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_age_increments, <span class="at">var_choice =</span> <span class="st">"weight"</span>, <span class="at">gam_knots =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice-2">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod-2">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring-2">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish-2">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock-2">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock-2">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup-2">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake-2">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder-2">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder-2">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder-2">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-24-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
</section>
<section id="length-at-age-changes" class="level2">
<h2 class="anchored" data-anchor-id="length-at-age-changes">Length at Age Changes</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of Length/Weight Across Regimes </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>plot_regime_sizes <span class="ot">&lt;-</span> <span class="cf">function</span>(spec, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">var =</span> <span class="st">"length"</span>, </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">age_lim =</span> <span class="dv">5</span>, </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">facet_prefix =</span> <span class="st">"Age - "</span>, </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">facet_suffix =</span> <span class="st">""</span>){</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># switches for length or width</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  var_col <span class="ot">&lt;-</span> <span class="cf">switch</span> (var,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"length_cm"</span>),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"indwt"</span>))</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  var_lab <span class="ot">&lt;-</span> <span class="cf">switch</span> (var,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="st">"Individual Length (cm)"</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="st">"Individual Weight (kg)"</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add pre/suffix to facet labels</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">prefix =</span> facet_prefix, <span class="at">suffix =</span> facet_suffix) {</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(prefix, string)}</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select Ages, Prep data</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  size_changes <span class="ot">&lt;-</span> regime_dat <span class="sc">%&gt;%</span> </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    comname <span class="sc">==</span> spec,</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&lt;=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Calculate group averages</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_size =</span> <span class="fu">median</span>(<span class="sc">!!</span>{{var_col}})) <span class="sc">%&gt;%</span> </span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() </span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make median dataframe</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  median_df <span class="ot">&lt;-</span> size_changes <span class="sc">%&gt;%</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(age, regime, median_size) <span class="sc">%&gt;%</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"regime"</span>, <span class="at">values_from =</span> <span class="st">"median_size"</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make Plot</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  size_changes <span class="sc">%&gt;%</span> </span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">!!</span>{{var_col}})) <span class="sc">+</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>    <span class="do">## distribution</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime, </span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> <span class="fu">after_scale</span>(color)),</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">slab_alpha =</span> .<span class="dv">5</span>, </span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.width =</span> <span class="dv">0</span>, </span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trim =</span> T, </span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>                 <span class="at">shape =</span> <span class="dv">21</span>, </span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">point_colour =</span> <span class="st">"gray25"</span>,</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stroke =</span> <span class="fl">1.6</span>,</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">scale =</span> .<span class="dv">86</span>) <span class="sc">+</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># median line</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> median_df,</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>,</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">xend =</span> <span class="st">`</span><span class="at">Warm Regime</span><span class="st">`</span>,</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">0</span>,</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">8</span>,</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"grey25"</span>, <span class="co"># , position = position_nudge(y = -.15)</span></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>    <span class="do">## median points - not working</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime), <span class="at">.width =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">slab_fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>age, <span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(appender), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>() <span class="sc">+</span> </span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> var_lab,</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Proportion"</span>,</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> spec,</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Temperature Regime"</span>,</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Temperature Regime"</span>,</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">"Median"</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester: </span></span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_regime_sizes(key_species[[1]], var = "length")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_regime_sizes, <span class="at">var =</span> <span class="st">"length"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice-3">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod-3">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring-3">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish-3">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock-3">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock-3">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup-3">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake-3">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder-3">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder-3">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder-3">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-25-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
</section>
<section id="weight-at-age-changes" class="level2">
<h2 class="anchored" data-anchor-id="weight-at-age-changes">Weight at Age Changes</h2>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_regime_sizes, <span class="at">var =</span> <span class="st">"weight"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice-4">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod-4">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring-4">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish-4">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock-4">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock-4">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup-4">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake-4">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder-4">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder-4">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder-4">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-26-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
</section>
<section id="shifts-in-growth" class="level2">
<h2 class="anchored" data-anchor-id="shifts-in-growth">Shifts in Growth</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot their growth curves</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>regime_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(comname %in% key_species) %&gt;% </span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> growth_frac)) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> comname), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"orange"</span>)<span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>comname, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Shift in Length Moving to Warm Regime"</span>, </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Thermal Regime Impacts on Growth"</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Changes in Size at Age (Warm Regime - Historic Regime)"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/regime%20impact%20plot-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kathy requested the curve data.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Going to save both the coefficients and the fitted data for all species</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(regime_comparison, <span class="fu">here</span>(<span class="st">"data/growth_results/growth_regime_fits.csv"</span>))</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(species_coef, <span class="fu">here</span>(<span class="st">"data/growth_results/growth_regime_coefs.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try horizons</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggHoriPlot)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter outliers beyond 5th and 95th quantile</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> regime_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">between</span>(</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>      growth_frac,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(growth_frac, <span class="fl">0.05</span>, <span class="at">na.rm =</span> T)<span class="sc">-</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">IQR</span>(growth_frac, <span class="at">na.rm =</span> T),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(growth_frac, <span class="fl">0.95</span>, <span class="at">na.rm =</span> T)<span class="sc">+</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">IQR</span>(growth_frac, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outlier)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Set origin</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually pick cut points</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>sca <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">9</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>sca_bins <span class="ot">&lt;-</span> <span class="fu">str_c</span>(sca[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(sca)<span class="sc">-</span><span class="dv">1</span>)], <span class="st">" to "</span>, sca[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(sca)], <span class="st">"%"</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>sca_labels <span class="ot">&lt;-</span> <span class="fu">rev</span>(sca_bins)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Titles</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>), <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="st">"lines"</span>),</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Axes</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.y =</span> <span class="fu">element_line</span>(), </span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), </span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">rect =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Facets</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>              <span class="at">strip.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype=</span><span class="st">"solid"</span>)))</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it all</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(regime_comparison, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> growth_frac)) <span class="sc">+</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_horizon</span>(</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(age, </span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> growth_frac,</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> ..Cutpoints..), </span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin =</span> ori, </span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">horizonscale =</span> sca) <span class="sc">+</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hcl</span>(<span class="at">palette =</span> <span class="st">'RdBu'</span>, <span class="at">reverse =</span> T, <span class="at">labels =</span> sca_labels) <span class="sc">+</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(comname<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Titles</span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(</span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>, </span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>), </span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="st">"lines"</span>),</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Axes</span></span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), </span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">rect =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Facets</span></span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype=</span><span class="st">"solid"</span>),</span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing.y=</span><span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="st">"lines"</span>),</span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"left"</span>)  <span class="sc">+</span></span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Age'</span>, </span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Change in Body Size at Age"</span>) <span class="sc">+</span></span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>

<!---- Rmarkdown Custom Footer for Author Details - Modify personal info as needed ------>

<!---- Custom Footer ------->
&nbsp;

<!---- Add GMRI Logo to footer ---->

<!--
<p style="text-align: center;">
    <img src="presentations/gmri_logo.png" alt="GMRI Logo" height="91" width="248">
</p>
-->

<!---- Author Details  ------>
<hr>
<p style="text-align: center; font-size: 60%; padding: 0px;">A work by <a href="https://github.com/adamkemberling/">Adam A. Kemberling</a></p>
<p style="text-align: center; font-size: 60%; padding: 0px;"><span style="color: #808080;"><em>Akemberling@gmri.org</em></span></p>





<!-- Add Font-Awesome Icon Library -->
<!--

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

-->

<!-- Add Icons with Personal Links -->
<!--

<p style="text-align: center;">
    <a href="https://twitter.com/r_graph_gallery?lang=en" class="fa fa-twitter"></a>
    <a href="https://www.linkedin.com/in/yan-holtz-2477534a/" class="fa fa-linkedin"></a>
    <a href="https://github.com/holtzy/" class="fa fa-github"></a>
</p>

-->

&nbsp;

<!--- End Custom Footer --->




</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Size at Age Regimes"</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">    name: "Adam Kemberling"</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://github.com/adamkemberling</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Gulf of Maine Research Institute</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> | </span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">  Differential Growth Rates of Northeast US Fishes Following Temperature Regime Shift</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 2</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co">  fig.height: 6</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co">  fig.width: 6</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="co">  fig.align: "center"</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co">  comment: ""</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r packages and functions}</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| include = FALSE,</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="do">####  Packages  ####</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FSAdata)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FSA)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(matrixStats)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xaringanExtra)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geomtextpath)</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmRi)</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme</span></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_gmri</span>())</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Acitvate panelset</span></span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a>xaringanExtra<span class="sc">::</span><span class="fu">use_panelset</span>()</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate panels using a key word and a plot function</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a>plot_panelset <span class="ot">&lt;-</span> <span class="cf">function</span>(spec, plot_fun, ...) {</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Open panel</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"::: {.panel}</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create header for panel name</span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"##"</span>, spec, <span class="st">"{.panel-name}</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Text as a plot description</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Plot of", spec, "\n")</span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make plot</span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">plot_fun</span>(spec, ...)</span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add linebreak</span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Close panel</span></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">":::</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a><span class="in">`r gmRi::use_gmri_style_rmd(css_file = "gmri_rmarkdown.css")`</span></span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a><span class="fu"># Growth Regimes in the NW Atlantic Following Temperature Regime Shift</span></span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a><span class="fu">### Literature on TSR and Growth Expectations</span></span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a><span class="fu">### Introduce Study Area and Existing Research</span></span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a>Recent changes in Gulf stream positioning have altered the relative influences of the Gulf stream and Labrador current on temperature and salinity regimes for the region. Understanding that this new temperature and salinity regime should alter both the energetics of the region, as well as food-web dynamics. We seek to identify whether these changes have had a measurable impact on the growth of several groundfish species.</span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a>Despite many of these species living at or near the bottom, research suggests that the forces driving these thermal regimes should have far-reaching impacts biological impacts. These impacts may directly change the near-bottom environment through mixing patterns, and/or indirectly through food-web impacts.</span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a>Through the lens of an environmental regime change we will assess changes to body size, size-at-age, and growth characteristics derived using the von-bertalanffy growth equation.</span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a><span class="fu"># Methods</span></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sea Surface Temperature</span></span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a>Global Sea surface temperature data was obtained via NOAA’s optimally interpolated SST analysis, providing daily temperature values at a 0.25° latitude x 0.25° longitude resolution (Reynolds et al. 2007). A daily climatology for every 0.25° pixel in the global data set was created using average daily temperatures spanning the period of 1982-2011. Daily anomalies were then computed as the difference between observed temperatures and the daily climatological average. OISSTv2 data used in these analyses were provided by the NOAA PSL, Boulder, Colorado, USA from their website at https://psl.noaa.gov.</span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the regional temperatures from {targets}</span></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb37-112"><a href="#cb37-112" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(regional_oisst))</span>
<span id="cb37-113"><a href="#cb37-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a><span class="co"># Get regional averages</span></span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a>temp_regimes <span class="ot">&lt;-</span> regional_oisst <span class="sc">%&gt;%</span> </span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yr <span class="sc">&gt;</span> <span class="dv">1981</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">regime =</span> <span class="fu">ifelse</span>(yr <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"1982-2009 Average"</span>, <span class="st">"2010-2021 Average"</span>),</span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey_area =</span> <span class="fu">ifelse</span>(survey_area <span class="sc">==</span> <span class="st">"all"</span>, <span class="st">"Full Region"</span>, survey_area),</span>
<span id="cb37-121"><a href="#cb37-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey_area =</span> <span class="fu">factor</span>(survey_area, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Full Region"</span>, <span class="st">"GoM"</span>, <span class="st">"GB"</span>, <span class="st">"SNE"</span>, <span class="st">"MAB"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-122"><a href="#cb37-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(survey_area, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_temp_c =</span> <span class="fu">round</span>(<span class="fu">mean</span>(sst), <span class="dv">2</span>),</span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_label =</span> <span class="fu">str_c</span>(avg_temp_c, <span class="st">"\u00b0C"</span>),</span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_anom_c =</span> <span class="fu">mean</span>(sst_anom),</span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_anom_c = ifelse(regime == "1982-2009 Regime", 0, avg_anom_c),</span></span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>, <span class="fl">1981.5</span>, <span class="fl">2009.5</span>),</span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>, <span class="fl">2009.5</span>, <span class="fl">2021.5</span>),</span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-135"><a href="#cb37-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-136"><a href="#cb37-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Temperature Study Region</span></span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true" tabindex="-1"></a>Temperature data was regionally averaged to match the sampling area for the fisheries independent survey program providing the age-at-length data. SST anomalies were averaged over the entire sampling region, consisting of continental shelf habitats from Cape Hatteras to Nova Scotia, to produce a daily time series. This time series was then processed into an annual timeseries of surface temperatures and anomalies. All area-averaging was done with area-weighting to account for differences in the relative areas of the latitude/longitude grid of the OISSTv2 data.</span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true" tabindex="-1"></a><span class="fu">### Temperature Regime Shift</span></span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true" tabindex="-1"></a>**Text about identifying the regime shift**</span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true" tabindex="-1"></a><span class="fu">### Warming Trends</span></span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-148"><a href="#cb37-148" aria-hidden="true" tabindex="-1"></a>We computed the linear trend ($°C/Decade$) in the daily Gulf of Maine SST time series using standard linear regression. We considered the full time period (1982-2009) and the last decade</span>
<span id="cb37-149"><a href="#cb37-149" aria-hidden="true" tabindex="-1"></a>(2010-2019), estimating warming rates and long-term averages independently for each period.</span>
<span id="cb37-150"><a href="#cb37-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-153"><a href="#cb37-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-154"><a href="#cb37-154" aria-hidden="true" tabindex="-1"></a><span class="co"># warming trends</span></span>
<span id="cb37-155"><a href="#cb37-155" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb37-156"><a href="#cb37-156" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1982-2019"</span> <span class="ot">=</span> <span class="fu">filter</span>(temp_regimes, <span class="fu">between</span>(yr, <span class="dv">1982</span>, <span class="dv">2009</span>)),</span>
<span id="cb37-157"><a href="#cb37-157" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2010-2019"</span> <span class="ot">=</span> <span class="fu">filter</span>(temp_regimes, <span class="fu">between</span>(yr, <span class="dv">2010</span>, <span class="dv">2019</span>))</span>
<span id="cb37-158"><a href="#cb37-158" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-159"><a href="#cb37-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(.x){</span>
<span id="cb37-160"><a href="#cb37-160" aria-hidden="true" tabindex="-1"></a>    mod_x <span class="ot">&lt;-</span> <span class="fu">lm</span>(sst <span class="sc">~</span> yr, <span class="at">data =</span> .x)</span>
<span id="cb37-161"><a href="#cb37-161" aria-hidden="true" tabindex="-1"></a>    rate <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod_x)[[<span class="st">"yr"</span>]] <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb37-162"><a href="#cb37-162" aria-hidden="true" tabindex="-1"></a>    rate_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Decadal Rate"</span> <span class="ot">=</span> <span class="fu">round</span>(rate, <span class="dv">2</span>))</span>
<span id="cb37-163"><a href="#cb37-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(rate_df)}, <span class="at">.id =</span> <span class="st">"Period"</span>)</span>
<span id="cb37-164"><a href="#cb37-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-165"><a href="#cb37-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-166"><a href="#cb37-166" aria-hidden="true" tabindex="-1"></a>Temperatures prior to the 2010 regime shift rose at a rate of 0.7 $°C/Decade$. Regional temperatures then peaked in 2012 and have remained high while decreasing slowly at a rate of 0.02 $°C/Decade$.</span>
<span id="cb37-167"><a href="#cb37-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-168"><a href="#cb37-168" aria-hidden="true" tabindex="-1"></a><span class="fu">## Distribution Shift Analyses</span></span>
<span id="cb37-169"><a href="#cb37-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-170"><a href="#cb37-170" aria-hidden="true" tabindex="-1"></a>Fishery Independent data on groundfish size-at-age was collected as part of the NEFSC's northeast trawl survey. This survey is conducted each year in the Spring and in the fall, with sample locations determined following a stratified-random survey design with effort allocated in proportion to stratum area. **Add an Explanation of the Strata we Exclude**. Correction factors were applied for changes in vessels, gear, and doors when appropriate. Prior to sampling, a CTD cast is performed to collect environmental conditions for the water column at/near the start of the trawl sample providing information on bottom habitat conditions like bottom temperatures. Distribution shift analyses were limited to data from the Spring survey season. Previous work has shown no significant changes in timing of sampling, or the mean annual latitude and longitude of the Spring survey sampling (Nye et al. 2009).</span>
<span id="cb37-171"><a href="#cb37-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-172"><a href="#cb37-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-173"><a href="#cb37-173" aria-hidden="true" tabindex="-1"></a>**What do we calculate and for how many species?**</span>
<span id="cb37-174"><a href="#cb37-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-175"><a href="#cb37-175" aria-hidden="true" tabindex="-1"></a>Our analyses followed the continued movements of 30 species consistent with Nye et al. 2009. These species were originally selected for being consistently sampled across all years, and as representatives of a wide range of taxonomic groups.</span>
<span id="cb37-176"><a href="#cb37-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-179"><a href="#cb37-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-180"><a href="#cb37-180" aria-hidden="true" tabindex="-1"></a><span class="co"># Access the tidy survdat Data with {targets}</span></span>
<span id="cb37-181"><a href="#cb37-181" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb37-182"><a href="#cb37-182" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(survdat_clean))</span>
<span id="cb37-183"><a href="#cb37-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-184"><a href="#cb37-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-185"><a href="#cb37-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to Just spring?</span></span>
<span id="cb37-186"><a href="#cb37-186" aria-hidden="true" tabindex="-1"></a>dist_dat <span class="ot">&lt;-</span> survdat_clean <span class="sc">%&gt;%</span> </span>
<span id="cb37-187"><a href="#cb37-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"Spring"</span>)</span>
<span id="cb37-188"><a href="#cb37-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-189"><a href="#cb37-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Just the Species, or as Stocks?</span></span>
<span id="cb37-190"><a href="#cb37-190" aria-hidden="true" tabindex="-1"></a>nye_species <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb37-191"><a href="#cb37-191" aria-hidden="true" tabindex="-1"></a>  <span class="st">"spiny dogfish"</span>,</span>
<span id="cb37-192"><a href="#cb37-192" aria-hidden="true" tabindex="-1"></a>  <span class="st">"little skate"</span>,</span>
<span id="cb37-193"><a href="#cb37-193" aria-hidden="true" tabindex="-1"></a>  <span class="st">"thorny skate"</span>,</span>
<span id="cb37-194"><a href="#cb37-194" aria-hidden="true" tabindex="-1"></a>  <span class="st">"winter skate"</span>,</span>
<span id="cb37-195"><a href="#cb37-195" aria-hidden="true" tabindex="-1"></a>  <span class="st">"alewife"</span>,</span>
<span id="cb37-196"><a href="#cb37-196" aria-hidden="true" tabindex="-1"></a>  <span class="st">"american shad"</span>,</span>
<span id="cb37-197"><a href="#cb37-197" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic herring"</span>,</span>
<span id="cb37-198"><a href="#cb37-198" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic cod"</span>,</span>
<span id="cb37-199"><a href="#cb37-199" aria-hidden="true" tabindex="-1"></a>  <span class="st">"haddock"</span>,</span>
<span id="cb37-200"><a href="#cb37-200" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pollock"</span>,</span>
<span id="cb37-201"><a href="#cb37-201" aria-hidden="true" tabindex="-1"></a>  <span class="st">"silver hake"</span>,</span>
<span id="cb37-202"><a href="#cb37-202" aria-hidden="true" tabindex="-1"></a>  <span class="st">"red hake"</span>,</span>
<span id="cb37-203"><a href="#cb37-203" aria-hidden="true" tabindex="-1"></a>  <span class="st">"spotted hake"</span>,</span>
<span id="cb37-204"><a href="#cb37-204" aria-hidden="true" tabindex="-1"></a>  <span class="st">"white hake"</span>,</span>
<span id="cb37-205"><a href="#cb37-205" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cusk"</span>,</span>
<span id="cb37-206"><a href="#cb37-206" aria-hidden="true" tabindex="-1"></a>  <span class="st">"goosefish"</span>,</span>
<span id="cb37-207"><a href="#cb37-207" aria-hidden="true" tabindex="-1"></a>  <span class="st">"american plaice"</span>,</span>
<span id="cb37-208"><a href="#cb37-208" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic halibut"</span>,</span>
<span id="cb37-209"><a href="#cb37-209" aria-hidden="true" tabindex="-1"></a>  <span class="st">"yellowtail flounder"</span>,</span>
<span id="cb37-210"><a href="#cb37-210" aria-hidden="true" tabindex="-1"></a>  <span class="st">"winter flounder"</span>,</span>
<span id="cb37-211"><a href="#cb37-211" aria-hidden="true" tabindex="-1"></a>  <span class="st">"fourspot flounder"</span>,</span>
<span id="cb37-212"><a href="#cb37-212" aria-hidden="true" tabindex="-1"></a>  <span class="st">"summer flounder"</span>,</span>
<span id="cb37-213"><a href="#cb37-213" aria-hidden="true" tabindex="-1"></a>  <span class="st">"windowpane"</span>,</span>
<span id="cb37-214"><a href="#cb37-214" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic mackerel"</span>,</span>
<span id="cb37-215"><a href="#cb37-215" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ocean pout"</span>,</span>
<span id="cb37-216"><a href="#cb37-216" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic wolffish"</span>,</span>
<span id="cb37-217"><a href="#cb37-217" aria-hidden="true" tabindex="-1"></a>  <span class="st">"blackbelly rosefish"</span>,</span>
<span id="cb37-218"><a href="#cb37-218" aria-hidden="true" tabindex="-1"></a>  <span class="st">"longhorn sculpin"</span>,</span>
<span id="cb37-219"><a href="#cb37-219" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sea raven"</span>,</span>
<span id="cb37-220"><a href="#cb37-220" aria-hidden="true" tabindex="-1"></a>  <span class="st">"acadian redfish"</span></span>
<span id="cb37-221"><a href="#cb37-221" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-222"><a href="#cb37-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-223"><a href="#cb37-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-224"><a href="#cb37-224" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to those species</span></span>
<span id="cb37-225"><a href="#cb37-225" aria-hidden="true" tabindex="-1"></a>dist_dat <span class="ot">&lt;-</span> dist_dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(comname <span class="sc">%in%</span> nye_species)</span>
<span id="cb37-226"><a href="#cb37-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-227"><a href="#cb37-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the total biomass at each station</span></span>
<span id="cb37-228"><a href="#cb37-228" aria-hidden="true" tabindex="-1"></a><span class="co"># Totals up the abundance and biomass across sex*</span></span>
<span id="cb37-229"><a href="#cb37-229" aria-hidden="true" tabindex="-1"></a>station_totals <span class="ot">&lt;-</span> dist_dat <span class="sc">%&gt;%</span> </span>
<span id="cb37-230"><a href="#cb37-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(est_year, survey_area, stratum, tow, est_towdate, avgdepth, bottemp, decdeg_beglat, decdeg_beglon, comname) <span class="sc">%&gt;%</span> </span>
<span id="cb37-231"><a href="#cb37-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb37-232"><a href="#cb37-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">biomass_kg =</span> <span class="fu">sum</span>(biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-233"><a href="#cb37-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb37-234"><a href="#cb37-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-235"><a href="#cb37-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-236"><a href="#cb37-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-237"><a href="#cb37-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-238"><a href="#cb37-238" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculating Spatial Metrics</span></span>
<span id="cb37-239"><a href="#cb37-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-240"><a href="#cb37-240" aria-hidden="true" tabindex="-1"></a>Movements through time were characterized for each species using the following metrics: center of biomass, area-occupied, mean depth of occurrence, and the mean temperature of occurrence. Each metric was weighted by the biomass of a species sampled at each station such that.</span>
<span id="cb37-241"><a href="#cb37-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-242"><a href="#cb37-242" aria-hidden="true" tabindex="-1"></a>$$X_j = \frac{ \sum_{}^{}  w_iX_{ij}  }{  \sum~w_i  }$$</span>
<span id="cb37-243"><a href="#cb37-243" aria-hidden="true" tabindex="-1"></a>Where $X$ is the spatial metric, $j$ is the year, &amp; $w$ is the biomass (in kg) for each station $i$. </span>
<span id="cb37-244"><a href="#cb37-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-247"><a href="#cb37-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-248"><a href="#cb37-248" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to run the group weighted means on different groups using ...</span></span>
<span id="cb37-249"><a href="#cb37-249" aria-hidden="true" tabindex="-1"></a><span class="co"># Does all variables: depth, temp, lat, lon &amp; their variance (sd)</span></span>
<span id="cb37-250"><a href="#cb37-250" aria-hidden="true" tabindex="-1"></a>group_spat_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(station_totals, ...){</span>
<span id="cb37-251"><a href="#cb37-251" aria-hidden="true" tabindex="-1"></a>  station_totals <span class="sc">%&gt;%</span> </span>
<span id="cb37-252"><a href="#cb37-252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(comname, ...) <span class="sc">%&gt;%</span> </span>
<span id="cb37-253"><a href="#cb37-253" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb37-254"><a href="#cb37-254" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_biomass   =</span> <span class="fu">sum</span>(biomass_kg),</span>
<span id="cb37-255"><a href="#cb37-255" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_biomass     =</span> <span class="fu">mean</span>(biomass_kg),</span>
<span id="cb37-256"><a href="#cb37-256" aria-hidden="true" tabindex="-1"></a>      <span class="at">biomass_sd      =</span> <span class="fu">sd</span>(biomass_kg),</span>
<span id="cb37-257"><a href="#cb37-257" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_depth       =</span> <span class="fu">weightedMean</span>(avgdepth, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-258"><a href="#cb37-258" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_temp        =</span> <span class="fu">weightedMean</span>(bottemp, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-259"><a href="#cb37-259" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_lat         =</span> <span class="fu">weightedMean</span>(decdeg_beglat, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-260"><a href="#cb37-260" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_lon         =</span> <span class="fu">weightedMean</span>(decdeg_beglon, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-261"><a href="#cb37-261" aria-hidden="true" tabindex="-1"></a>      <span class="at">depth_sd        =</span> <span class="fu">weightedSd</span>(avgdepth, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-262"><a href="#cb37-262" aria-hidden="true" tabindex="-1"></a>      <span class="at">temp_sd         =</span> <span class="fu">weightedSd</span>(bottemp, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-263"><a href="#cb37-263" aria-hidden="true" tabindex="-1"></a>      <span class="at">lat_sd          =</span> <span class="fu">weightedSd</span>(decdeg_beglat, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-264"><a href="#cb37-264" aria-hidden="true" tabindex="-1"></a>      <span class="at">lon_sd          =</span> <span class="fu">weightedSd</span>(decdeg_beglon, <span class="at">w =</span> biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-265"><a href="#cb37-265" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb37-266"><a href="#cb37-266" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-267"><a href="#cb37-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-268"><a href="#cb37-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-269"><a href="#cb37-269" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate weighted mean &amp; median across biomass variables</span></span>
<span id="cb37-270"><a href="#cb37-270" aria-hidden="true" tabindex="-1"></a><span class="co"># returns a common format that can join easily to global benchmarks</span></span>
<span id="cb37-271"><a href="#cb37-271" aria-hidden="true" tabindex="-1"></a>biomass_weighted_var <span class="ot">&lt;-</span> <span class="cf">function</span>(station_totals, var_col, ...){</span>
<span id="cb37-272"><a href="#cb37-272" aria-hidden="true" tabindex="-1"></a>  var_lab <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(var_col))</span>
<span id="cb37-273"><a href="#cb37-273" aria-hidden="true" tabindex="-1"></a>  mean_df <span class="ot">&lt;-</span> station_totals <span class="sc">%&gt;%</span> </span>
<span id="cb37-274"><a href="#cb37-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(comname, ...) <span class="sc">%&gt;%</span> </span>
<span id="cb37-275"><a href="#cb37-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb37-276"><a href="#cb37-276" aria-hidden="true" tabindex="-1"></a>    <span class="at">biom_median  =</span> <span class="fu">weightedMedian</span>({{var_col}}, biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-277"><a href="#cb37-277" aria-hidden="true" tabindex="-1"></a>    <span class="at">biom_mu      =</span> <span class="fu">weightedMean</span>({{var_col}},   biomass_kg, <span class="at">na.rm =</span> T),</span>
<span id="cb37-278"><a href="#cb37-278" aria-hidden="true" tabindex="-1"></a>    <span class="at">biom_sd      =</span> <span class="fu">weightedSd</span>({{var_col}}, biomass_kg, <span class="at">na.rm =</span> T), </span>
<span id="cb37-279"><a href="#cb37-279" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-280"><a href="#cb37-280" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var =</span> var_lab)</span>
<span id="cb37-281"><a href="#cb37-281" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-282"><a href="#cb37-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mean_df)</span>
<span id="cb37-283"><a href="#cb37-283" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-284"><a href="#cb37-284" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-285"><a href="#cb37-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-286"><a href="#cb37-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-287"><a href="#cb37-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-288"><a href="#cb37-288" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Yearly Spatial Metrics</span></span>
<span id="cb37-289"><a href="#cb37-289" aria-hidden="true" tabindex="-1"></a>year_avgs <span class="ot">&lt;-</span> <span class="fu">group_spat_metrics</span>(station_totals, est_year) </span>
<span id="cb37-290"><a href="#cb37-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-291"><a href="#cb37-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-292"><a href="#cb37-292" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Average Metrics Across Temperature Regimes</span></span>
<span id="cb37-293"><a href="#cb37-293" aria-hidden="true" tabindex="-1"></a>regime_avgs <span class="ot">&lt;-</span> station_totals <span class="sc">%&gt;%</span> </span>
<span id="cb37-294"><a href="#cb37-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(est_year <span class="sc">&gt;=</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-295"><a href="#cb37-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_regime =</span> <span class="fu">ifelse</span>(est_year <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"Early Regime"</span>, <span class="st">"Warm Regime"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-296"><a href="#cb37-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_spat_metrics</span>(., temp_regime) </span>
<span id="cb37-297"><a href="#cb37-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-298"><a href="#cb37-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-299"><a href="#cb37-299" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance across all years within each species</span></span>
<span id="cb37-300"><a href="#cb37-300" aria-hidden="true" tabindex="-1"></a>global_benchmarks <span class="ot">&lt;-</span> <span class="fu">group_spat_metrics</span>(station_totals) </span>
<span id="cb37-301"><a href="#cb37-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-302"><a href="#cb37-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-303"><a href="#cb37-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-304"><a href="#cb37-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-305"><a href="#cb37-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-306"><a href="#cb37-306" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analysis of Spatial Metrics</span></span>
<span id="cb37-307"><a href="#cb37-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-308"><a href="#cb37-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-309"><a href="#cb37-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-310"><a href="#cb37-310" aria-hidden="true" tabindex="-1"></a><span class="fu">## Size at Age Analyses</span></span>
<span id="cb37-311"><a href="#cb37-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-312"><a href="#cb37-312" aria-hidden="true" tabindex="-1"></a>The available age data is a subset of the overall catch data, which contains additional information on individual fishes such as otolith-derived aging that require additional workup to ascertain. Not all fish species have age available for the full time period, with special attention being given to aid in the management of commercially valuable species.</span>
<span id="cb37-313"><a href="#cb37-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-314"><a href="#cb37-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bio data prep}</span></span>
<span id="cb37-315"><a href="#cb37-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Access Biological Data with {targets}</span></span>
<span id="cb37-316"><a href="#cb37-316" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb37-317"><a href="#cb37-317" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(survdat_biological))</span>
<span id="cb37-318"><a href="#cb37-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-319"><a href="#cb37-319" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Prepare Bio Data for Age analysis for regimes:</span></span>
<span id="cb37-320"><a href="#cb37-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-321"><a href="#cb37-321" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NA age data, restrict to summer and fall</span></span>
<span id="cb37-322"><a href="#cb37-322" aria-hidden="true" tabindex="-1"></a>nmfs_bio <span class="ot">&lt;-</span> survdat_biological <span class="sc">%&gt;%</span></span>
<span id="cb37-323"><a href="#cb37-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(age) <span class="sc">==</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-324"><a href="#cb37-324" aria-hidden="true" tabindex="-1"></a>         season <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Spring"</span>, <span class="st">"Fall"</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb37-325"><a href="#cb37-325" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb37-326"><a href="#cb37-326" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-327"><a href="#cb37-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-328"><a href="#cb37-328" aria-hidden="true" tabindex="-1"></a><span class="co">#Add regime and decade labels</span></span>
<span id="cb37-329"><a href="#cb37-329" aria-hidden="true" tabindex="-1"></a>nmfs_bio <span class="ot">&lt;-</span> nmfs_bio <span class="sc">%&gt;%</span> </span>
<span id="cb37-330"><a href="#cb37-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-331"><a href="#cb37-331" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearclass =</span> est_year <span class="sc">-</span> (age<span class="dv">-1</span>),</span>
<span id="cb37-332"><a href="#cb37-332" aria-hidden="true" tabindex="-1"></a>    <span class="at">regime =</span> <span class="fu">ifelse</span>(est_year <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"Early Regime"</span>, <span class="st">"Warm Regime"</span>),</span>
<span id="cb37-333"><a href="#cb37-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">decade =</span> <span class="fu">floor_decade</span>(est_year)) </span>
<span id="cb37-334"><a href="#cb37-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-335"><a href="#cb37-335" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(survdat_biological)</span>
<span id="cb37-336"><a href="#cb37-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-337"><a href="#cb37-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-338"><a href="#cb37-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-339"><a href="#cb37-339" aria-hidden="true" tabindex="-1"></a><span class="do">####  Growth Data Prep  #### </span></span>
<span id="cb37-340"><a href="#cb37-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-341"><a href="#cb37-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to just the data for the two regimes</span></span>
<span id="cb37-342"><a href="#cb37-342" aria-hidden="true" tabindex="-1"></a>regime_dat <span class="ot">&lt;-</span> <span class="fu">filter</span>(nmfs_bio, est_year <span class="sc">&gt;=</span> <span class="dv">2000</span>, est_year <span class="sc">&lt;=</span> <span class="dv">2019</span>)</span>
<span id="cb37-343"><a href="#cb37-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-344"><a href="#cb37-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-345"><a href="#cb37-345" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank species by how many measurements there are</span></span>
<span id="cb37-346"><a href="#cb37-346" aria-hidden="true" tabindex="-1"></a>species_abunds <span class="ot">&lt;-</span> regime_dat <span class="sc">%&gt;%</span> </span>
<span id="cb37-347"><a href="#cb37-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(comname) <span class="sc">%&gt;%</span> </span>
<span id="cb37-348"><a href="#cb37-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="co"># ordered by number measured</span></span>
<span id="cb37-349"><a href="#cb37-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-350"><a href="#cb37-350" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reorder alphabetically And take</span></span>
<span id="cb37-351"><a href="#cb37-351" aria-hidden="true" tabindex="-1"></a><span class="co"># vonbert_species &lt;- sort(species_abunds$comname[1:17])</span></span>
<span id="cb37-352"><a href="#cb37-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-353"><a href="#cb37-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-354"><a href="#cb37-354" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the ones that don't work</span></span>
<span id="cb37-355"><a href="#cb37-355" aria-hidden="true" tabindex="-1"></a>vonbert_species <span class="ot">&lt;-</span> species_abunds <span class="sc">%&gt;%</span> </span>
<span id="cb37-356"><a href="#cb37-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(comname <span class="sc">%not in%</span> <span class="fu">c</span>(<span class="st">"goosefish"</span>, <span class="st">"fourspot flounder"</span>, <span class="st">"cusk"</span>, <span class="st">"ocean pout"</span>, <span class="st">"bluefish"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-357"><a href="#cb37-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(comname) <span class="sc">%&gt;%</span> </span>
<span id="cb37-358"><a href="#cb37-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(comname)</span>
<span id="cb37-359"><a href="#cb37-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-360"><a href="#cb37-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-361"><a href="#cb37-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-362"><a href="#cb37-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-363"><a href="#cb37-363" aria-hidden="true" tabindex="-1"></a>Size at age analyses were performed on <span class="in">`r length(vonbert_species)`</span> species. Species were omitted from analyses if age data was not available across both temperature regimes (bluefish &amp; ocean pout) or if their physiology prevented accurate aging (elasmobranch species). The following 18 species had sufficient age data across both temperature regimes to be included in the analysis: **`r pander::pander(vonbert_species)`**.</span>
<span id="cb37-364"><a href="#cb37-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-365"><a href="#cb37-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-366"><a href="#cb37-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r panel species}</span></span>
<span id="cb37-367"><a href="#cb37-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-368"><a href="#cb37-368" aria-hidden="true" tabindex="-1"></a><span class="co"># Name the list so it carries through</span></span>
<span id="cb37-369"><a href="#cb37-369" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vonbert_species) <span class="ot">&lt;-</span> vonbert_species</span>
<span id="cb37-370"><a href="#cb37-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-371"><a href="#cb37-371" aria-hidden="true" tabindex="-1"></a><span class="do">##### Reorganize species data into the list, and make group id for later</span></span>
<span id="cb37-372"><a href="#cb37-372" aria-hidden="true" tabindex="-1"></a>vonbert_species_agedat <span class="ot">&lt;-</span>  <span class="fu">map_dfr</span>(vonbert_species, <span class="cf">function</span>(species_name){</span>
<span id="cb37-373"><a href="#cb37-373" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to the vonbert species</span></span>
<span id="cb37-374"><a href="#cb37-374" aria-hidden="true" tabindex="-1"></a>  regime_dat <span class="sc">%&gt;%</span></span>
<span id="cb37-375"><a href="#cb37-375" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> species_name) <span class="sc">%&gt;%</span> </span>
<span id="cb37-376"><a href="#cb37-376" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group_id =</span> <span class="fu">str_c</span>(regime, comname, <span class="at">sep =</span> <span class="st">"-"</span>)) </span>
<span id="cb37-377"><a href="#cb37-377" aria-hidden="true" tabindex="-1"></a>}, <span class="at">.id =</span> <span class="st">"common name"</span>) </span>
<span id="cb37-378"><a href="#cb37-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-379"><a href="#cb37-379" aria-hidden="true" tabindex="-1"></a><span class="co"># Species we want panels for:</span></span>
<span id="cb37-380"><a href="#cb37-380" aria-hidden="true" tabindex="-1"></a>key_species <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(</span>
<span id="cb37-381"><a href="#cb37-381" aria-hidden="true" tabindex="-1"></a>  <span class="st">"american plaice"</span>,</span>
<span id="cb37-382"><a href="#cb37-382" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic cod"</span>,</span>
<span id="cb37-383"><a href="#cb37-383" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic herring"</span>,</span>
<span id="cb37-384"><a href="#cb37-384" aria-hidden="true" tabindex="-1"></a>  <span class="st">"butterfish"</span>,</span>
<span id="cb37-385"><a href="#cb37-385" aria-hidden="true" tabindex="-1"></a>  <span class="st">"haddock"</span>, </span>
<span id="cb37-386"><a href="#cb37-386" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pollock"</span>,</span>
<span id="cb37-387"><a href="#cb37-387" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scup"</span>,</span>
<span id="cb37-388"><a href="#cb37-388" aria-hidden="true" tabindex="-1"></a>  <span class="st">"silver hake"</span>,</span>
<span id="cb37-389"><a href="#cb37-389" aria-hidden="true" tabindex="-1"></a>  <span class="st">"summer flounder"</span>,</span>
<span id="cb37-390"><a href="#cb37-390" aria-hidden="true" tabindex="-1"></a>  <span class="st">"winter flounder"</span>,</span>
<span id="cb37-391"><a href="#cb37-391" aria-hidden="true" tabindex="-1"></a>  <span class="st">"yellowtail flounder"</span></span>
<span id="cb37-392"><a href="#cb37-392" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb37-393"><a href="#cb37-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-394"><a href="#cb37-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-395"><a href="#cb37-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-396"><a href="#cb37-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth by Temperature Regime</span></span>
<span id="cb37-397"><a href="#cb37-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-398"><a href="#cb37-398" aria-hidden="true" tabindex="-1"></a>To assess the impact of an elevated temperature regime, the size-at-age data was grouped into decadal periods relating to the shift in surface temperature regimes (2000-2009 &amp; 2010-2019). Growth in fishes is commonly modeled using the "Von-Bertalanffy" growth function (VBGF) to capture how a fishes size (length or weight) changes with age. For each species the growth was modeled by fitting the VGBF to the length distribution-at-age.</span>
<span id="cb37-399"><a href="#cb37-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-400"><a href="#cb37-400" aria-hidden="true" tabindex="-1"></a>$$L_t~=~L_{\infty}(1-e^{-K(t-t_0)})$$</span>
<span id="cb37-401"><a href="#cb37-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-402"><a href="#cb37-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-403"><a href="#cb37-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-404"><a href="#cb37-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-407"><a href="#cb37-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-408"><a href="#cb37-408" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the function for nls() to solve</span></span>
<span id="cb37-409"><a href="#cb37-409" aria-hidden="true" tabindex="-1"></a>vb <span class="ot">&lt;-</span> <span class="fu">vbFuns</span>(<span class="at">param=</span><span class="st">"Typical"</span>) </span>
<span id="cb37-410"><a href="#cb37-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-411"><a href="#cb37-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-412"><a href="#cb37-412" aria-hidden="true" tabindex="-1"></a>**Single Species Example**</span>
<span id="cb37-413"><a href="#cb37-413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r vonbert test example}</span></span>
<span id="cb37-414"><a href="#cb37-414" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval = FALSE,</span></span>
<span id="cb37-415"><a href="#cb37-415" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb37-416"><a href="#cb37-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-417"><a href="#cb37-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-418"><a href="#cb37-418" aria-hidden="true" tabindex="-1"></a><span class="do">####  What a single model fitting looks like  ####</span></span>
<span id="cb37-419"><a href="#cb37-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-420"><a href="#cb37-420" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb37-421"><a href="#cb37-421" aria-hidden="true" tabindex="-1"></a>test_dat <span class="ot">&lt;-</span> <span class="fu">filter</span>(vonbert_species_agedat, comname <span class="sc">==</span> <span class="st">"haddock"</span>)</span>
<span id="cb37-422"><a href="#cb37-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-423"><a href="#cb37-423" aria-hidden="true" tabindex="-1"></a><span class="co"># Get starting points from all data</span></span>
<span id="cb37-424"><a href="#cb37-424" aria-hidden="true" tabindex="-1"></a>test_starts <span class="ot">&lt;-</span>  <span class="fu">vbStarts</span>(length_cm <span class="sc">~</span> age, </span>
<span id="cb37-425"><a href="#cb37-425" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> test_dat)</span>
<span id="cb37-426"><a href="#cb37-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-427"><a href="#cb37-427" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the von bert</span></span>
<span id="cb37-428"><a href="#cb37-428" aria-hidden="true" tabindex="-1"></a>test_vbert_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb37-429"><a href="#cb37-429" aria-hidden="true" tabindex="-1"></a>  length_cm <span class="sc">~</span> <span class="fu">vb</span>(age, Linf, K, t0),</span>
<span id="cb37-430"><a href="#cb37-430" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> test_dat,</span>
<span id="cb37-431"><a href="#cb37-431" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> test_starts)</span>
<span id="cb37-432"><a href="#cb37-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-433"><a href="#cb37-433" aria-hidden="true" tabindex="-1"></a><span class="co"># Access parameters with coef()</span></span>
<span id="cb37-434"><a href="#cb37-434" aria-hidden="true" tabindex="-1"></a>test_vbert_coef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">coef</span>(test_vbert_fit)))</span>
<span id="cb37-435"><a href="#cb37-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-436"><a href="#cb37-436" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Summary Info (For convergence and std. error)</span></span>
<span id="cb37-437"><a href="#cb37-437" aria-hidden="true" tabindex="-1"></a>t_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(test_vbert_fit)</span>
<span id="cb37-438"><a href="#cb37-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-439"><a href="#cb37-439" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters w/ Standard Error</span></span>
<span id="cb37-440"><a href="#cb37-440" aria-hidden="true" tabindex="-1"></a>t_params <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(<span class="fu">as.data.frame</span>(t_sum<span class="sc">$</span>parameters), <span class="at">var =</span> <span class="st">"parameter"</span>)</span>
<span id="cb37-441"><a href="#cb37-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-442"><a href="#cb37-442" aria-hidden="true" tabindex="-1"></a><span class="co"># Convergence Info</span></span>
<span id="cb37-443"><a href="#cb37-443" aria-hidden="true" tabindex="-1"></a>t_sum<span class="sc">$</span>convInfo<span class="sc">$</span>isConv</span>
<span id="cb37-444"><a href="#cb37-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-445"><a href="#cb37-445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-446"><a href="#cb37-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-447"><a href="#cb37-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-448"><a href="#cb37-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-449"><a href="#cb37-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-450"><a href="#cb37-450" aria-hidden="true" tabindex="-1"></a>**Model Output Collector**</span>
<span id="cb37-451"><a href="#cb37-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-454"><a href="#cb37-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-455"><a href="#cb37-455" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to Pull Vonbert Coefficients, </span></span>
<span id="cb37-456"><a href="#cb37-456" aria-hidden="true" tabindex="-1"></a><span class="co"># In development: boot strapped intervals</span></span>
<span id="cb37-457"><a href="#cb37-457" aria-hidden="true" tabindex="-1"></a>vonbert_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(length_age_dat, start_points, <span class="at">min_obs =</span> <span class="dv">20</span>){</span>
<span id="cb37-458"><a href="#cb37-458" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-459"><a href="#cb37-459" aria-hidden="true" tabindex="-1"></a>  <span class="do">####  Von Bert Fitting Using: {FSA}  ####</span></span>
<span id="cb37-460"><a href="#cb37-460" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Don't run on fewer than a minimum number of observations</span></span>
<span id="cb37-461"><a href="#cb37-461" aria-hidden="true" tabindex="-1"></a>  num_aged <span class="ot">&lt;-</span> <span class="fu">nrow</span>(length_age_dat)</span>
<span id="cb37-462"><a href="#cb37-462" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-463"><a href="#cb37-463" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If number aged less than the minimum observations:</span></span>
<span id="cb37-464"><a href="#cb37-464" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fill output with NA's, but preserve structure to build table</span></span>
<span id="cb37-465"><a href="#cb37-465" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_aged <span class="sc">&lt;</span> min_obs){</span>
<span id="cb37-466"><a href="#cb37-466" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-467"><a href="#cb37-467" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataframe structure for coefficients</span></span>
<span id="cb37-468"><a href="#cb37-468" aria-hidden="true" tabindex="-1"></a>    na_coef_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-469"><a href="#cb37-469" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Linf"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb37-470"><a href="#cb37-470" aria-hidden="true" tabindex="-1"></a>      <span class="st">"K"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb37-471"><a href="#cb37-471" aria-hidden="true" tabindex="-1"></a>      <span class="st">"t0"</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb37-472"><a href="#cb37-472" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-473"><a href="#cb37-473" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dataframe structure for parameters</span></span>
<span id="cb37-474"><a href="#cb37-474" aria-hidden="true" tabindex="-1"></a>    na_param_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-475"><a href="#cb37-475" aria-hidden="true" tabindex="-1"></a>      <span class="st">"parameter"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb37-476"><a href="#cb37-476" aria-hidden="true" tabindex="-1"></a>      <span class="st">"estimate"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb37-477"><a href="#cb37-477" aria-hidden="true" tabindex="-1"></a>      <span class="st">"std_error"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb37-478"><a href="#cb37-478" aria-hidden="true" tabindex="-1"></a>      <span class="st">"t_value"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb37-479"><a href="#cb37-479" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pr_t"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb37-480"><a href="#cb37-480" aria-hidden="true" tabindex="-1"></a>      <span class="st">"converged"</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb37-481"><a href="#cb37-481" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-482"><a href="#cb37-482" aria-hidden="true" tabindex="-1"></a>    <span class="co"># What to return when it fails/aborts:</span></span>
<span id="cb37-483"><a href="#cb37-483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"model"</span>  <span class="ot">=</span> <span class="cn">NA</span>, </span>
<span id="cb37-484"><a href="#cb37-484" aria-hidden="true" tabindex="-1"></a>                <span class="st">"coef"</span>   <span class="ot">=</span> na_df, </span>
<span id="cb37-485"><a href="#cb37-485" aria-hidden="true" tabindex="-1"></a>                <span class="st">"params"</span> <span class="ot">=</span> na_param_df))</span>
<span id="cb37-486"><a href="#cb37-486" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-487"><a href="#cb37-487" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># Close conditional for sample size</span></span>
<span id="cb37-488"><a href="#cb37-488" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-489"><a href="#cb37-489" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-490"><a href="#cb37-490" aria-hidden="true" tabindex="-1"></a>  <span class="do">####  Fitting Model When Sample Size is Sufficient  ####</span></span>
<span id="cb37-491"><a href="#cb37-491" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-492"><a href="#cb37-492" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use nls to estimate VBGF parameters using starting points</span></span>
<span id="cb37-493"><a href="#cb37-493" aria-hidden="true" tabindex="-1"></a>  vbert_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(length_cm <span class="sc">~</span> <span class="fu">vb</span>(age, Linf, K, t0),</span>
<span id="cb37-494"><a href="#cb37-494" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> length_age_dat,</span>
<span id="cb37-495"><a href="#cb37-495" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> start_points)</span>
<span id="cb37-496"><a href="#cb37-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-497"><a href="#cb37-497" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Access parameters with coef()</span></span>
<span id="cb37-498"><a href="#cb37-498" aria-hidden="true" tabindex="-1"></a>  vbert_coef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">coef</span>(vbert_fit)))</span>
<span id="cb37-499"><a href="#cb37-499" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-500"><a href="#cb37-500" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-501"><a href="#cb37-501" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get Summary Info (For convergence and std. error)</span></span>
<span id="cb37-502"><a href="#cb37-502" aria-hidden="true" tabindex="-1"></a>  vbert_summ <span class="ot">&lt;-</span> <span class="fu">summary</span>(vbert_fit)</span>
<span id="cb37-503"><a href="#cb37-503" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-504"><a href="#cb37-504" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convergence Info</span></span>
<span id="cb37-505"><a href="#cb37-505" aria-hidden="true" tabindex="-1"></a>  vbert_conv <span class="ot">&lt;-</span> vbert_summ<span class="sc">$</span>convInfo<span class="sc">$</span>isConv</span>
<span id="cb37-506"><a href="#cb37-506" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-507"><a href="#cb37-507" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parameters w/ Standard Error</span></span>
<span id="cb37-508"><a href="#cb37-508" aria-hidden="true" tabindex="-1"></a>  vbert_params <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(vbert_summ<span class="sc">$</span>parameters) <span class="sc">%&gt;%</span> </span>
<span id="cb37-509"><a href="#cb37-509" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-510"><a href="#cb37-510" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb37-511"><a href="#cb37-511" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-512"><a href="#cb37-512" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add convergence information in</span></span>
<span id="cb37-513"><a href="#cb37-513" aria-hidden="true" tabindex="-1"></a>  vbert_params<span class="sc">$</span>converged <span class="ot">&lt;-</span> vbert_conv</span>
<span id="cb37-514"><a href="#cb37-514" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-515"><a href="#cb37-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-516"><a href="#cb37-516" aria-hidden="true" tabindex="-1"></a>  <span class="do">####  Work in Progress / Debugging  ####</span></span>
<span id="cb37-517"><a href="#cb37-517" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This section fails, can't find namespace/object "length_age_dat"</span></span>
<span id="cb37-518"><a href="#cb37-518" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Use bootstrapping for confidence intervals:</span></span>
<span id="cb37-519"><a href="#cb37-519" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vbert_boot &lt;- Boot(vbert_fit)  # Be patient! Be aware of some non-convergence</span></span>
<span id="cb37-520"><a href="#cb37-520" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vbert_conf &lt;- confint(vbert_boot)</span></span>
<span id="cb37-521"><a href="#cb37-521" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-522"><a href="#cb37-522" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output list</span></span>
<span id="cb37-523"><a href="#cb37-523" aria-hidden="true" tabindex="-1"></a>  out_l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb37-524"><a href="#cb37-524" aria-hidden="true" tabindex="-1"></a>    <span class="st">"model"</span> <span class="ot">=</span> vbert_fit,</span>
<span id="cb37-525"><a href="#cb37-525" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coef"</span>  <span class="ot">=</span> vbert_coef,</span>
<span id="cb37-526"><a href="#cb37-526" aria-hidden="true" tabindex="-1"></a>    <span class="st">"params"</span> <span class="ot">=</span> vbert_params<span class="co">#,</span></span>
<span id="cb37-527"><a href="#cb37-527" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"conf"  = vbert_conf</span></span>
<span id="cb37-528"><a href="#cb37-528" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-529"><a href="#cb37-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-530"><a href="#cb37-530" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the list</span></span>
<span id="cb37-531"><a href="#cb37-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out_l)</span>
<span id="cb37-532"><a href="#cb37-532" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-533"><a href="#cb37-533" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-534"><a href="#cb37-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-535"><a href="#cb37-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-536"><a href="#cb37-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-537"><a href="#cb37-537" aria-hidden="true" tabindex="-1"></a>**Wrapper for estimation function**</span>
<span id="cb37-538"><a href="#cb37-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-541"><a href="#cb37-541" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-542"><a href="#cb37-542" aria-hidden="true" tabindex="-1"></a><span class="co"># Second Function for running that for a single Species, split by a factor column</span></span>
<span id="cb37-543"><a href="#cb37-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-544"><a href="#cb37-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Function does these things:</span></span>
<span id="cb37-545"><a href="#cb37-545" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. grab data for one species</span></span>
<span id="cb37-546"><a href="#cb37-546" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Get starting points for VB using all data on that species</span></span>
<span id="cb37-547"><a href="#cb37-547" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fit Vonbert to  both Regimes</span></span>
<span id="cb37-548"><a href="#cb37-548" aria-hidden="true" tabindex="-1"></a>process_group_vbert <span class="ot">&lt;-</span> <span class="cf">function</span>(spec_name, split_col, min_obs){</span>
<span id="cb37-549"><a href="#cb37-549" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-550"><a href="#cb37-550" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the data using the species</span></span>
<span id="cb37-551"><a href="#cb37-551" aria-hidden="true" tabindex="-1"></a>  spec_dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(vonbert_species_agedat, comname <span class="sc">==</span> spec_name)</span>
<span id="cb37-552"><a href="#cb37-552" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-553"><a href="#cb37-553" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get starting points from all data</span></span>
<span id="cb37-554"><a href="#cb37-554" aria-hidden="true" tabindex="-1"></a>  test_starts <span class="ot">&lt;-</span>  <span class="fu">vbStarts</span>(length_cm <span class="sc">~</span> age, </span>
<span id="cb37-555"><a href="#cb37-555" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> spec_dat)</span>
<span id="cb37-556"><a href="#cb37-556" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-557"><a href="#cb37-557" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get coefficients for groups</span></span>
<span id="cb37-558"><a href="#cb37-558" aria-hidden="true" tabindex="-1"></a>  spec_dat <span class="sc">%&gt;%</span> </span>
<span id="cb37-559"><a href="#cb37-559" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(.[split_col]) <span class="sc">%&gt;%</span> </span>
<span id="cb37-560"><a href="#cb37-560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="at">.f =</span> vonbert_coef,</span>
<span id="cb37-561"><a href="#cb37-561" aria-hidden="true" tabindex="-1"></a>            <span class="at">start_points =</span> test_starts, </span>
<span id="cb37-562"><a href="#cb37-562" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_obs =</span> min_obs) <span class="sc">%&gt;%</span> </span>
<span id="cb37-563"><a href="#cb37-563" aria-hidden="true" tabindex="-1"></a>    <span class="co"># map_dfr(pluck, "coef", .id = split_col) %&gt;%  # Pull  out just the coefficients</span></span>
<span id="cb37-564"><a href="#cb37-564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(pluck, <span class="st">"params"</span>, <span class="at">.id =</span> split_col) <span class="sc">%&gt;%</span>  <span class="co"># Pull out the parameters and stderr</span></span>
<span id="cb37-565"><a href="#cb37-565" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comname =</span> spec_name)</span>
<span id="cb37-566"><a href="#cb37-566" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-567"><a href="#cb37-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-568"><a href="#cb37-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-569"><a href="#cb37-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-570"><a href="#cb37-570" aria-hidden="true" tabindex="-1"></a>**Processing Coeficients**</span>
<span id="cb37-571"><a href="#cb37-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-574"><a href="#cb37-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-575"><a href="#cb37-575" aria-hidden="true" tabindex="-1"></a><span class="co"># Running Each Species * Regime</span></span>
<span id="cb37-576"><a href="#cb37-576" aria-hidden="true" tabindex="-1"></a>species_coef <span class="ot">&lt;-</span> vonbert_species <span class="sc">%&gt;%</span> </span>
<span id="cb37-577"><a href="#cb37-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){</span>
<span id="cb37-578"><a href="#cb37-578" aria-hidden="true" tabindex="-1"></a>    <span class="fu">process_group_vbert</span>(</span>
<span id="cb37-579"><a href="#cb37-579" aria-hidden="true" tabindex="-1"></a>      <span class="at">spec_name =</span> x, </span>
<span id="cb37-580"><a href="#cb37-580" aria-hidden="true" tabindex="-1"></a>      <span class="at">split_col =</span>  <span class="st">"regime"</span>, </span>
<span id="cb37-581"><a href="#cb37-581" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_obs =</span> <span class="dv">30</span>)</span>
<span id="cb37-582"><a href="#cb37-582" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-583"><a href="#cb37-583" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-584"><a href="#cb37-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-585"><a href="#cb37-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-586"><a href="#cb37-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-587"><a href="#cb37-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-588"><a href="#cb37-588" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth Impacts on Productivity</span></span>
<span id="cb37-589"><a href="#cb37-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-590"><a href="#cb37-590" aria-hidden="true" tabindex="-1"></a>Yield-per-recruit analysis similar to Baudron et al. 2014?</span>
<span id="cb37-591"><a href="#cb37-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-592"><a href="#cb37-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-593"><a href="#cb37-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-594"><a href="#cb37-594" aria-hidden="true" tabindex="-1"></a><span class="fu"># Results</span></span>
<span id="cb37-595"><a href="#cb37-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-596"><a href="#cb37-596" aria-hidden="true" tabindex="-1"></a><span class="fu">## Temperature Regime Shift</span></span>
<span id="cb37-597"><a href="#cb37-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-600"><a href="#cb37-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-601"><a href="#cb37-601" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull the whole area's temps</span></span>
<span id="cb37-602"><a href="#cb37-602" aria-hidden="true" tabindex="-1"></a>survey_temps <span class="ot">&lt;-</span> <span class="fu">filter</span>(temp_regimes, survey_area <span class="sc">==</span> <span class="st">"Full Region"</span>)</span>
<span id="cb37-603"><a href="#cb37-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-604"><a href="#cb37-604" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull the regime averages out</span></span>
<span id="cb37-605"><a href="#cb37-605" aria-hidden="true" tabindex="-1"></a>regime_avgs <span class="ot">&lt;-</span> survey_temps <span class="sc">%&gt;%</span> </span>
<span id="cb37-606"><a href="#cb37-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(regime, avg_temp_c, avg_anom_c, temp_label) </span>
<span id="cb37-607"><a href="#cb37-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-608"><a href="#cb37-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the regime averages separately for in text values</span></span>
<span id="cb37-609"><a href="#cb37-609" aria-hidden="true" tabindex="-1"></a>regime_1 <span class="ot">&lt;-</span> regime_avgs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>)</span>
<span id="cb37-610"><a href="#cb37-610" aria-hidden="true" tabindex="-1"></a>regime_2 <span class="ot">&lt;-</span> regime_avgs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(regime <span class="sc">==</span> <span class="st">"2010-2021 Average"</span>)</span>
<span id="cb37-611"><a href="#cb37-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-612"><a href="#cb37-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-613"><a href="#cb37-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions developed in 10_change_points.R</span></span>
<span id="cb37-614"><a href="#cb37-614" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bcp)</span>
<span id="cb37-615"><a href="#cb37-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-616"><a href="#cb37-616" aria-hidden="true" tabindex="-1"></a><span class="co"># run bcp and flag changepoints using threshold</span></span>
<span id="cb37-617"><a href="#cb37-617" aria-hidden="true" tabindex="-1"></a>flag_bcp <span class="ot">&lt;-</span> <span class="cf">function</span>(response_var,  </span>
<span id="cb37-618"><a href="#cb37-618" aria-hidden="true" tabindex="-1"></a>                     <span class="at">predictor_var =</span> <span class="cn">NULL</span>, </span>
<span id="cb37-619"><a href="#cb37-619" aria-hidden="true" tabindex="-1"></a>                     id_var, </span>
<span id="cb37-620"><a href="#cb37-620" aria-hidden="true" tabindex="-1"></a>                     <span class="at">burnin =</span> <span class="dv">10000</span>,</span>
<span id="cb37-621"><a href="#cb37-621" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mcmc =</span> <span class="dv">10000</span>, </span>
<span id="cb37-622"><a href="#cb37-622" aria-hidden="true" tabindex="-1"></a>                     <span class="at">return.mcmc =</span> T, </span>
<span id="cb37-623"><a href="#cb37-623" aria-hidden="true" tabindex="-1"></a>                     <span class="at">threshold_prob =</span> <span class="fl">0.3</span>){</span>
<span id="cb37-624"><a href="#cb37-624" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb37-625"><a href="#cb37-625" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use bcp to find support for change points</span></span>
<span id="cb37-626"><a href="#cb37-626" aria-hidden="true" tabindex="-1"></a>  bcp_x <span class="ot">&lt;-</span> <span class="fu">bcp</span>(<span class="at">y =</span> response_var, </span>
<span id="cb37-627"><a href="#cb37-627" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> predictor_var, </span>
<span id="cb37-628"><a href="#cb37-628" aria-hidden="true" tabindex="-1"></a>               <span class="at">burnin =</span> burnin, </span>
<span id="cb37-629"><a href="#cb37-629" aria-hidden="true" tabindex="-1"></a>               <span class="at">mcmc =</span> mcmc, </span>
<span id="cb37-630"><a href="#cb37-630" aria-hidden="true" tabindex="-1"></a>               <span class="at">return.mcmc =</span> return.mcmc)</span>
<span id="cb37-631"><a href="#cb37-631" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-632"><a href="#cb37-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sink</span>(<span class="st">"/dev/null"</span>)</span>
<span id="cb37-633"><a href="#cb37-633" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert summary to a dataframe</span></span>
<span id="cb37-634"><a href="#cb37-634" aria-hidden="true" tabindex="-1"></a>  bcp_sum <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(bcp_x))</span>
<span id="cb37-635"><a href="#cb37-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sink</span>()</span>
<span id="cb37-636"><a href="#cb37-636" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-637"><a href="#cb37-637" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Label the id variable</span></span>
<span id="cb37-638"><a href="#cb37-638" aria-hidden="true" tabindex="-1"></a>  bcp_sum<span class="sc">$</span>id <span class="ot">&lt;-</span> id_var</span>
<span id="cb37-639"><a href="#cb37-639" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-640"><a href="#cb37-640" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Only pull records with support above desired threshold</span></span>
<span id="cb37-641"><a href="#cb37-641" aria-hidden="true" tabindex="-1"></a>  flag_dat <span class="ot">&lt;-</span> bcp_sum[<span class="fu">which</span>(bcp_x<span class="sc">$</span>posterior.prob <span class="sc">&gt;</span> threshold_prob), ]</span>
<span id="cb37-642"><a href="#cb37-642" aria-hidden="true" tabindex="-1"></a>  flag_dat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(flag_dat)</span>
<span id="cb37-643"><a href="#cb37-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(flag_dat)</span>
<span id="cb37-644"><a href="#cb37-644" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-645"><a href="#cb37-645" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-646"><a href="#cb37-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-647"><a href="#cb37-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-648"><a href="#cb37-648" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed</span></span>
<span id="cb37-649"><a href="#cb37-649" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3905</span>)</span>
<span id="cb37-650"><a href="#cb37-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-651"><a href="#cb37-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-652"><a href="#cb37-652" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform BCP regions temp breakpoints</span></span>
<span id="cb37-653"><a href="#cb37-653" aria-hidden="true" tabindex="-1"></a>anom_bcp <span class="ot">&lt;-</span> <span class="fu">flag_bcp</span>(<span class="at">response_var =</span> survey_temps<span class="sc">$</span>sst_anom, </span>
<span id="cb37-654"><a href="#cb37-654" aria-hidden="true" tabindex="-1"></a>                     <span class="at">id_var =</span> survey_temps<span class="sc">$</span>yr, </span>
<span id="cb37-655"><a href="#cb37-655" aria-hidden="true" tabindex="-1"></a>                     <span class="at">threshold_prob =</span> <span class="fl">0.3</span>)</span>
<span id="cb37-656"><a href="#cb37-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-657"><a href="#cb37-657" aria-hidden="true" tabindex="-1"></a><span class="co"># in-text values</span></span>
<span id="cb37-658"><a href="#cb37-658" aria-hidden="true" tabindex="-1"></a>prob_text <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">round</span>(anom_bcp<span class="sc">$</span>Probability <span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>), <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb37-659"><a href="#cb37-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-660"><a href="#cb37-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-661"><a href="#cb37-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-662"><a href="#cb37-662" aria-hidden="true" tabindex="-1"></a>SST anomaly time series of the region indicate a jump in annual temperature anomalies indicative of a regime shift centered around 2010. A bayesian change point analysis showed highest support for a regime shift among <span class="in">`r nrow(anom_bcp)`</span> the years: 2009-2011. Change point probabilities for these years were <span class="in">`r prob_text`</span>% respectively.</span>
<span id="cb37-663"><a href="#cb37-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-666"><a href="#cb37-666" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-667"><a href="#cb37-667" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot bcp breaks, highlighting their support</span></span>
<span id="cb37-668"><a href="#cb37-668" aria-hidden="true" tabindex="-1"></a>plot_bcp_breaks <span class="ot">&lt;-</span> <span class="cf">function</span>(bcp_data, </span>
<span id="cb37-669"><a href="#cb37-669" aria-hidden="true" tabindex="-1"></a>                            bcp_breaks, </span>
<span id="cb37-670"><a href="#cb37-670" aria-hidden="true" tabindex="-1"></a>                            region_label, </span>
<span id="cb37-671"><a href="#cb37-671" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y_label =</span> <span class="st">"sizeSpectra Exponent (b)"</span>,</span>
<span id="cb37-672"><a href="#cb37-672" aria-hidden="true" tabindex="-1"></a>                            <span class="at">y_col =</span> <span class="st">"b"</span>){</span>
<span id="cb37-673"><a href="#cb37-673" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-674"><a href="#cb37-674" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set label elevation</span></span>
<span id="cb37-675"><a href="#cb37-675" aria-hidden="true" tabindex="-1"></a>  label_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">as.data.frame</span>(bcp_data)[, y_col], <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb37-676"><a href="#cb37-676" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-677"><a href="#cb37-677" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot with breakpoint</span></span>
<span id="cb37-678"><a href="#cb37-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(bcp_data, <span class="fu">aes_string</span>(<span class="st">"yr"</span>, y_col)) <span class="sc">+</span> </span>
<span id="cb37-679"><a href="#cb37-679" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb37-680"><a href="#cb37-680" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb37-681"><a href="#cb37-681" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">data =</span> bcp_breaks, <span class="fu">aes</span>(<span class="at">xintercept =</span> id), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb37-682"><a href="#cb37-682" aria-hidden="true" tabindex="-1"></a>    ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> bcp_breaks, </span>
<span id="cb37-683"><a href="#cb37-683" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">aes</span>(<span class="at">x =</span> id, <span class="at">y =</span> label_y, <span class="at">label =</span> <span class="fu">str_c</span>(<span class="fu">round</span>(Probability, <span class="dv">2</span>), <span class="st">"%"</span>))) <span class="sc">+</span></span>
<span id="cb37-684"><a href="#cb37-684" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, </span>
<span id="cb37-685"><a href="#cb37-685" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> y_label, </span>
<span id="cb37-686"><a href="#cb37-686" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="fu">str_c</span>(region_label, <span class="st">" - Bayesian Change Points"</span>))</span>
<span id="cb37-687"><a href="#cb37-687" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-688"><a href="#cb37-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-689"><a href="#cb37-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-690"><a href="#cb37-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-691"><a href="#cb37-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-692"><a href="#cb37-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-693"><a href="#cb37-693" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the bcp breaks for the Sea surface temperature anomalies</span></span>
<span id="cb37-694"><a href="#cb37-694" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bcp_breaks</span>(<span class="at">bcp_data =</span> survey_temps, </span>
<span id="cb37-695"><a href="#cb37-695" aria-hidden="true" tabindex="-1"></a>                <span class="at">bcp_breaks =</span> anom_bcp, </span>
<span id="cb37-696"><a href="#cb37-696" aria-hidden="true" tabindex="-1"></a>                <span class="at">y_label =</span> <span class="st">"Temperature Anomalies"</span>, </span>
<span id="cb37-697"><a href="#cb37-697" aria-hidden="true" tabindex="-1"></a>                <span class="at">region_label =</span> <span class="st">"Northeastern US Continental Shelf"</span>, </span>
<span id="cb37-698"><a href="#cb37-698" aria-hidden="true" tabindex="-1"></a>                <span class="at">y_col =</span> <span class="st">"sst_anom"</span>)</span>
<span id="cb37-699"><a href="#cb37-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-700"><a href="#cb37-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-701"><a href="#cb37-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-702"><a href="#cb37-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-703"><a href="#cb37-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-704"><a href="#cb37-704" aria-hidden="true" tabindex="-1"></a>Average temperatures following a break in 2010, during the period of 2010-2021, were on average 1.09°C warmer than the than the average over the previous 28 years from 1982-2009. Temperatures within each regime were relatively stable, indicative of a jump in mean temperatures rather than rate change between them.</span>
<span id="cb37-705"><a href="#cb37-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-706"><a href="#cb37-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-707"><a href="#cb37-707" aria-hidden="true" tabindex="-1"></a><span class="in">```{r temp regimes}</span></span>
<span id="cb37-708"><a href="#cb37-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-709"><a href="#cb37-709" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot how each one exhibits a break in the temperature across the region</span></span>
<span id="cb37-710"><a href="#cb37-710" aria-hidden="true" tabindex="-1"></a>temp_regimes <span class="sc">%&gt;%</span> </span>
<span id="cb37-711"><a href="#cb37-711" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(survey_area <span class="sc">==</span> <span class="st">"Full Region"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-712"><a href="#cb37-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(yr, sst_anom)) <span class="sc">+</span></span>
<span id="cb37-713"><a href="#cb37-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> regime),  <span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb37-714"><a href="#cb37-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb37-715"><a href="#cb37-715" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using geomtextpath for label</span></span>
<span id="cb37-716"><a href="#cb37-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textpath</span>(</span>
<span id="cb37-717"><a href="#cb37-717" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> yr, </span>
<span id="cb37-718"><a href="#cb37-718" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> avg_anom_c, </span>
<span id="cb37-719"><a href="#cb37-719" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> temp_label, </span>
<span id="cb37-720"><a href="#cb37-720" aria-hidden="true" tabindex="-1"></a>        <span class="at">linecolor =</span> regime,</span>
<span id="cb37-721"><a href="#cb37-721" aria-hidden="true" tabindex="-1"></a>        <span class="at">colour =</span> regime), </span>
<span id="cb37-722"><a href="#cb37-722" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">4</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb37-723"><a href="#cb37-723" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line segments for the regime averages:</span></span>
<span id="cb37-724"><a href="#cb37-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb37-725"><a href="#cb37-725" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb37-726"><a href="#cb37-726" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> xend,</span>
<span id="cb37-727"><a href="#cb37-727" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> avg_anom_c, </span>
<span id="cb37-728"><a href="#cb37-728" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> avg_anom_c,</span>
<span id="cb37-729"><a href="#cb37-729" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> regime),</span>
<span id="cb37-730"><a href="#cb37-730" aria-hidden="true" tabindex="-1"></a>    <span class="co">#key_glyph = "rect",</span></span>
<span id="cb37-731"><a href="#cb37-731" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">8</span>,</span>
<span id="cb37-732"><a href="#cb37-732" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-733"><a href="#cb37-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>))) <span class="sc">+</span></span>
<span id="cb37-734"><a href="#cb37-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">suffix =</span> <span class="st">" \u00b0C"</span>)) <span class="sc">+</span></span>
<span id="cb37-735"><a href="#cb37-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>() <span class="sc">+</span></span>
<span id="cb37-736"><a href="#cb37-736" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb37-737"><a href="#cb37-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-738"><a href="#cb37-738" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-739"><a href="#cb37-739" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb37-740"><a href="#cb37-740" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb37-741"><a href="#cb37-741" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"transparent"</span>)) <span class="sc">+</span> </span>
<span id="cb37-742"><a href="#cb37-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-743"><a href="#cb37-743" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Northwest-Atlantic Temperature Regime Shift"</span>,</span>
<span id="cb37-744"><a href="#cb37-744" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb37-745"><a href="#cb37-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Surface Temperature Anomaly"</span>,</span>
<span id="cb37-746"><a href="#cb37-746" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Anomalies calculated using 1982-2011 reference period."</span>) <span class="sc">+</span></span>
<span id="cb37-747"><a href="#cb37-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">label =</span> <span class="st">"none"</span>,</span>
<span id="cb37-748"><a href="#cb37-748" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>), ))</span>
<span id="cb37-749"><a href="#cb37-749" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb37-750"><a href="#cb37-750" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-751"><a href="#cb37-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-752"><a href="#cb37-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-753"><a href="#cb37-753" aria-hidden="true" tabindex="-1"></a><span class="fu">## Distribution Shifts</span></span>
<span id="cb37-754"><a href="#cb37-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-755"><a href="#cb37-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-758"><a href="#cb37-758" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-759"><a href="#cb37-759" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 8</span></span>
<span id="cb37-760"><a href="#cb37-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb37-761"><a href="#cb37-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-762"><a href="#cb37-762" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the values for each of them in a standardized format</span></span>
<span id="cb37-763"><a href="#cb37-763" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize to global benchmarks</span></span>
<span id="cb37-764"><a href="#cb37-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-765"><a href="#cb37-765" aria-hidden="true" tabindex="-1"></a><span class="co"># Latitude</span></span>
<span id="cb37-766"><a href="#cb37-766" aria-hidden="true" tabindex="-1"></a>lat_yrly <span class="ot">&lt;-</span> <span class="fu">biomass_weighted_var</span>(station_totals, decdeg_beglat, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb37-767"><a href="#cb37-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(global_benchmarks, <span class="fu">c</span>(<span class="st">"comname"</span>, <span class="st">"avg_lat"</span>, <span class="st">"lat_sd"</span>)), <span class="at">by =</span> <span class="st">"comname"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-768"><a href="#cb37-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biom_z =</span> (biom_mu <span class="sc">-</span> avg_lat) <span class="sc">/</span> lat_sd) </span>
<span id="cb37-769"><a href="#cb37-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-770"><a href="#cb37-770" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude</span></span>
<span id="cb37-771"><a href="#cb37-771" aria-hidden="true" tabindex="-1"></a>lon_yrly <span class="ot">&lt;-</span> <span class="fu">biomass_weighted_var</span>(station_totals, decdeg_beglon, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb37-772"><a href="#cb37-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(global_benchmarks, <span class="fu">c</span>(<span class="st">"comname"</span>, <span class="st">"avg_lon"</span>, <span class="st">"lon_sd"</span>)), <span class="at">by =</span> <span class="st">"comname"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-773"><a href="#cb37-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biom_z =</span> (biom_mu <span class="sc">-</span> avg_lon) <span class="sc">/</span> lon_sd) </span>
<span id="cb37-774"><a href="#cb37-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-775"><a href="#cb37-775" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom Temperature</span></span>
<span id="cb37-776"><a href="#cb37-776" aria-hidden="true" tabindex="-1"></a>t_yrly <span class="ot">&lt;-</span> <span class="fu">biomass_weighted_var</span>(station_totals, bottemp, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb37-777"><a href="#cb37-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(global_benchmarks, <span class="fu">c</span>(<span class="st">"comname"</span>, <span class="st">"avg_temp"</span>, <span class="st">"temp_sd"</span>)), <span class="at">by =</span> <span class="st">"comname"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-778"><a href="#cb37-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biom_z =</span> (biom_mu <span class="sc">-</span> avg_temp) <span class="sc">/</span> temp_sd) </span>
<span id="cb37-779"><a href="#cb37-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-780"><a href="#cb37-780" aria-hidden="true" tabindex="-1"></a><span class="co"># Depth</span></span>
<span id="cb37-781"><a href="#cb37-781" aria-hidden="true" tabindex="-1"></a>d_yrly <span class="ot">&lt;-</span> <span class="fu">biomass_weighted_var</span>(station_totals, avgdepth, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb37-782"><a href="#cb37-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(global_benchmarks, <span class="fu">c</span>(<span class="st">"comname"</span>, <span class="st">"avg_depth"</span>, <span class="st">"depth_sd"</span>)), <span class="at">by =</span> <span class="st">"comname"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-783"><a href="#cb37-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">biom_z =</span> (biom_mu <span class="sc">-</span> avg_depth) <span class="sc">/</span> depth_sd) </span>
<span id="cb37-784"><a href="#cb37-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-785"><a href="#cb37-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-786"><a href="#cb37-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-787"><a href="#cb37-787" aria-hidden="true" tabindex="-1"></a><span class="co"># Put them together in one table for heatmap</span></span>
<span id="cb37-788"><a href="#cb37-788" aria-hidden="true" tabindex="-1"></a>standardized_changes <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb37-789"><a href="#cb37-789" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Latitude"</span> <span class="ot">=</span> lat_yrly,</span>
<span id="cb37-790"><a href="#cb37-790" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Longitude"</span> <span class="ot">=</span> lon_yrly,</span>
<span id="cb37-791"><a href="#cb37-791" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bottom Temperature"</span> <span class="ot">=</span> t_yrly,</span>
<span id="cb37-792"><a href="#cb37-792" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Depth"</span> <span class="ot">=</span> d_yrly) <span class="sc">%&gt;%</span> </span>
<span id="cb37-793"><a href="#cb37-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){<span class="fu">select</span>(x, comname, est_year, var, biom_z)}, <span class="at">.id =</span> <span class="st">"var_neat"</span>)</span>
<span id="cb37-794"><a href="#cb37-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-795"><a href="#cb37-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-796"><a href="#cb37-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-797"><a href="#cb37-797" aria-hidden="true" tabindex="-1"></a><span class="co"># Organize them by their global average latitude</span></span>
<span id="cb37-798"><a href="#cb37-798" aria-hidden="true" tabindex="-1"></a>global_benchmarks <span class="ot">&lt;-</span> global_benchmarks <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">comname =</span> <span class="fu">fct_reorder</span>(<span class="at">.f =</span> comname, <span class="at">.x =</span> avg_lat, <span class="at">.fun =</span> median))</span>
<span id="cb37-799"><a href="#cb37-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-800"><a href="#cb37-800" aria-hidden="true" tabindex="-1"></a><span class="co"># Relevel the standardized changes</span></span>
<span id="cb37-801"><a href="#cb37-801" aria-hidden="true" tabindex="-1"></a>standardized_changes <span class="ot">&lt;-</span> standardized_changes <span class="sc">%&gt;%</span> </span>
<span id="cb37-802"><a href="#cb37-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">comname =</span> <span class="fu">factor</span>(comname, </span>
<span id="cb37-803"><a href="#cb37-803" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">levels</span>(global_benchmarks<span class="sc">$</span>comname)))</span>
<span id="cb37-804"><a href="#cb37-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-805"><a href="#cb37-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-806"><a href="#cb37-806" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap</span></span>
<span id="cb37-807"><a href="#cb37-807" aria-hidden="true" tabindex="-1"></a>standardized_changes <span class="sc">%&gt;%</span> </span>
<span id="cb37-808"><a href="#cb37-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, comname, <span class="at">fill =</span> biom_z)) <span class="sc">+</span></span>
<span id="cb37-809"><a href="#cb37-809" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb37-810"><a href="#cb37-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb37-811"><a href="#cb37-811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>var_neat, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">"fixed"</span>) <span class="sc">+</span></span>
<span id="cb37-812"><a href="#cb37-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb37-813"><a href="#cb37-813" aria-hidden="true" tabindex="-1"></a>                       <span class="at">oob =</span> scales<span class="sc">::</span>oob_squish,</span>
<span id="cb37-814"><a href="#cb37-814" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>), </span>
<span id="cb37-815"><a href="#cb37-815" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="sc">-</span>.<span class="dv">75</span>, <span class="dv">0</span>, .<span class="dv">75</span>, <span class="fl">1.5</span>),</span>
<span id="cb37-816"><a href="#cb37-816" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span><span class="fu">c</span>(<span class="st">"&lt;-1.5"</span>, <span class="st">"-.75"</span>, <span class="st">"0"</span>, <span class="st">".75"</span>, <span class="st">"&gt;1.5"</span>)) <span class="sc">+</span></span>
<span id="cb37-817"><a href="#cb37-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb37-818"><a href="#cb37-818" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Center of Biomass Movements Through Time"</span>,</span>
<span id="cb37-819"><a href="#cb37-819" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Center of Biomass Metric Change (z)"</span>,</span>
<span id="cb37-820"><a href="#cb37-820" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Species ordered based on center of biomass latitude across all years."</span>) <span class="sc">+</span></span>
<span id="cb37-821"><a href="#cb37-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb37-822"><a href="#cb37-822" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb37-823"><a href="#cb37-823" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">"top"</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>, <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">6</span>, <span class="st">"cm"</span>)))</span>
<span id="cb37-824"><a href="#cb37-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-825"><a href="#cb37-825" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-826"><a href="#cb37-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-827"><a href="#cb37-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-828"><a href="#cb37-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-829"><a href="#cb37-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-830"><a href="#cb37-830" aria-hidden="true" tabindex="-1"></a><span class="fu">### Center of Biomass Trends</span></span>
<span id="cb37-831"><a href="#cb37-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-832"><a href="#cb37-832" aria-hidden="true" tabindex="-1"></a>::: {panel-tabset}</span>
<span id="cb37-833"><a href="#cb37-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-834"><a href="#cb37-834" aria-hidden="true" tabindex="-1"></a><span class="fu">### Latitude</span></span>
<span id="cb37-835"><a href="#cb37-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-838"><a href="#cb37-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-839"><a href="#cb37-839" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardized Plots</span></span>
<span id="cb37-840"><a href="#cb37-840" aria-hidden="true" tabindex="-1"></a>lat_yrly <span class="sc">%&gt;%</span> </span>
<span id="cb37-841"><a href="#cb37-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, biom_z, <span class="at">group =</span> comname)) <span class="sc">+</span></span>
<span id="cb37-842"><a href="#cb37-842" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(aes(group = comname), linetype = 1, color = "gray50", size = 0.5, alpha = 0.2) +</span></span>
<span id="cb37-843"><a href="#cb37-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb37-844"><a href="#cb37-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb37-845"><a href="#cb37-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"Overall Average"</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-846"><a href="#cb37-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb37-847"><a href="#cb37-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-848"><a href="#cb37-848" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Center of Biomass Latitudes"</span>,</span>
<span id="cb37-849"><a href="#cb37-849" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly averages weighted by biomass, scaled against all-year average."</span>,</span>
<span id="cb37-850"><a href="#cb37-850" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Center of Biomass Latitude (z)"</span>,  </span>
<span id="cb37-851"><a href="#cb37-851" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb37-852"><a href="#cb37-852" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span>, </span>
<span id="cb37-853"><a href="#cb37-853" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Time Period"</span>) <span class="sc">+</span></span>
<span id="cb37-854"><a href="#cb37-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb37-855"><a href="#cb37-855" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-856"><a href="#cb37-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-857"><a href="#cb37-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-858"><a href="#cb37-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-859"><a href="#cb37-859" aria-hidden="true" tabindex="-1"></a><span class="fu">### Longitude</span></span>
<span id="cb37-860"><a href="#cb37-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-863"><a href="#cb37-863" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-864"><a href="#cb37-864" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude</span></span>
<span id="cb37-865"><a href="#cb37-865" aria-hidden="true" tabindex="-1"></a>lon_yrly <span class="sc">%&gt;%</span> </span>
<span id="cb37-866"><a href="#cb37-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, biom_z, <span class="at">group =</span> comname)) <span class="sc">+</span></span>
<span id="cb37-867"><a href="#cb37-867" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(aes(group = comname), linetype = 1, color = "gray50", size = 0.5, alpha = 0.2) +</span></span>
<span id="cb37-868"><a href="#cb37-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb37-869"><a href="#cb37-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb37-870"><a href="#cb37-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"Overall Average"</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-871"><a href="#cb37-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb37-872"><a href="#cb37-872" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_flip() +</span></span>
<span id="cb37-873"><a href="#cb37-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-874"><a href="#cb37-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Center of Biomass Longtitudes"</span>,</span>
<span id="cb37-875"><a href="#cb37-875" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly averages weighted by biomass, scaled against all-year average."</span>,</span>
<span id="cb37-876"><a href="#cb37-876" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Center of Biomass Longitude (z)"</span>,  </span>
<span id="cb37-877"><a href="#cb37-877" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb37-878"><a href="#cb37-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span>, </span>
<span id="cb37-879"><a href="#cb37-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Time Period"</span>) <span class="sc">+</span></span>
<span id="cb37-880"><a href="#cb37-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb37-881"><a href="#cb37-881" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb37-882"><a href="#cb37-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-883"><a href="#cb37-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-884"><a href="#cb37-884" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-885"><a href="#cb37-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-886"><a href="#cb37-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-887"><a href="#cb37-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-888"><a href="#cb37-888" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean Temperature</span></span>
<span id="cb37-889"><a href="#cb37-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-890"><a href="#cb37-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-893"><a href="#cb37-893" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-894"><a href="#cb37-894" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature</span></span>
<span id="cb37-895"><a href="#cb37-895" aria-hidden="true" tabindex="-1"></a>t_yrly <span class="sc">%&gt;%</span> </span>
<span id="cb37-896"><a href="#cb37-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, biom_z, <span class="at">group =</span> comname)) <span class="sc">+</span></span>
<span id="cb37-897"><a href="#cb37-897" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(aes(group = comname), linetype = 1, color = "gray50", size = 0.5, alpha = 0.2) +</span></span>
<span id="cb37-898"><a href="#cb37-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb37-899"><a href="#cb37-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb37-900"><a href="#cb37-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"Overall Average"</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-901"><a href="#cb37-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb37-902"><a href="#cb37-902" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_flip() +</span></span>
<span id="cb37-903"><a href="#cb37-903" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-904"><a href="#cb37-904" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Center of Biomass Temperature"</span>,</span>
<span id="cb37-905"><a href="#cb37-905" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly averages weighted by biomass, scaled against all-year average."</span>,</span>
<span id="cb37-906"><a href="#cb37-906" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Center of Biomass Bottom Temperature (z)"</span>,  </span>
<span id="cb37-907"><a href="#cb37-907" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb37-908"><a href="#cb37-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span>, </span>
<span id="cb37-909"><a href="#cb37-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Time Period"</span>) <span class="sc">+</span></span>
<span id="cb37-910"><a href="#cb37-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb37-911"><a href="#cb37-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-912"><a href="#cb37-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-913"><a href="#cb37-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-914"><a href="#cb37-914" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean Depth</span></span>
<span id="cb37-915"><a href="#cb37-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-916"><a href="#cb37-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-919"><a href="#cb37-919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-920"><a href="#cb37-920" aria-hidden="true" tabindex="-1"></a><span class="co"># Depth</span></span>
<span id="cb37-921"><a href="#cb37-921" aria-hidden="true" tabindex="-1"></a>d_yrly <span class="sc">%&gt;%</span> </span>
<span id="cb37-922"><a href="#cb37-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, biom_z, <span class="at">group =</span> comname)) <span class="sc">+</span></span>
<span id="cb37-923"><a href="#cb37-923" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_path(aes(group = comname), linetype = 1, color = "gray50", size = 0.5, alpha = 0.2) +</span></span>
<span id="cb37-924"><a href="#cb37-924" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb37-925"><a href="#cb37-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb37-926"><a href="#cb37-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"Overall Average"</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-927"><a href="#cb37-927" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb37-928"><a href="#cb37-928" aria-hidden="true" tabindex="-1"></a>  <span class="co">#coord_flip() +</span></span>
<span id="cb37-929"><a href="#cb37-929" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-930"><a href="#cb37-930" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Shift in Center of Biomass Depth"</span>,</span>
<span id="cb37-931"><a href="#cb37-931" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Yearly averages weighted by biomass, scaled against all-year average."</span>,</span>
<span id="cb37-932"><a href="#cb37-932" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Center of Biomass Depth (z)"</span>,  </span>
<span id="cb37-933"><a href="#cb37-933" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb37-934"><a href="#cb37-934" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Period"</span>, </span>
<span id="cb37-935"><a href="#cb37-935" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Time Period"</span>) <span class="sc">+</span></span>
<span id="cb37-936"><a href="#cb37-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb37-937"><a href="#cb37-937" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb37-938"><a href="#cb37-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-939"><a href="#cb37-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-940"><a href="#cb37-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-941"><a href="#cb37-941" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-942"><a href="#cb37-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-943"><a href="#cb37-943" aria-hidden="true" tabindex="-1"></a><span class="fu">## Changes to Growth</span></span>
<span id="cb37-944"><a href="#cb37-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-945"><a href="#cb37-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-946"><a href="#cb37-946" aria-hidden="true" tabindex="-1"></a><span class="in">```{r regime comparison data}</span></span>
<span id="cb37-947"><a href="#cb37-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-948"><a href="#cb37-948" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the first part from the previous plot:</span></span>
<span id="cb37-949"><a href="#cb37-949" aria-hidden="true" tabindex="-1"></a><span class="co"># takes each species</span></span>
<span id="cb37-950"><a href="#cb37-950" aria-hidden="true" tabindex="-1"></a><span class="co"># for age 0 - max_age, solve what the size would be based on vb fit</span></span>
<span id="cb37-951"><a href="#cb37-951" aria-hidden="true" tabindex="-1"></a>regime_curve_prep <span class="ot">&lt;-</span> <span class="cf">function</span>(spec_name){</span>
<span id="cb37-952"><a href="#cb37-952" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-953"><a href="#cb37-953" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The raw size/age data:</span></span>
<span id="cb37-954"><a href="#cb37-954" aria-hidden="true" tabindex="-1"></a>  t_dat <span class="ot">&lt;-</span> vonbert_species_agedat <span class="sc">%&gt;%</span> </span>
<span id="cb37-955"><a href="#cb37-955" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name)  </span>
<span id="cb37-956"><a href="#cb37-956" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-957"><a href="#cb37-957" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The group coefficients, augmented with x values across a range</span></span>
<span id="cb37-958"><a href="#cb37-958" aria-hidden="true" tabindex="-1"></a>  age_max <span class="ot">&lt;-</span> <span class="fu">max</span>(t_dat<span class="sc">$</span>age)</span>
<span id="cb37-959"><a href="#cb37-959" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> age_max, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb37-960"><a href="#cb37-960" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb37-961"><a href="#cb37-961" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(comname, regime, parameter, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb37-962"><a href="#cb37-962" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="st">"estimate"</span>, <span class="at">names_from =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-963"><a href="#cb37-963" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name) <span class="sc">%&gt;%</span> </span>
<span id="cb37-964"><a href="#cb37-964" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(</span>
<span id="cb37-965"><a href="#cb37-965" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Make a dataframe that covers the size range for the species</span></span>
<span id="cb37-966"><a href="#cb37-966" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-967"><a href="#cb37-967" aria-hidden="true" tabindex="-1"></a>        <span class="at">regime =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime), <span class="fu">length</span>(x_range)),</span>
<span id="cb37-968"><a href="#cb37-968" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> <span class="fu">rep</span>(x_range, <span class="fu">length</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime)))),</span>
<span id="cb37-969"><a href="#cb37-969" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"regime"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-970"><a href="#cb37-970" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb37-971"><a href="#cb37-971" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the length at age</span></span>
<span id="cb37-972"><a href="#cb37-972" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_length =</span> Linf <span class="sc">*</span> (<span class="dv">1</span>  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> K <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb37-973"><a href="#cb37-973" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-974"><a href="#cb37-974" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-975"><a href="#cb37-975" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot wider?</span></span>
<span id="cb37-976"><a href="#cb37-976" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Take the size at age from each regime and get the difference</span></span>
<span id="cb37-977"><a href="#cb37-977" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> t_coef <span class="sc">%&gt;%</span></span>
<span id="cb37-978"><a href="#cb37-978" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Linf, K, t0)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-979"><a href="#cb37-979" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"regime"</span>, <span class="at">values_from =</span> <span class="st">"pred_length"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-980"><a href="#cb37-980" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb37-981"><a href="#cb37-981" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_shift =</span> <span class="st">`</span><span class="at">Warm Regime</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>,</span>
<span id="cb37-982"><a href="#cb37-982" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_frac =</span> (growth_shift <span class="sc">/</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>),</span>
<span id="cb37-983"><a href="#cb37-983" aria-hidden="true" tabindex="-1"></a>      <span class="at">size_change  =</span> <span class="fu">ifelse</span>(growth_shift <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Increase"</span>, <span class="st">"Decrease"</span>)</span>
<span id="cb37-984"><a href="#cb37-984" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-985"><a href="#cb37-985" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-986"><a href="#cb37-986" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(t_coef)</span>
<span id="cb37-987"><a href="#cb37-987" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-988"><a href="#cb37-988" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-989"><a href="#cb37-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-990"><a href="#cb37-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-991"><a href="#cb37-991" aria-hidden="true" tabindex="-1"></a><span class="co"># Do it for all the species</span></span>
<span id="cb37-992"><a href="#cb37-992" aria-hidden="true" tabindex="-1"></a>regime_comparison <span class="ot">&lt;-</span> vonbert_species <span class="sc">%&gt;%</span> </span>
<span id="cb37-993"><a href="#cb37-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="at">.f =</span> regime_curve_prep, <span class="at">.id =</span> <span class="st">"comname"</span>)</span>
<span id="cb37-994"><a href="#cb37-994" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-995"><a href="#cb37-995" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-996"><a href="#cb37-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-997"><a href="#cb37-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-998"><a href="#cb37-998" aria-hidden="true" tabindex="-1"></a>Changes in the size-at-age growth relationship varied across species, with the majority (14/18) of the species exhibiting smaller L-infinity during the warmer temperature regime. </span>
<span id="cb37-999"><a href="#cb37-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1000"><a href="#cb37-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1003"><a href="#cb37-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-1004"><a href="#cb37-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval = TRUE,</span></span>
<span id="cb37-1005"><a href="#cb37-1005" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height = 2</span></span>
<span id="cb37-1006"><a href="#cb37-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1007"><a href="#cb37-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1008"><a href="#cb37-1008" aria-hidden="true" tabindex="-1"></a><span class="co"># Try geom_waffle to just count each species as an individual and show that they are growing to smaller sizes in new regime:</span></span>
<span id="cb37-1009"><a href="#cb37-1009" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggwaffle)</span>
<span id="cb37-1010"><a href="#cb37-1010" aria-hidden="true" tabindex="-1"></a>age_set <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb37-1011"><a href="#cb37-1011" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">waffle_iron</span>(</span>
<span id="cb37-1012"><a href="#cb37-1012" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">filter</span>(regime_comparison, age <span class="sc">==</span> age_set), </span>
<span id="cb37-1013"><a href="#cb37-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes_d</span>(<span class="at">group =</span> size_change), <span class="at">rows =</span> <span class="dv">2</span>), </span>
<span id="cb37-1014"><a href="#cb37-1014" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(x, y, <span class="at">fill =</span> <span class="fu">fct_rev</span>(group))) <span class="sc">+</span></span>
<span id="cb37-1015"><a href="#cb37-1015" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_waffle</span>() <span class="sc">+</span></span>
<span id="cb37-1016"><a href="#cb37-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_waffle</span>() <span class="sc">+</span></span>
<span id="cb37-1017"><a href="#cb37-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb37-1018"><a href="#cb37-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-1019"><a href="#cb37-1019" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-1020"><a href="#cb37-1020" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-1021"><a href="#cb37-1021" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb37-1022"><a href="#cb37-1022" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb37-1023"><a href="#cb37-1023" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb37-1024"><a href="#cb37-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="fu">str_c</span>(<span class="st">"Warm Regime Growth Impacts on "</span>, age_set,<span class="st">" Body Length:"</span>))</span>
<span id="cb37-1025"><a href="#cb37-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1026"><a href="#cb37-1026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1027"><a href="#cb37-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1028"><a href="#cb37-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1029"><a href="#cb37-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1030"><a href="#cb37-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1031"><a href="#cb37-1031" aria-hidden="true" tabindex="-1"></a>The species that showed larger asymptotic lengths include the three hake species: **red hake, silver hake, &amp; white hake** as well as **Atlantic herring.** These species are all among the majority group of species that is found primarily in the Northern part of the survey area, in and around the Gulf of Maine.</span>
<span id="cb37-1032"><a href="#cb37-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1033"><a href="#cb37-1033" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height = 6}</span></span>
<span id="cb37-1034"><a href="#cb37-1034" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval = TRUE</span></span>
<span id="cb37-1035"><a href="#cb37-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1036"><a href="#cb37-1036" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape things so you can show confidence intervals here</span></span>
<span id="cb37-1037"><a href="#cb37-1037" aria-hidden="true" tabindex="-1"></a>plot_dat <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb37-1038"><a href="#cb37-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">!=</span> <span class="st">"t0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1039"><a href="#cb37-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">llim =</span> estimate <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> std_error,</span>
<span id="cb37-1040"><a href="#cb37-1040" aria-hidden="true" tabindex="-1"></a>         <span class="at">rlim =</span> estimate <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> std_error,</span>
<span id="cb37-1041"><a href="#cb37-1041" aria-hidden="true" tabindex="-1"></a>         <span class="at">residence =</span> <span class="fu">ifelse</span>(</span>
<span id="cb37-1042"><a href="#cb37-1042" aria-hidden="true" tabindex="-1"></a>           comname <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"atlantic mackerel"</span>, <span class="st">"scup"</span>, <span class="st">"black sea bass"</span>, <span class="st">"butterfish"</span>),</span>
<span id="cb37-1043"><a href="#cb37-1043" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Southern</span><span class="sc">\n</span><span class="st">Resident"</span>, </span>
<span id="cb37-1044"><a href="#cb37-1044" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Gulf of Maine</span><span class="sc">\n</span><span class="st">Resident"</span>),</span>
<span id="cb37-1045"><a href="#cb37-1045" aria-hidden="true" tabindex="-1"></a>         <span class="at">regime =</span> <span class="fu">fct_rev</span>(regime),</span>
<span id="cb37-1046"><a href="#cb37-1046" aria-hidden="true" tabindex="-1"></a>         <span class="at">comname =</span> <span class="fu">fct_rev</span>(comname))</span>
<span id="cb37-1047"><a href="#cb37-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1048"><a href="#cb37-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1049"><a href="#cb37-1049" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it</span></span>
<span id="cb37-1050"><a href="#cb37-1050" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_dat, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> comname, <span class="at">group =</span> regime, <span class="at">color =</span> regime)) <span class="sc">+</span> </span>
<span id="cb37-1051"><a href="#cb37-1051" aria-hidden="true" tabindex="-1"></a>    <span class="co"># need to nudge groups separately</span></span>
<span id="cb37-1052"><a href="#cb37-1052" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Early Regime</span></span>
<span id="cb37-1053"><a href="#cb37-1053" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">data =</span> <span class="fu">filter</span>(plot_dat, regime <span class="sc">==</span> <span class="st">"Early Regime"</span>), </span>
<span id="cb37-1054"><a href="#cb37-1054" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> llim, <span class="at">xend =</span> rlim, <span class="at">yend =</span> comname), </span>
<span id="cb37-1055"><a href="#cb37-1055" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb37-1056"><a href="#cb37-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span> <span class="fu">filter</span>(plot_dat, regime <span class="sc">==</span> <span class="st">"Warm Regime"</span>), </span>
<span id="cb37-1057"><a href="#cb37-1057" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> llim, <span class="at">xend =</span> rlim, <span class="at">yend =</span> comname), </span>
<span id="cb37-1058"><a href="#cb37-1058" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb37-1059"><a href="#cb37-1059" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb37-1060"><a href="#cb37-1060" aria-hidden="true" tabindex="-1"></a>    <span class="co">#facet_grid(. ~ parameter, scales = "free", space = "free_y") +</span></span>
<span id="cb37-1061"><a href="#cb37-1061" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(residence <span class="sc">~</span> parameter, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb37-1062"><a href="#cb37-1062" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>(<span class="at">reverse =</span> F) <span class="sc">+</span></span>
<span id="cb37-1063"><a href="#cb37-1063" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient Estimate"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Temperature Regime:"</span>) <span class="sc">+</span></span>
<span id="cb37-1064"><a href="#cb37-1064" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb37-1065"><a href="#cb37-1065" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb37-1066"><a href="#cb37-1066" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),</span>
<span id="cb37-1067"><a href="#cb37-1067" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>))</span>
<span id="cb37-1068"><a href="#cb37-1068" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1069"><a href="#cb37-1069" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1070"><a href="#cb37-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1071"><a href="#cb37-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1072"><a href="#cb37-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1073"><a href="#cb37-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1074"><a href="#cb37-1074" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height = 6}</span></span>
<span id="cb37-1075"><a href="#cb37-1075" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval = FALSE</span></span>
<span id="cb37-1076"><a href="#cb37-1076" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Everything</span></span>
<span id="cb37-1077"><a href="#cb37-1077" aria-hidden="true" tabindex="-1"></a>species_coef <span class="sc">%&gt;%</span></span>
<span id="cb37-1078"><a href="#cb37-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(comname, regime, parameter, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1079"><a href="#cb37-1079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">"estimate"</span>), <span class="at">names_from =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1080"><a href="#cb37-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"vbcoef"</span>, </span>
<span id="cb37-1081"><a href="#cb37-1081" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"val"</span>, </span>
<span id="cb37-1082"><a href="#cb37-1082" aria-hidden="true" tabindex="-1"></a>               <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"K"</span>, <span class="st">"Linf"</span>, <span class="st">"t0"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1083"><a href="#cb37-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(vbcoef <span class="sc">!=</span> <span class="st">"t0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1084"><a href="#cb37-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residence =</span> <span class="fu">ifelse</span>(comname <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"atlantic mackerel"</span>, <span class="st">"scup"</span>, <span class="st">"black sea bass"</span>, <span class="st">"butterfish"</span>), <span class="st">"Southern</span><span class="sc">\n</span><span class="st">Resident"</span>, <span class="st">"Gulf of Maine</span><span class="sc">\n</span><span class="st">Resident"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1085"><a href="#cb37-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> val, <span class="at">y =</span> <span class="fu">fct_rev</span>(comname), <span class="at">fill =</span> <span class="fu">fct_rev</span>(regime))) <span class="sc">+</span></span>
<span id="cb37-1086"><a href="#cb37-1086" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb37-1087"><a href="#cb37-1087" aria-hidden="true" tabindex="-1"></a>    <span class="co"># facet_grid(. ~ vbcoef, scales = "free", space = "free_y") +</span></span>
<span id="cb37-1088"><a href="#cb37-1088" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(residence <span class="sc">~</span> vbcoef, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb37-1089"><a href="#cb37-1089" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb37-1090"><a href="#cb37-1090" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient Estimate"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Temperature Regime:"</span>) <span class="sc">+</span></span>
<span id="cb37-1091"><a href="#cb37-1091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb37-1092"><a href="#cb37-1092" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb37-1093"><a href="#cb37-1093" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),</span>
<span id="cb37-1094"><a href="#cb37-1094" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>))</span>
<span id="cb37-1095"><a href="#cb37-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1096"><a href="#cb37-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1097"><a href="#cb37-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">## Changes in $L_\infty$</span></span>
<span id="cb37-1098"><a href="#cb37-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1099"><a href="#cb37-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1102"><a href="#cb37-1102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-1103"><a href="#cb37-1103" aria-hidden="true" tabindex="-1"></a>species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb37-1104"><a href="#cb37-1104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(comname, regime, parameter, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1105"><a href="#cb37-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="st">"estimate"</span>, <span class="at">names_from =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1106"><a href="#cb37-1106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regime_2 =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"Early Regime"</span>, <span class="st">"early"</span>, <span class="st">"warm"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1107"><a href="#cb37-1107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(comname, regime_2, Linf) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1108"><a href="#cb37-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> Linf, <span class="at">names_from =</span> regime_2) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1109"><a href="#cb37-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">linf_diff =</span> warm <span class="sc">-</span> early,</span>
<span id="cb37-1110"><a href="#cb37-1110" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_perc =</span> (linf_diff <span class="sc">/</span> early) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1111"><a href="#cb37-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1112"><a href="#cb37-1112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(diff_perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1113"><a href="#cb37-1113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"Common Name"</span>, <span class="st">"Early Regime Linf"</span>, <span class="st">"Warm Regime Linf"</span>, <span class="st">"Change in Linf"</span>, <span class="st">"Percent Change"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1114"><a href="#cb37-1114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span>
<span id="cb37-1115"><a href="#cb37-1115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1116"><a href="#cb37-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1117"><a href="#cb37-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1118"><a href="#cb37-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1119"><a href="#cb37-1119" aria-hidden="true" tabindex="-1"></a><span class="fu">## VB Fits to Data:</span></span>
<span id="cb37-1120"><a href="#cb37-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1123"><a href="#cb37-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-1124"><a href="#cb37-1124" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the plot for each species</span></span>
<span id="cb37-1125"><a href="#cb37-1125" aria-hidden="true" tabindex="-1"></a>vb_fits_plot <span class="ot">=</span> <span class="cf">function</span>(spec_name){</span>
<span id="cb37-1126"><a href="#cb37-1126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-1127"><a href="#cb37-1127" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The raw size/age data:</span></span>
<span id="cb37-1128"><a href="#cb37-1128" aria-hidden="true" tabindex="-1"></a>  t_dat <span class="ot">&lt;-</span> vonbert_species_agedat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name)  </span>
<span id="cb37-1129"><a href="#cb37-1129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1130"><a href="#cb37-1130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The group coefficients, augmented with x values across a range</span></span>
<span id="cb37-1131"><a href="#cb37-1131" aria-hidden="true" tabindex="-1"></a>  age_max <span class="ot">&lt;-</span> <span class="fu">max</span>(t_dat<span class="sc">$</span>age)</span>
<span id="cb37-1132"><a href="#cb37-1132" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> age_max, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb37-1133"><a href="#cb37-1133" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb37-1134"><a href="#cb37-1134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(comname, regime, parameter, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1135"><a href="#cb37-1135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="st">"estimate"</span>, <span class="at">names_from =</span> <span class="st">"parameter"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1136"><a href="#cb37-1136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1137"><a href="#cb37-1137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(</span>
<span id="cb37-1138"><a href="#cb37-1138" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-1139"><a href="#cb37-1139" aria-hidden="true" tabindex="-1"></a>        <span class="at">regime =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime), <span class="fu">length</span>(x_range)),</span>
<span id="cb37-1140"><a href="#cb37-1140" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> <span class="fu">rep</span>(x_range, <span class="fu">length</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime)))),</span>
<span id="cb37-1141"><a href="#cb37-1141" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"regime"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1142"><a href="#cb37-1142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb37-1143"><a href="#cb37-1143" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the length at age</span></span>
<span id="cb37-1144"><a href="#cb37-1144" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_length =</span> Linf <span class="sc">*</span> (<span class="dv">1</span>  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> K <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb37-1145"><a href="#cb37-1145" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-1146"><a href="#cb37-1146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1147"><a href="#cb37-1147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1148"><a href="#cb37-1148" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make plot?</span></span>
<span id="cb37-1149"><a href="#cb37-1149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(t_dat, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> length_cm)) <span class="sc">+</span></span>
<span id="cb37-1150"><a href="#cb37-1150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb37-1151"><a href="#cb37-1151" aria-hidden="true" tabindex="-1"></a>    <span class="co">#facet_wrap(~regime, ncol = 1) +</span></span>
<span id="cb37-1152"><a href="#cb37-1152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> t_coef,</span>
<span id="cb37-1153"><a href="#cb37-1153" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred_length, <span class="at">group =</span> regime, <span class="at">color =</span> regime), </span>
<span id="cb37-1154"><a href="#cb37-1154" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-1155"><a href="#cb37-1155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, age_max, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb37-1156"><a href="#cb37-1156" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, age_max),</span>
<span id="cb37-1157"><a href="#cb37-1157" aria-hidden="true" tabindex="-1"></a>                       <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, .<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb37-1158"><a href="#cb37-1158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>() <span class="sc">+</span></span>
<span id="cb37-1159"><a href="#cb37-1159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="at">data =</span> t_coef, </span>
<span id="cb37-1160"><a href="#cb37-1160" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred_length, <span class="at">label =</span> regime, <span class="at">color =</span> regime), </span>
<span id="cb37-1161"><a href="#cb37-1161" aria-hidden="true" tabindex="-1"></a>            <span class="at">method=</span> <span class="fu">list</span>(<span class="st">"last.qp"</span>, <span class="at">cex =</span> <span class="fl">0.65</span>, <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">15</span>),</span>
<span id="cb37-1162"><a href="#cb37-1162" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb37-1163"><a href="#cb37-1163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb37-1164"><a href="#cb37-1164" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Length (cm)"</span>,</span>
<span id="cb37-1165"><a href="#cb37-1165" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> spec_name,</span>
<span id="cb37-1166"><a href="#cb37-1166" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Temperature Regime:"</span>,</span>
<span id="cb37-1167"><a href="#cb37-1167" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Length at Age Regimes"</span>)</span>
<span id="cb37-1168"><a href="#cb37-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1169"><a href="#cb37-1169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-1170"><a href="#cb37-1170" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-1171"><a href="#cb37-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1172"><a href="#cb37-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1173"><a href="#cb37-1173" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb37-1174"><a href="#cb37-1174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results="asis", fig.height = 6}</span></span>
<span id="cb37-1175"><a href="#cb37-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1176"><a href="#cb37-1176" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb37-1177"><a href="#cb37-1177" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, </span>
<span id="cb37-1178"><a href="#cb37-1178" aria-hidden="true" tabindex="-1"></a>     plot_panelset, </span>
<span id="cb37-1179"><a href="#cb37-1179" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot_fun =</span> vb_fits_plot)</span>
<span id="cb37-1180"><a href="#cb37-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1181"><a href="#cb37-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1182"><a href="#cb37-1182" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-1183"><a href="#cb37-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1184"><a href="#cb37-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1185"><a href="#cb37-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1186"><a href="#cb37-1186" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discussion</span></span>
<span id="cb37-1187"><a href="#cb37-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1188"><a href="#cb37-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1189"><a href="#cb37-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1190"><a href="#cb37-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1191"><a href="#cb37-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1192"><a href="#cb37-1192" aria-hidden="true" tabindex="-1"></a>--- </span>
<span id="cb37-1193"><a href="#cb37-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1194"><a href="#cb37-1194" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bonus: Data Explorations</span></span>
<span id="cb37-1195"><a href="#cb37-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1196"><a href="#cb37-1196" aria-hidden="true" tabindex="-1"></a><span class="fu">## Age Data Availability</span></span>
<span id="cb37-1197"><a href="#cb37-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1198"><a href="#cb37-1198" aria-hidden="true" tabindex="-1"></a>The availability of age data varied by species and through time, with older ages becoming less frequently sampled in recent years across many species.</span>
<span id="cb37-1199"><a href="#cb37-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1200"><a href="#cb37-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ridgeplot fun}</span></span>
<span id="cb37-1201"><a href="#cb37-1201" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting age distribution as ggridges</span></span>
<span id="cb37-1202"><a href="#cb37-1202" aria-hidden="true" tabindex="-1"></a>plot_age_ridgeplot <span class="ot">&lt;-</span> <span class="cf">function</span>(species){</span>
<span id="cb37-1203"><a href="#cb37-1203" aria-hidden="true" tabindex="-1"></a>  vonbert_species_agedat <span class="sc">%&gt;%</span> </span>
<span id="cb37-1204"><a href="#cb37-1204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> species,</span>
<span id="cb37-1205"><a href="#cb37-1205" aria-hidden="true" tabindex="-1"></a>           age <span class="sc">&lt;=</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1206"><a href="#cb37-1206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">yr =</span> <span class="fu">factor</span>(est_year),</span>
<span id="cb37-1207"><a href="#cb37-1207" aria-hidden="true" tabindex="-1"></a>           <span class="at">yr =</span> <span class="fu">fct_rev</span>(yr)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1208"><a href="#cb37-1208" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> yr)) <span class="sc">+</span></span>
<span id="cb37-1209"><a href="#cb37-1209" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density_ridges</span>(<span class="fu">aes</span>(<span class="at">fill =</span> regime), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb37-1210"><a href="#cb37-1210" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb37-1211"><a href="#cb37-1211" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>comname) <span class="sc">+</span></span>
<span id="cb37-1212"><a href="#cb37-1212" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), </span>
<span id="cb37-1213"><a href="#cb37-1213" aria-hidden="true" tabindex="-1"></a>                         <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb37-1214"><a href="#cb37-1214" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb37-1215"><a href="#cb37-1215" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title.position =</span> <span class="st">"top"</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb37-1216"><a href="#cb37-1216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1217"><a href="#cb37-1217" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-1218"><a href="#cb37-1218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1219"><a href="#cb37-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1220"><a href="#cb37-1220" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb37-1221"><a href="#cb37-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ridge panels, results="asis", fig.height=8}</span></span>
<span id="cb37-1222"><a href="#cb37-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1223"><a href="#cb37-1223" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb37-1224"><a href="#cb37-1224" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_age_ridgeplot)</span>
<span id="cb37-1225"><a href="#cb37-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1226"><a href="#cb37-1226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1227"><a href="#cb37-1227" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-1228"><a href="#cb37-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1229"><a href="#cb37-1229" aria-hidden="true" tabindex="-1"></a>Strong age classes were particularly prominent in the following species, showing lasting numbers in subsequent years.</span>
<span id="cb37-1230"><a href="#cb37-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1231"><a href="#cb37-1231" aria-hidden="true" tabindex="-1"></a>| Species          | Strong Year Classes |</span>
<span id="cb37-1232"><a href="#cb37-1232" aria-hidden="true" tabindex="-1"></a>|------------------|---------------------|</span>
<span id="cb37-1233"><a href="#cb37-1233" aria-hidden="true" tabindex="-1"></a>| Atlantic Cod     | 2003, 2013          |</span>
<span id="cb37-1234"><a href="#cb37-1234" aria-hidden="true" tabindex="-1"></a>| Haddock          | 2003, 2010, 2013    |</span>
<span id="cb37-1235"><a href="#cb37-1235" aria-hidden="true" tabindex="-1"></a>| Atlantic Herring | 2008, 2011          |</span>
<span id="cb37-1236"><a href="#cb37-1236" aria-hidden="true" tabindex="-1"></a>| Pollock          | 2000, 2012          |</span>
<span id="cb37-1237"><a href="#cb37-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1238"><a href="#cb37-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1239"><a href="#cb37-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1240"><a href="#cb37-1240" aria-hidden="true" tabindex="-1"></a><span class="fu">## Growth Increment Changes</span></span>
<span id="cb37-1241"><a href="#cb37-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1242"><a href="#cb37-1242" aria-hidden="true" tabindex="-1"></a>Annual Growth increments for each species were computed to track the change in growth of specific age-groups through time.</span>
<span id="cb37-1243"><a href="#cb37-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1246"><a href="#cb37-1246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-1247"><a href="#cb37-1247" aria-hidden="true" tabindex="-1"></a><span class="co"># Age-Size Increments Differences</span></span>
<span id="cb37-1248"><a href="#cb37-1248" aria-hidden="true" tabindex="-1"></a>vb_incs <span class="ot">&lt;-</span> vonbert_species_agedat <span class="sc">%&gt;%</span> </span>
<span id="cb37-1249"><a href="#cb37-1249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, est_year,  age, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1250"><a href="#cb37-1250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_len =</span> <span class="fu">mean</span>(length_cm, <span class="at">na.rm =</span> T),</span>
<span id="cb37-1251"><a href="#cb37-1251" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_wt  =</span> <span class="fu">mean</span>(indwt, <span class="at">na.rm =</span> T),</span>
<span id="cb37-1252"><a href="#cb37-1252" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1253"><a href="#cb37-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, age) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1254"><a href="#cb37-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1255"><a href="#cb37-1255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){</span>
<span id="cb37-1256"><a href="#cb37-1256" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%&gt;%</span> </span>
<span id="cb37-1257"><a href="#cb37-1257" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb37-1258"><a href="#cb37-1258" aria-hidden="true" tabindex="-1"></a>        <span class="co"># What age is being subtracted from</span></span>
<span id="cb37-1259"><a href="#cb37-1259" aria-hidden="true" tabindex="-1"></a>        <span class="at">lead_age   =</span> <span class="fu">lead</span>(age, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb37-1260"><a href="#cb37-1260" aria-hidden="true" tabindex="-1"></a>        <span class="co"># String built from the value to confirm</span></span>
<span id="cb37-1261"><a href="#cb37-1261" aria-hidden="true" tabindex="-1"></a>        <span class="at">diff_name  =</span> <span class="fu">str_c</span>(age, <span class="st">" - "</span>, lead_age),</span>
<span id="cb37-1262"><a href="#cb37-1262" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Length/Weight at age + 1</span></span>
<span id="cb37-1263"><a href="#cb37-1263" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_age_p1 =</span> <span class="fu">lead</span>(avg_len, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb37-1264"><a href="#cb37-1264" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_age_p1  =</span> <span class="fu">lead</span>(avg_wt, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb37-1265"><a href="#cb37-1265" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Length/Weight Growth Increments</span></span>
<span id="cb37-1266"><a href="#cb37-1266" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_inc    =</span> len_age_p1 <span class="sc">-</span> avg_len,</span>
<span id="cb37-1267"><a href="#cb37-1267" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_inc     =</span> wt_age_p1 <span class="sc">-</span> avg_wt,</span>
<span id="cb37-1268"><a href="#cb37-1268" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Percent change in bodymass for going from age to age+1</span></span>
<span id="cb37-1269"><a href="#cb37-1269" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_perc_change =</span> (len_inc <span class="sc">/</span> avg_len) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb37-1270"><a href="#cb37-1270" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_perc_change =</span> (wt_inc <span class="sc">/</span> avg_wt) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1271"><a href="#cb37-1271" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>((lead_age <span class="sc">-</span> age <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb37-1272"><a href="#cb37-1272" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-1273"><a href="#cb37-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1274"><a href="#cb37-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1275"><a href="#cb37-1275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1276"><a href="#cb37-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1277"><a href="#cb37-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1278"><a href="#cb37-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1279"><a href="#cb37-1279" aria-hidden="true" tabindex="-1"></a>Age specific growth (annual growth increments) help detail where in a species life cycle it may be experiencing favorable or less-favorable conditions for growth. These can be a result of differences in habitat use or prey resources at different ages, and/or a change in exposure to temperature or other stressors that inflict a metabolic cost.</span>
<span id="cb37-1280"><a href="#cb37-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1283"><a href="#cb37-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-1284"><a href="#cb37-1284" aria-hidden="true" tabindex="-1"></a><span class="co"># Put together a timeseries of:</span></span>
<span id="cb37-1285"><a href="#cb37-1285" aria-hidden="true" tabindex="-1"></a><span class="co"># how big were the age 0's,</span></span>
<span id="cb37-1286"><a href="#cb37-1286" aria-hidden="true" tabindex="-1"></a><span class="co"># how big were the age 1's</span></span>
<span id="cb37-1287"><a href="#cb37-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1288"><a href="#cb37-1288" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Age Increments</span></span>
<span id="cb37-1289"><a href="#cb37-1289" aria-hidden="true" tabindex="-1"></a>plot_age_increments <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb37-1290"><a href="#cb37-1290" aria-hidden="true" tabindex="-1"></a>    spec_choice, </span>
<span id="cb37-1291"><a href="#cb37-1291" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_choice =</span> <span class="st">"length"</span>, </span>
<span id="cb37-1292"><a href="#cb37-1292" aria-hidden="true" tabindex="-1"></a>    <span class="at">gam_knots =</span> <span class="dv">15</span>, </span>
<span id="cb37-1293"><a href="#cb37-1293" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_prefix =</span> <span class="st">"Age Increment: "</span>,</span>
<span id="cb37-1294"><a href="#cb37-1294" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_suffix =</span> <span class="st">""</span>){</span>
<span id="cb37-1295"><a href="#cb37-1295" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1296"><a href="#cb37-1296" aria-hidden="true" tabindex="-1"></a><span class="co"># Code to switch variables and their labels:</span></span>
<span id="cb37-1297"><a href="#cb37-1297" aria-hidden="true" tabindex="-1"></a>  var_sym <span class="ot">&lt;-</span> <span class="cf">switch</span>(var_choice,</span>
<span id="cb37-1298"><a href="#cb37-1298" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"len_inc"</span>),</span>
<span id="cb37-1299"><a href="#cb37-1299" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"wt_inc"</span>))</span>
<span id="cb37-1300"><a href="#cb37-1300" aria-hidden="true" tabindex="-1"></a>  var_label <span class="ot">&lt;-</span> <span class="cf">switch</span>(var_choice,</span>
<span id="cb37-1301"><a href="#cb37-1301" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"length"</span> <span class="ot">=</span> <span class="st">"Annual Growth  (cm)"</span>,</span>
<span id="cb37-1302"><a href="#cb37-1302" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"weight"</span> <span class="ot">=</span> <span class="st">"Annual Growth  (kg)"</span>)</span>
<span id="cb37-1303"><a href="#cb37-1303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1304"><a href="#cb37-1304" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1305"><a href="#cb37-1305" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add pre/suffix to facet labels</span></span>
<span id="cb37-1306"><a href="#cb37-1306" aria-hidden="true" tabindex="-1"></a>  appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">prefix =</span> facet_prefix, <span class="at">suffix =</span> facet_suffix) {</span>
<span id="cb37-1307"><a href="#cb37-1307" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(prefix, string)}</span>
<span id="cb37-1308"><a href="#cb37-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1309"><a href="#cb37-1309" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the plot</span></span>
<span id="cb37-1310"><a href="#cb37-1310" aria-hidden="true" tabindex="-1"></a>  vb_incs <span class="sc">%&gt;%</span> </span>
<span id="cb37-1311"><a href="#cb37-1311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span> <span class="sc">==</span> spec_choice,</span>
<span id="cb37-1312"><a href="#cb37-1312" aria-hidden="true" tabindex="-1"></a>           lead_age <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1313"><a href="#cb37-1313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>({{var_sym}}) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1314"><a href="#cb37-1314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, {{var_sym}})) <span class="sc">+</span></span>
<span id="cb37-1315"><a href="#cb37-1315" aria-hidden="true" tabindex="-1"></a>      <span class="co"># geom_col(fill = gmri_cols("gmri blue")) +</span></span>
<span id="cb37-1316"><a href="#cb37-1316" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"gmri blue"</span>)) <span class="sc">+</span></span>
<span id="cb37-1317"><a href="#cb37-1317" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"gmri blue"</span>), <span class="at">group =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb37-1318"><a href="#cb37-1318" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>,</span>
<span id="cb37-1319"><a href="#cb37-1319" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">k =</span> gam_knots),</span>
<span id="cb37-1320"><a href="#cb37-1320" aria-hidden="true" tabindex="-1"></a>                  <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-1321"><a href="#cb37-1321" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb37-1322"><a href="#cb37-1322" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb37-1323"><a href="#cb37-1323" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>diff_name, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb37-1324"><a href="#cb37-1324" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labeller =</span> <span class="fu">as_labeller</span>(appender))  <span class="sc">+</span></span>
<span id="cb37-1325"><a href="#cb37-1325" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb37-1326"><a href="#cb37-1326" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb37-1327"><a href="#cb37-1327" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> var_label,</span>
<span id="cb37-1328"><a href="#cb37-1328" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"Age Increment"</span>,</span>
<span id="cb37-1329"><a href="#cb37-1329" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">str_to_title</span>(spec_choice),</span>
<span id="cb37-1330"><a href="#cb37-1330" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">"Changes in annual "</span>, var_choice, <span class="st">" growth increments."</span>))</span>
<span id="cb37-1331"><a href="#cb37-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1332"><a href="#cb37-1332" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-1333"><a href="#cb37-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1334"><a href="#cb37-1334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1335"><a href="#cb37-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1336"><a href="#cb37-1336" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb37-1337"><a href="#cb37-1337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results="asis", fig.height = 8}</span></span>
<span id="cb37-1338"><a href="#cb37-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1339"><a href="#cb37-1339" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb37-1340"><a href="#cb37-1340" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_age_increments, <span class="at">var_choice =</span> <span class="st">"weight"</span>, <span class="at">gam_knots =</span> <span class="dv">5</span>)</span>
<span id="cb37-1341"><a href="#cb37-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1342"><a href="#cb37-1342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1343"><a href="#cb37-1343" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-1344"><a href="#cb37-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1345"><a href="#cb37-1345" aria-hidden="true" tabindex="-1"></a><span class="fu">## Length at Age Changes</span></span>
<span id="cb37-1346"><a href="#cb37-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1347"><a href="#cb37-1347" aria-hidden="true" tabindex="-1"></a><span class="in">```{r regime size plots}</span></span>
<span id="cb37-1348"><a href="#cb37-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1349"><a href="#cb37-1349" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of Length/Weight Across Regimes </span></span>
<span id="cb37-1350"><a href="#cb37-1350" aria-hidden="true" tabindex="-1"></a>plot_regime_sizes <span class="ot">&lt;-</span> <span class="cf">function</span>(spec, </span>
<span id="cb37-1351"><a href="#cb37-1351" aria-hidden="true" tabindex="-1"></a>                              <span class="at">var =</span> <span class="st">"length"</span>, </span>
<span id="cb37-1352"><a href="#cb37-1352" aria-hidden="true" tabindex="-1"></a>                              <span class="at">age_lim =</span> <span class="dv">5</span>, </span>
<span id="cb37-1353"><a href="#cb37-1353" aria-hidden="true" tabindex="-1"></a>                              <span class="at">facet_prefix =</span> <span class="st">"Age - "</span>, </span>
<span id="cb37-1354"><a href="#cb37-1354" aria-hidden="true" tabindex="-1"></a>                              <span class="at">facet_suffix =</span> <span class="st">""</span>){</span>
<span id="cb37-1355"><a href="#cb37-1355" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1356"><a href="#cb37-1356" aria-hidden="true" tabindex="-1"></a>  <span class="co"># switches for length or width</span></span>
<span id="cb37-1357"><a href="#cb37-1357" aria-hidden="true" tabindex="-1"></a>  var_col <span class="ot">&lt;-</span> <span class="cf">switch</span> (var,</span>
<span id="cb37-1358"><a href="#cb37-1358" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"length_cm"</span>),</span>
<span id="cb37-1359"><a href="#cb37-1359" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"indwt"</span>))</span>
<span id="cb37-1360"><a href="#cb37-1360" aria-hidden="true" tabindex="-1"></a>  var_lab <span class="ot">&lt;-</span> <span class="cf">switch</span> (var,</span>
<span id="cb37-1361"><a href="#cb37-1361" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="st">"Individual Length (cm)"</span>,</span>
<span id="cb37-1362"><a href="#cb37-1362" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="st">"Individual Weight (kg)"</span>)</span>
<span id="cb37-1363"><a href="#cb37-1363" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1364"><a href="#cb37-1364" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add pre/suffix to facet labels</span></span>
<span id="cb37-1365"><a href="#cb37-1365" aria-hidden="true" tabindex="-1"></a>  appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">prefix =</span> facet_prefix, <span class="at">suffix =</span> facet_suffix) {</span>
<span id="cb37-1366"><a href="#cb37-1366" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(prefix, string)}</span>
<span id="cb37-1367"><a href="#cb37-1367" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1368"><a href="#cb37-1368" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select Ages, Prep data</span></span>
<span id="cb37-1369"><a href="#cb37-1369" aria-hidden="true" tabindex="-1"></a>  size_changes <span class="ot">&lt;-</span> regime_dat <span class="sc">%&gt;%</span> </span>
<span id="cb37-1370"><a href="#cb37-1370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb37-1371"><a href="#cb37-1371" aria-hidden="true" tabindex="-1"></a>    comname <span class="sc">==</span> spec,</span>
<span id="cb37-1372"><a href="#cb37-1372" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&lt;=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1373"><a href="#cb37-1373" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Calculate group averages</span></span>
<span id="cb37-1374"><a href="#cb37-1374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1375"><a href="#cb37-1375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-1376"><a href="#cb37-1376" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_size =</span> <span class="fu">median</span>(<span class="sc">!!</span>{{var_col}})) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1377"><a href="#cb37-1377" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() </span>
<span id="cb37-1378"><a href="#cb37-1378" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1379"><a href="#cb37-1379" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make median dataframe</span></span>
<span id="cb37-1380"><a href="#cb37-1380" aria-hidden="true" tabindex="-1"></a>  median_df <span class="ot">&lt;-</span> size_changes <span class="sc">%&gt;%</span></span>
<span id="cb37-1381"><a href="#cb37-1381" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(age, regime, median_size) <span class="sc">%&gt;%</span></span>
<span id="cb37-1382"><a href="#cb37-1382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"regime"</span>, <span class="at">values_from =</span> <span class="st">"median_size"</span>)</span>
<span id="cb37-1383"><a href="#cb37-1383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1384"><a href="#cb37-1384" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make Plot</span></span>
<span id="cb37-1385"><a href="#cb37-1385" aria-hidden="true" tabindex="-1"></a>  size_changes <span class="sc">%&gt;%</span> </span>
<span id="cb37-1386"><a href="#cb37-1386" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">!!</span>{{var_col}})) <span class="sc">+</span></span>
<span id="cb37-1387"><a href="#cb37-1387" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-1388"><a href="#cb37-1388" aria-hidden="true" tabindex="-1"></a>    <span class="do">## distribution</span></span>
<span id="cb37-1389"><a href="#cb37-1389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime, </span>
<span id="cb37-1390"><a href="#cb37-1390" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> <span class="fu">after_scale</span>(color)),</span>
<span id="cb37-1391"><a href="#cb37-1391" aria-hidden="true" tabindex="-1"></a>                 <span class="at">slab_alpha =</span> .<span class="dv">5</span>, </span>
<span id="cb37-1392"><a href="#cb37-1392" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.width =</span> <span class="dv">0</span>, </span>
<span id="cb37-1393"><a href="#cb37-1393" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trim =</span> T, </span>
<span id="cb37-1394"><a href="#cb37-1394" aria-hidden="true" tabindex="-1"></a>                 <span class="at">shape =</span> <span class="dv">21</span>, </span>
<span id="cb37-1395"><a href="#cb37-1395" aria-hidden="true" tabindex="-1"></a>                 <span class="at">point_colour =</span> <span class="st">"gray25"</span>,</span>
<span id="cb37-1396"><a href="#cb37-1396" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stroke =</span> <span class="fl">1.6</span>,</span>
<span id="cb37-1397"><a href="#cb37-1397" aria-hidden="true" tabindex="-1"></a>                 <span class="at">scale =</span> .<span class="dv">86</span>) <span class="sc">+</span></span>
<span id="cb37-1398"><a href="#cb37-1398" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-1399"><a href="#cb37-1399" aria-hidden="true" tabindex="-1"></a>    <span class="co"># median line</span></span>
<span id="cb37-1400"><a href="#cb37-1400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(</span>
<span id="cb37-1401"><a href="#cb37-1401" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> median_df,</span>
<span id="cb37-1402"><a href="#cb37-1402" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>,</span>
<span id="cb37-1403"><a href="#cb37-1403" aria-hidden="true" tabindex="-1"></a>          <span class="at">xend =</span> <span class="st">`</span><span class="at">Warm Regime</span><span class="st">`</span>,</span>
<span id="cb37-1404"><a href="#cb37-1404" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">0</span>,</span>
<span id="cb37-1405"><a href="#cb37-1405" aria-hidden="true" tabindex="-1"></a>          <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb37-1406"><a href="#cb37-1406" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">8</span>,</span>
<span id="cb37-1407"><a href="#cb37-1407" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"grey25"</span>, <span class="co"># , position = position_nudge(y = -.15)</span></span>
<span id="cb37-1408"><a href="#cb37-1408" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb37-1409"><a href="#cb37-1409" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-1410"><a href="#cb37-1410" aria-hidden="true" tabindex="-1"></a>    <span class="do">## median points - not working</span></span>
<span id="cb37-1411"><a href="#cb37-1411" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime), <span class="at">.width =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">slab_fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb37-1412"><a href="#cb37-1412" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-1413"><a href="#cb37-1413" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb37-1414"><a href="#cb37-1414" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>age, <span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb37-1415"><a href="#cb37-1415" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(appender), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb37-1416"><a href="#cb37-1416" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>() <span class="sc">+</span> </span>
<span id="cb37-1417"><a href="#cb37-1417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb37-1418"><a href="#cb37-1418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb37-1419"><a href="#cb37-1419" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb37-1420"><a href="#cb37-1420" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> var_lab,</span>
<span id="cb37-1421"><a href="#cb37-1421" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Proportion"</span>,</span>
<span id="cb37-1422"><a href="#cb37-1422" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> spec,</span>
<span id="cb37-1423"><a href="#cb37-1423" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Temperature Regime"</span>,</span>
<span id="cb37-1424"><a href="#cb37-1424" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Temperature Regime"</span>,</span>
<span id="cb37-1425"><a href="#cb37-1425" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">"Median"</span></span>
<span id="cb37-1426"><a href="#cb37-1426" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb37-1427"><a href="#cb37-1427" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1428"><a href="#cb37-1428" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-1429"><a href="#cb37-1429" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-1430"><a href="#cb37-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1431"><a href="#cb37-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1432"><a href="#cb37-1432" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester: </span></span>
<span id="cb37-1433"><a href="#cb37-1433" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_regime_sizes(key_species[[1]], var = "length")</span></span>
<span id="cb37-1434"><a href="#cb37-1434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1435"><a href="#cb37-1435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1436"><a href="#cb37-1436" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb37-1437"><a href="#cb37-1437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results="asis", fig.height = 8}</span></span>
<span id="cb37-1438"><a href="#cb37-1438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1439"><a href="#cb37-1439" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb37-1440"><a href="#cb37-1440" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_regime_sizes, <span class="at">var =</span> <span class="st">"length"</span>)</span>
<span id="cb37-1441"><a href="#cb37-1441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1442"><a href="#cb37-1442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1443"><a href="#cb37-1443" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-1444"><a href="#cb37-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1445"><a href="#cb37-1445" aria-hidden="true" tabindex="-1"></a><span class="fu">## Weight at Age Changes</span></span>
<span id="cb37-1446"><a href="#cb37-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1447"><a href="#cb37-1447" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb37-1448"><a href="#cb37-1448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results="asis", fig.height = 8}</span></span>
<span id="cb37-1449"><a href="#cb37-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1450"><a href="#cb37-1450" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb37-1451"><a href="#cb37-1451" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_regime_sizes, <span class="at">var =</span> <span class="st">"weight"</span>)</span>
<span id="cb37-1452"><a href="#cb37-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1453"><a href="#cb37-1453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1454"><a href="#cb37-1454" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb37-1455"><a href="#cb37-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1456"><a href="#cb37-1456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1457"><a href="#cb37-1457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shifts in Growth</span></span>
<span id="cb37-1458"><a href="#cb37-1458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1459"><a href="#cb37-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1460"><a href="#cb37-1460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r regime impact plot}</span></span>
<span id="cb37-1461"><a href="#cb37-1461" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height = 8,</span></span>
<span id="cb37-1462"><a href="#cb37-1462" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width = 8</span></span>
<span id="cb37-1463"><a href="#cb37-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1464"><a href="#cb37-1464" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot their growth curves</span></span>
<span id="cb37-1465"><a href="#cb37-1465" aria-hidden="true" tabindex="-1"></a>regime_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb37-1466"><a href="#cb37-1466" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(comname %in% key_species) %&gt;% </span></span>
<span id="cb37-1467"><a href="#cb37-1467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> growth_frac)) <span class="sc">+</span></span>
<span id="cb37-1468"><a href="#cb37-1468" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-1469"><a href="#cb37-1469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> comname), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"orange"</span>)<span class="sc">+</span></span>
<span id="cb37-1470"><a href="#cb37-1470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb37-1471"><a href="#cb37-1471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>comname, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb37-1472"><a href="#cb37-1472" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Shift in Length Moving to Warm Regime"</span>, </span>
<span id="cb37-1473"><a href="#cb37-1473" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Thermal Regime Impacts on Growth"</span>,</span>
<span id="cb37-1474"><a href="#cb37-1474" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Changes in Size at Age (Warm Regime - Historic Regime)"</span>) </span>
<span id="cb37-1475"><a href="#cb37-1475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1476"><a href="#cb37-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1477"><a href="#cb37-1477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1478"><a href="#cb37-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1481"><a href="#cb37-1481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-1482"><a href="#cb37-1482" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval = FALSE</span></span>
<span id="cb37-1483"><a href="#cb37-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1484"><a href="#cb37-1484" aria-hidden="true" tabindex="-1"></a><span class="co"># Kathy requested the curve data.</span></span>
<span id="cb37-1485"><a href="#cb37-1485" aria-hidden="true" tabindex="-1"></a><span class="co"># Going to save both the coefficients and the fitted data for all species</span></span>
<span id="cb37-1486"><a href="#cb37-1486" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb37-1487"><a href="#cb37-1487" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(regime_comparison, <span class="fu">here</span>(<span class="st">"data/growth_results/growth_regime_fits.csv"</span>))</span>
<span id="cb37-1488"><a href="#cb37-1488" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(species_coef, <span class="fu">here</span>(<span class="st">"data/growth_results/growth_regime_coefs.csv"</span>))</span>
<span id="cb37-1489"><a href="#cb37-1489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1490"><a href="#cb37-1490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1491"><a href="#cb37-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1494"><a href="#cb37-1494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb37-1495"><a href="#cb37-1495" aria-hidden="true" tabindex="-1"></a><span class="co"># Try horizons</span></span>
<span id="cb37-1496"><a href="#cb37-1496" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggHoriPlot)</span>
<span id="cb37-1497"><a href="#cb37-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1498"><a href="#cb37-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1499"><a href="#cb37-1499" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter outliers beyond 5th and 95th quantile</span></span>
<span id="cb37-1500"><a href="#cb37-1500" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> regime_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb37-1501"><a href="#cb37-1501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-1502"><a href="#cb37-1502" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">between</span>(</span>
<span id="cb37-1503"><a href="#cb37-1503" aria-hidden="true" tabindex="-1"></a>      growth_frac,</span>
<span id="cb37-1504"><a href="#cb37-1504" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(growth_frac, <span class="fl">0.05</span>, <span class="at">na.rm =</span> T)<span class="sc">-</span></span>
<span id="cb37-1505"><a href="#cb37-1505" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">IQR</span>(growth_frac, <span class="at">na.rm =</span> T),</span>
<span id="cb37-1506"><a href="#cb37-1506" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(growth_frac, <span class="fl">0.95</span>, <span class="at">na.rm =</span> T)<span class="sc">+</span></span>
<span id="cb37-1507"><a href="#cb37-1507" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">IQR</span>(growth_frac, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-1508"><a href="#cb37-1508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outlier)</span>
<span id="cb37-1509"><a href="#cb37-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1510"><a href="#cb37-1510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1511"><a href="#cb37-1511" aria-hidden="true" tabindex="-1"></a><span class="co"># Set origin</span></span>
<span id="cb37-1512"><a href="#cb37-1512" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-1513"><a href="#cb37-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1514"><a href="#cb37-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1515"><a href="#cb37-1515" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually pick cut points</span></span>
<span id="cb37-1516"><a href="#cb37-1516" aria-hidden="true" tabindex="-1"></a>sca <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">9</span>)</span>
<span id="cb37-1517"><a href="#cb37-1517" aria-hidden="true" tabindex="-1"></a>sca_bins <span class="ot">&lt;-</span> <span class="fu">str_c</span>(sca[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(sca)<span class="sc">-</span><span class="dv">1</span>)], <span class="st">" to "</span>, sca[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(sca)], <span class="st">"%"</span>)</span>
<span id="cb37-1518"><a href="#cb37-1518" aria-hidden="true" tabindex="-1"></a>sca_labels <span class="ot">&lt;-</span> <span class="fu">rev</span>(sca_bins)</span>
<span id="cb37-1519"><a href="#cb37-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1520"><a href="#cb37-1520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1521"><a href="#cb37-1521" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb37-1522"><a href="#cb37-1522" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(</span>
<span id="cb37-1523"><a href="#cb37-1523" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Titles</span></span>
<span id="cb37-1524"><a href="#cb37-1524" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb37-1525"><a href="#cb37-1525" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb37-1526"><a href="#cb37-1526" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>), <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb37-1527"><a href="#cb37-1527" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="st">"lines"</span>),</span>
<span id="cb37-1528"><a href="#cb37-1528" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb37-1529"><a href="#cb37-1529" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb37-1530"><a href="#cb37-1530" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Axes</span></span>
<span id="cb37-1531"><a href="#cb37-1531" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb37-1532"><a href="#cb37-1532" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.y =</span> <span class="fu">element_line</span>(), </span>
<span id="cb37-1533"><a href="#cb37-1533" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb37-1534"><a href="#cb37-1534" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), </span>
<span id="cb37-1535"><a href="#cb37-1535" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb37-1536"><a href="#cb37-1536" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb37-1537"><a href="#cb37-1537" aria-hidden="true" tabindex="-1"></a>              <span class="at">rect =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb37-1538"><a href="#cb37-1538" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Facets</span></span>
<span id="cb37-1539"><a href="#cb37-1539" aria-hidden="true" tabindex="-1"></a>              <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb37-1540"><a href="#cb37-1540" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb37-1541"><a href="#cb37-1541" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb37-1542"><a href="#cb37-1542" aria-hidden="true" tabindex="-1"></a>              <span class="at">strip.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb37-1543"><a href="#cb37-1543" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb37-1544"><a href="#cb37-1544" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb37-1545"><a href="#cb37-1545" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb37-1546"><a href="#cb37-1546" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype=</span><span class="st">"solid"</span>)))</span>
<span id="cb37-1547"><a href="#cb37-1547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1548"><a href="#cb37-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1549"><a href="#cb37-1549" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it all</span></span>
<span id="cb37-1550"><a href="#cb37-1550" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(regime_comparison, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> growth_frac)) <span class="sc">+</span></span>
<span id="cb37-1551"><a href="#cb37-1551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_horizon</span>(</span>
<span id="cb37-1552"><a href="#cb37-1552" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(age, </span>
<span id="cb37-1553"><a href="#cb37-1553" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> growth_frac,</span>
<span id="cb37-1554"><a href="#cb37-1554" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> ..Cutpoints..), </span>
<span id="cb37-1555"><a href="#cb37-1555" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin =</span> ori, </span>
<span id="cb37-1556"><a href="#cb37-1556" aria-hidden="true" tabindex="-1"></a>    <span class="at">horizonscale =</span> sca) <span class="sc">+</span></span>
<span id="cb37-1557"><a href="#cb37-1557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hcl</span>(<span class="at">palette =</span> <span class="st">'RdBu'</span>, <span class="at">reverse =</span> T, <span class="at">labels =</span> sca_labels) <span class="sc">+</span></span>
<span id="cb37-1558"><a href="#cb37-1558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(comname<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb37-1559"><a href="#cb37-1559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb37-1560"><a href="#cb37-1560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb37-1561"><a href="#cb37-1561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-1562"><a href="#cb37-1562" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Titles</span></span>
<span id="cb37-1563"><a href="#cb37-1563" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb37-1564"><a href="#cb37-1564" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb37-1565"><a href="#cb37-1565" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(</span>
<span id="cb37-1566"><a href="#cb37-1566" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>, </span>
<span id="cb37-1567"><a href="#cb37-1567" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>), </span>
<span id="cb37-1568"><a href="#cb37-1568" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb37-1569"><a href="#cb37-1569" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="st">"lines"</span>),</span>
<span id="cb37-1570"><a href="#cb37-1570" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb37-1571"><a href="#cb37-1571" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb37-1572"><a href="#cb37-1572" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Axes</span></span>
<span id="cb37-1573"><a href="#cb37-1573" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb37-1574"><a href="#cb37-1574" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb37-1575"><a href="#cb37-1575" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), </span>
<span id="cb37-1576"><a href="#cb37-1576" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb37-1577"><a href="#cb37-1577" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb37-1578"><a href="#cb37-1578" aria-hidden="true" tabindex="-1"></a>    <span class="at">rect =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb37-1579"><a href="#cb37-1579" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Facets</span></span>
<span id="cb37-1580"><a href="#cb37-1580" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb37-1581"><a href="#cb37-1581" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb37-1582"><a href="#cb37-1582" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb37-1583"><a href="#cb37-1583" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb37-1584"><a href="#cb37-1584" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb37-1585"><a href="#cb37-1585" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb37-1586"><a href="#cb37-1586" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb37-1587"><a href="#cb37-1587" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype=</span><span class="st">"solid"</span>),</span>
<span id="cb37-1588"><a href="#cb37-1588" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-1589"><a href="#cb37-1589" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing.y=</span><span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="st">"lines"</span>),</span>
<span id="cb37-1590"><a href="#cb37-1590" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb37-1591"><a href="#cb37-1591" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-1592"><a href="#cb37-1592" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-1593"><a href="#cb37-1593" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-1594"><a href="#cb37-1594" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb37-1595"><a href="#cb37-1595" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"left"</span>)  <span class="sc">+</span></span>
<span id="cb37-1596"><a href="#cb37-1596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Age'</span>, </span>
<span id="cb37-1597"><a href="#cb37-1597" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Change in Body Size at Age"</span>) <span class="sc">+</span></span>
<span id="cb37-1598"><a href="#cb37-1598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb37-1599"><a href="#cb37-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1600"><a href="#cb37-1600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1601"><a href="#cb37-1601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1602"><a href="#cb37-1602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-1603"><a href="#cb37-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1604"><a href="#cb37-1604" aria-hidden="true" tabindex="-1"></a><span class="in">`r insert_gmri_footer()`</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>