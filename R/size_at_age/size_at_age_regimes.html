<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.545">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam Kemberling">
<meta name="dcterms.date" content="2022-07-11">
<meta name="description" content="Differential Growth Rates Under Different Temperature Regimes">

<title>Size at Age Regimes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="size_at_age_regimes_files/libs/clipboard/clipboard.min.js"></script>
<script src="size_at_age_regimes_files/libs/quarto-html/quarto.js"></script>
<script src="size_at_age_regimes_files/libs/quarto-html/popper.min.js"></script>
<script src="size_at_age_regimes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="size_at_age_regimes_files/libs/quarto-html/anchor.min.js"></script>
<link href="size_at_age_regimes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="size_at_age_regimes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="size_at_age_regimes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="size_at_age_regimes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="size_at_age_regimes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<link href="size_at_age_regimes_files/libs/panelset-0.2.6/panelset.css" rel="stylesheet">
<script src="size_at_age_regimes_files/libs/panelset-0.2.6/panelset.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Size at Age Regimes</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>

<div>
  <div class="description">
    <p>Differential Growth Rates Under Different Temperature Regimes</p>
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://github.com/adamkemberling">Adam Kemberling</a> 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Gulf of Maine Research Institute
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 11, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>


<style type="text/css">/********** GMRI Rmarkdown Core Style Sheet - Do Not Modify!!! **********/


/********** Begin Style Sheet **********/

/* Avenir Font from Fonts.com for GMRI Branding */

@import url("http://fast.fonts.net/t/1.css?apiType=css&projectid=806f61f6-d695-4965-a878-820b50bc0269");
    @font-face{
        font-family:"Avenir LT W01_35 Light1475496";
        src:url("Fonts/0078f486-8e52-42c0-ad81-3c8d3d43f48e.woff2") format("woff2"),url("Fonts/908c4810-64db-4b46-bb8e-823eb41f68c0.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_35 Light_1475502";
        src:url("Fonts/a59168c1-917d-4de9-a244-0316c057c357.woff2") format("woff2"),url("Fonts/6dc0e7d8-9284-44e1-8f05-984a41daa3a4.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_45 Book1475508";
        src:url("Fonts/065a6b14-b2cc-446e-9428-271c570df0d9.woff2") format("woff2"),url("Fonts/65d75eb0-2601-4da5-a9a4-9ee67a470a59.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_45 Book O1475514";
        src:url("Fonts/476612d9-282d-4f76-95cd-b4dd31e7ed21.woff2") format("woff2"),url("Fonts/f1ebae2b-5296-4244-8771-5f40e60a564a.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_55 Roman1475520";
        src:url("Fonts/b290e775-e0f9-4980-914b-a4c32a5e3e36.woff2") format("woff2"),url("Fonts/4b978f72-bb48-46c3-909a-2a8cd2f8819c.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_55 Obliqu1475526";
        src:url("Fonts/1a7173fa-062b-49ad-9915-bc57d3bfc1f5.woff2") format("woff2"),url("Fonts/cdda031e-26e9-4269-83d1-5a218caa10db.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_65 Medium1475532";
        src:url("Fonts/17b90ef5-b63f-457b-a981-503bb7afe3c0.woff2") format("woff2"),url("Fonts/c9aeeabd-dd65-491d-b4be-3e0db9ae47a0.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_65 Medium1475538";
        src:url("Fonts/deb5e718-7abb-4df3-9365-edfa95317090.woff2") format("woff2"),url("Fonts/04801919-17ee-4c6b-8b17-eb1965cb3ed6.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_85 Heavy1475544";
        src:url("Fonts/d513e15e-8f35-4129-ad05-481815e52625.woff2") format("woff2"),url("Fonts/61bd362e-7162-46bd-b67e-28f366c4afbe.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_85 Heavy_1475550";
        src:url("Fonts/3c210c80-960f-4684-850b-25390b4d08af.woff2") format("woff2"),url("Fonts/cb5c71ad-e582-4d00-929c-67fbfaeb1c27.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_95 Black1475556";
        src:url("Fonts/c78eb7af-a1c8-4892-974b-52379646fef4.woff2") format("woff2"),url("Fonts/75b36c58-2a02-4057-a537-09af0832ae46.woff") format("woff");
    }
    @font-face{
        font-family:"Avenir LT W01_95 Black_1475562";
        src:url("Fonts/a2477e08-09d9-4d4b-97a9-23a1e22cb44c.woff2") format("woff2"),url("Fonts/19d12bba-92b1-43ad-9bab-cd36a4195c2a.woff") format("woff");
    }





/* PRE-Avenir Fonts: Lato + Raleway font import from google fonts */
@import url('https://fonts.googleapis.com/css?family=Lato');
@import url('https://fonts.googleapis.com/css?family=Raleway&display=swap');

/* add font families as needed: font-family: 'Lato', sans-serif; */


/* Level 1 Headers */
h1 { text-align: left;
     margin: 10px 0 15px 0; 
     font-size: 38px; 
     font-family: Avenir;
} 


/* Headers 2 - 6 */
h2, h3, h4, h5, h6 { 
    color: #333333; 
    margin: 20px 0 5px 0; 
    text-align: left;
    font-family: Avenir;}


/* Sizing/font For Each Header Type */
h2 { font-size: 24px; }
h3 { font-size: 20px; }
h4 { font-size: 18px; }
h5 { font-size: 16px; font-weight: normal; color: #3069aa; text-decoration: underline;}
h6 { font-size: 14px; font-weight: normal; color: #3069aa; }


/* Paragraph Text */
p, ol { margin-top: 10px; 
    font-family: 'Raleway', sans-serif;}


/* Title Author and Date Headers */
h1.title.toc-ignore {margin-top: 10px;}
h4.author, h4.date {
    color: rgb(0,115,109);
    margin-top: 0px; 
    margin-bottom: 5px; 
    font-size: 12px;}



/* Add Spacing Above Headers */
h1, .h1, h2, .h2, h3, .h3 {
    margin-top: 40px;
}


/* Links */
a {
    color: rgb(234,79,18)
}


/***********************************************/


/********  Table of Contents  **********/

/* Highlighted TOC Element */
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    z-index: 2;
    color: #fff;
    background-color: rgb(0,96,138);
    border-color: rgb(0,96,138);
}

/* Default TOC Elements */
.list-group-item, .list-group-item:focus, .list-group-item:hover {
    z-index: 2;
    color: rgb(0,96,138);
    background-color: #fff;
    border-color: rgb(0,96,138);
}


/********  Tab Panels  **********/

/* Navigation Tabs - Highlighted Tabset Pills */
.nav-pills > li.active > a, .nav-pills > li.active > a:hover, .nav-pills > li.active > a:focus {
    color: #fff;
    background-color: rgb(0,115,109) ;
    }

/* Navigation Tabs - Default Tabset Pills */
.nav-pills > li > a, .nav-pills > li > a:hover, .nav-pills > li > a:focus {
    color: rgb(0,115,109);
    background-color: #fff;
    }


/* Second Level Tabs - Active */
.nav.nav-tabs > li.active  > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {
    color: #fff;
    background-color: rgb(83,83,83) ;
    }

/* Second Level Tabs - Inactive */
.nav.nav-tabs > li  > a, .nav-tabs > li > a:hover, .nav-tabs > li > a:focus {
    color: rgb(83,83,83);
    background-color: #fff;
    }



/********** End Core Style Sheet **********/
/********** End Core Style Sheet **********/



</style>
<section id="comparing-growth-regimes-in-the-nw-atlantic" class="level2">
<h2 class="anchored" data-anchor-id="comparing-growth-regimes-in-the-nw-atlantic">Comparing Growth Regimes in the NW Atlantic</h2>
<p>Recent changes in Gulf stream positioning have altered the relative influences of the Gulf stream and Labrador current on temperature and salinity regimes for the region. Understanding that this new temperature and salinity regime should alter both the energetics of the region as well as food-web dynamics, we seek to identify whether these changes have had a measurable impact on the growth of several groundfish species.</p>
</section>
<section id="temperature-regimes" class="level2">
<h2 class="anchored" data-anchor-id="temperature-regimes">Temperature Regimes</h2>
<p>The change in thermal regimes occurred around 2010. Following this regime change, annual temperatures have been several degrees warmer than the previous 3+ decades.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the regional temperatures from {targets}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(regional_oisst))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get regional averages</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>temp_regimes <span class="ot">&lt;-</span> regional_oisst <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yr <span class="sc">&gt;</span> <span class="dv">1981</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regime =</span> <span class="fu">ifelse</span>(yr <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"1982-2009 Average"</span>, <span class="st">"2010-2021 Average"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(survey_area, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey_area =</span> <span class="fu">ifelse</span>(survey_area <span class="sc">==</span> <span class="st">"all"</span>, <span class="st">"Full Region"</span>, survey_area),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey_area =</span> <span class="fu">factor</span>(survey_area, </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Full Region"</span>, <span class="st">"GoM"</span>, <span class="st">"GB"</span>, <span class="st">"SNE"</span>, <span class="st">"MAB"</span>)),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_temp_c =</span> <span class="fu">round</span>(<span class="fu">mean</span>(sst), <span class="dv">2</span>),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_label =</span> <span class="fu">str_c</span>(avg_temp_c, <span class="st">"\u00b0C"</span>),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_anom_c =</span> <span class="fu">mean</span>(sst_anom),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_anom_c = ifelse(regime == "1982-2009 Regime", 0, avg_anom_c),</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>, <span class="fl">1981.5</span>, <span class="fl">2009.5</span>),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>, <span class="fl">2009.5</span>, <span class="fl">2021.5</span>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot how each one exhibits a break in the</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>temp_regimes <span class="sc">%&gt;%</span> </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(survey_area <span class="sc">==</span> <span class="st">"Full Region"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(yr, sst_anom)) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> regime),  <span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using geomtextpath for label</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textpath</span>(</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> yr, </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> avg_anom_c, </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> temp_label, </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">linecolor =</span> regime,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">colour =</span> regime), </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">4</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line segments for the regime averages:</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> xend,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> avg_anom_c, </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> avg_anom_c,</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> regime),</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">8</span>,</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>))) <span class="sc">+</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">suffix =</span> <span class="st">" \u00b0C"</span>)) <span class="sc">+</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>() <span class="sc">+</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"transparent"</span>)) <span class="sc">+</span> </span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Northwest-Atlantic Temperature Regime Shift"</span>,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Surface Temperature Anomaly"</span>,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Anomalies calculated using 1982-2011 reference period."</span>) <span class="sc">+</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">label =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/temp%20regimes-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="groundfish-biological-data" class="level2">
<h2 class="anchored" data-anchor-id="groundfish-biological-data">Groundfish Biological Data</h2>
<p>The data on groundfish size-at-age is obtained as part of the NEFSCâ€™s northeast trawl survey. The age data specifically is a subset of the overall catch data, the biological dataset, which contains additional information on individuals such as age/sex/histology.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access Biological Data with {targets}</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(survdat_biological))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Prepare Bio Data for Age analysis for regimes:</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NA age data, restrict to summer and fall</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>nmfs_bio <span class="ot">&lt;-</span> survdat_biological <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(age) <span class="sc">==</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         season <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Spring"</span>, <span class="st">"Fall"</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Add regime and decade labels</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>nmfs_bio <span class="ot">&lt;-</span> nmfs_bio <span class="sc">%&gt;%</span> </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearclass =</span> est_year <span class="sc">-</span> (age<span class="dv">-1</span>),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">regime =</span> <span class="fu">ifelse</span>(est_year <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"Early Regime"</span>, <span class="st">"Warm Regime"</span>),</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">decade =</span> <span class="fu">floor_decade</span>(est_year)) </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(survdat_biological)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="studying-regimes" class="level3">
<h3 class="anchored" data-anchor-id="studying-regimes">Studying Regimes</h3>
<p>To ensure enough age data is available for deriving growth characteristics, the data is grouped into regimes that match the regional temperature regimes. Despite these species living at or near the bottom, research suggests that the forces driving these thermal regimes would have far-reaching impacts biological impacts. These impacts may directly change the near-bottom environment through mixing patterns, and/or indirectly through food-web impacts.</p>
<p>Through this lens we will assess changes to body size, size-at-age, and growth characteristics derived using the von-bertalanffy growth equation.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to just the data for the two regimes</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>regime_dat <span class="ot">&lt;-</span> <span class="fu">filter</span>(nmfs_bio, est_year <span class="sc">&gt;=</span> <span class="dv">2000</span>, est_year <span class="sc">&lt;=</span> <span class="dv">2019</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="species-selected" class="level3">
<h3 class="anchored" data-anchor-id="species-selected">Species Selected</h3>
<p>The biological data is then separated into lists organized by species. The lists contain all data for a given species, broken into groups at a set interval of time. In this case it is ten-year thermal regimes we seek to compare.</p>
<p>In the original proposal it was stated that 17 species would be used, species that are regularly measured and aged. Ordering all species by the number aged we can pull out the following top species:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">####  Data Prep  #### </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank species by how many measurements there are</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>species_abunds <span class="ot">&lt;-</span> regime_dat <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(comname) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="co"># ordered by number measured</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder alphabetically</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>vonbert_species <span class="ot">&lt;-</span> <span class="fu">sort</span>(species_abunds<span class="sc">$</span>comname[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These will be the species that we assess length-at-age characteristics for our meta-analysis:</p>
<p><strong><em>acadian redfish</em>, <em>american plaice</em>, <em>atlantic cod</em>, <em>atlantic herring</em>, <em>atlantic mackerel</em>, <em>black sea bass</em>, <em>butterfish</em>, <em>haddock</em>, <em>pollock</em>, <em>red hake</em>, <em>scup</em>, <em>silver hake</em>, <em>summer flounder</em>, <em>white hake</em>, <em>winter flounder</em>, <em>witch flounder</em> and <em>yellowtail flounder</em>.</strong></p>
<p>Unfortunately; despite being major players in the regions ecology, age data is not available for spiny dogfish and other elasmobranch species.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Name the list so it carries through</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vonbert_species) <span class="ot">&lt;-</span> vonbert_species</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">##### Pull species data into the list, and make group id for later</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>all_vonbert <span class="ot">&lt;-</span>  <span class="fu">map_dfr</span>(vonbert_species, <span class="cf">function</span>(species_name){</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to the vonbert species</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  regime_dat <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> species_name) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group_id =</span> <span class="fu">str_c</span>(regime, comname, <span class="at">sep =</span> <span class="st">"-"</span>)) </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>}, <span class="at">.id =</span> <span class="st">"common name"</span>) </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Species we want panels for:</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>key_species <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"american plaice"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic cod"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic herring"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"butterfish"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"haddock"</span>, </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pollock"</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scup"</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"silver hake"</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"summer flounder"</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"winter flounder"</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"yellowtail flounder"</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="growth-increment-estimation" class="level3">
<h3 class="anchored" data-anchor-id="growth-increment-estimation">Growth Increment Estimation</h3>
<p>One aspect of growth beyond size-at-age is the annual growth between years of a specific age, or the growth increment.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Age-Size Increments Differences</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>vb_incs <span class="ot">&lt;-</span> all_vonbert <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, est_year,  age, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_len =</span> <span class="fu">mean</span>(length_cm, <span class="at">na.rm =</span> T),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_wt  =</span> <span class="fu">mean</span>(indwt, <span class="at">na.rm =</span> T),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, age) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># What age is being subtracted from</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">lead_age   =</span> <span class="fu">lead</span>(age, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># String built from the value to confirm</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">diff_name  =</span> <span class="fu">str_c</span>(age, <span class="st">" - "</span>, lead_age),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Length/Weight at age + 1</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_age_p1 =</span> <span class="fu">lead</span>(avg_len, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_age_p1  =</span> <span class="fu">lead</span>(avg_wt, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Length/Weight Growth Increments</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_inc    =</span> len_age_p1 <span class="sc">-</span> avg_len,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_inc     =</span> wt_age_p1 <span class="sc">-</span> avg_wt,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Percent change in bodymass for going from age to age+1</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_perc_change =</span> (len_inc <span class="sc">/</span> avg_len) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_perc_change =</span> (wt_inc <span class="sc">/</span> avg_wt) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>((lead_age <span class="sc">-</span> age <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="age-data-frequencies" class="level2">
<h2 class="anchored" data-anchor-id="age-data-frequencies">Age Data Frequencies</h2>
<p>Just looking at the raw data available, it becomes obvious that there are differences in the number of fish at various ages through time.</p>
<p>With cases of large cohorts passing through, or older individuals being caught less frequently. Particularly large cohorts of haddock are a good example.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting age distribution as ggridges</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plot_age_ridgeplot <span class="ot">&lt;-</span> <span class="cf">function</span>(species){</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  all_vonbert <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> species,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>           age <span class="sc">&lt;=</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">yr =</span> <span class="fu">factor</span>(est_year),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">yr =</span> <span class="fu">fct_rev</span>(yr)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> yr)) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density_ridges</span>(<span class="fu">aes</span>(<span class="at">fill =</span> regime), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>comname) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title.position =</span> <span class="st">"top"</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_age_ridgeplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/ridge%20panels-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
<p>Strong age classes were particularly prominent in the following species, showing lasting numbers in subsequent years.</p>
<table class="table">
<thead>
<tr class="header">
<th>Species</th>
<th>Strong Year Classes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Atlantic Cod</td>
<td>2003, 2013</td>
</tr>
<tr class="even">
<td>Haddock</td>
<td>2003, 2010, 2013</td>
</tr>
<tr class="odd">
<td>Atlantic Herring</td>
<td>2008, 2011</td>
</tr>
<tr class="even">
<td>Pollock</td>
<td>2000, 2012</td>
</tr>
</tbody>
</table>
</section>
<section id="growth-increment-changes" class="level1">
<h1>Growth Increment Changes</h1>
<p>Age specific growth (annual growth increments) help detail where in a species life cycle it may be experiencing favorable or less-favorable conditions for growth. These can be a result of differences in habitat use or prey resources at different ages, and/or a change in exposure to temperature or other stressors that inflict a metabolic cost.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Put together a timeseries of:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># how big were the age 0's,</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># how big were the age 1's</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Age Increments</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plot_age_increments <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    spec_choice, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_choice =</span> <span class="st">"length"</span>, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">gam_knots =</span> <span class="dv">15</span>, </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_prefix =</span> <span class="st">"Age Increment: "</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_suffix =</span> <span class="st">""</span>){</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Code to switch variables and their labels:</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  var_sym <span class="ot">&lt;-</span> <span class="cf">switch</span>(var_choice,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"len_inc"</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"wt_inc"</span>))</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  var_label <span class="ot">&lt;-</span> <span class="cf">switch</span>(var_choice,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"length"</span> <span class="ot">=</span> <span class="st">"Annual Growth  (cm)"</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"weight"</span> <span class="ot">=</span> <span class="st">"Annual Growth  (kg)"</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add pre/suffix to facet labels</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">prefix =</span> facet_prefix, <span class="at">suffix =</span> facet_suffix) {</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(prefix, string)}</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the plot</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  vb_incs <span class="sc">%&gt;%</span> </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span> <span class="sc">==</span> spec_choice,</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>           lead_age <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>({{var_sym}}) <span class="sc">%&gt;%</span> </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, {{var_sym}})) <span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="co"># geom_col(fill = gmri_cols("gmri blue")) +</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"gmri blue"</span>)) <span class="sc">+</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"gmri blue"</span>), <span class="at">group =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">k =</span> gam_knots),</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>diff_name, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labeller =</span> <span class="fu">as_labeller</span>(appender))  <span class="sc">+</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> var_label,</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"Age Increment"</span>,</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">str_to_title</span>(spec_choice),</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">"Changes in annual "</span>, var_choice, <span class="st">" growth increments."</span>))</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_age_increments, <span class="at">var_choice =</span> <span class="st">"weight"</span>, <span class="at">gam_knots =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice-1">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod-1">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring-1">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish-1">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock-1">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock-1">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup-1">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake-1">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder-1">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder-1">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder-1" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder-1">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-3-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
</section>
<section id="length-at-age-changes" class="level1">
<h1>Length at Age Changes</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of Length/Weight Across Regimes </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>plot_regime_sizes <span class="ot">&lt;-</span> <span class="cf">function</span>(spec, <span class="at">var =</span> <span class="st">"length"</span>, <span class="at">age_lim =</span> <span class="dv">5</span>, <span class="at">facet_prefix =</span> <span class="st">"Age - "</span>, <span class="at">facet_suffix =</span> <span class="st">""</span>){</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># switches for length or width</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  var_col <span class="ot">&lt;-</span> <span class="cf">switch</span> (var,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"length_cm"</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"indwt"</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  var_lab <span class="ot">&lt;-</span> <span class="cf">switch</span> (var,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="st">"Individual Length (cm)"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="st">"Individual Weight (kg)"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add pre/suffix to facet labels</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">prefix =</span> facet_prefix, <span class="at">suffix =</span> facet_suffix) {</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(prefix, string)}</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select Ages, Prep data</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  size_changes <span class="ot">&lt;-</span> regime_dat <span class="sc">%&gt;%</span> </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    comname <span class="sc">==</span> spec,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&lt;=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Calculate group averages</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_size =</span> <span class="fu">median</span>(<span class="sc">!!</span>{{var_col}})) <span class="sc">%&gt;%</span> </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make median dataframe</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  median_df <span class="ot">&lt;-</span> size_changes <span class="sc">%&gt;%</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(age, regime, median_size) <span class="sc">%&gt;%</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"regime"</span>, <span class="at">values_from =</span> <span class="st">"median_size"</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make Plot</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  size_changes <span class="sc">%&gt;%</span> </span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">!!</span>{{var_col}})) <span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="do">## distribution</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime, </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> <span class="fu">after_scale</span>(color)),</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">slab_alpha =</span> .<span class="dv">5</span>, </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.width =</span> <span class="dv">0</span>, </span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trim =</span> T, </span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">shape =</span> <span class="dv">21</span>, </span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">point_colour =</span> <span class="st">"gray25"</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stroke =</span> <span class="fl">1.6</span>,</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">scale =</span> .<span class="dv">86</span>) <span class="sc">+</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># median line</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> median_df,</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>,</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>          <span class="at">xend =</span> <span class="st">`</span><span class="at">Warm Regime</span><span class="st">`</span>,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">0</span>,</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">8</span>,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"grey25"</span>, <span class="co"># , position = position_nudge(y = -.15)</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    <span class="do">## median points - not working</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime), <span class="at">.width =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">slab_fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>age, <span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(appender), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>() <span class="sc">+</span> </span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> var_lab,</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Proportion"</span>,</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> spec,</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Temperature Regime"</span>,</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Temperature Regime"</span>,</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">"Median"</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester: </span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_regime_sizes(key_species[[1]], var = "length")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_regime_sizes, <span class="at">var =</span> <span class="st">"length"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice-2">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod-2">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring-2">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish-2">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock-2">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock-2">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup-2">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake-2">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder-2">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder-2">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder-2" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder-2">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-4-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
</section>
<section id="weight-at-age-changes" class="level1">
<h1>Weight at Age Changes</h1>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_regime_sizes, <span class="at">var =</span> <span class="st">"weight"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice-3">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod-3">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring-3">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish-3">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock-3">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock-3">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup-3">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake-3">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder-3">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder-3">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder-3" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder-3">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-5-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
</section>
<section id="changes-in-growth" class="level1">
<h1>Changes in Growth</h1>
<p>Growth in fishes is commonly modeled using the â€œVon-Bertalanffyâ€ growth function to capture how a fishes size (length or weight) changes with age. To give a coarse glimpse into how this relationship may have changed over time we can look at how the parameters have changed between regimes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the function for nls() to solve</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>vb <span class="ot">&lt;-</span> <span class="fu">vbFuns</span>(<span class="at">param=</span><span class="st">"Typical"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Debugging:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># length_age_dat_test &lt;- filter(all_vonbert, comname == "scup", regime == "Early Regime")</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># start_points_test &lt;- vbStarts(length_cm ~ age, data = length_age_dat_test)</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to Pull Vonbert Coefficients, and boot strapped intervals</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>vonbert_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(length_age_dat, start_points, <span class="at">min_obs =</span> <span class="dv">20</span>){</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Von Bert Fitting Using: {FSA}</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Don't run on fewer than a minimum number of observations</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  num_aged <span class="ot">&lt;-</span> <span class="fu">nrow</span>(length_age_dat)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If number aged less than the minimum observations, fill output with NA's</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_aged <span class="sc">&lt;</span> min_obs){</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    na_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Linf"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"K"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"t0"</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># What to return when it fails:</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"model"</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="st">"coef"</span> <span class="ot">=</span> na_df, <span class="st">"conf"</span> <span class="ot">=</span> <span class="cn">NA</span>))}</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use nls to estimate VBGF parameters using starting points</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  vbert_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(length_cm <span class="sc">~</span> <span class="fu">vb</span>(age, Linf, K, t0),</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> length_age_dat,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> start_points)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Access parameters with coef()</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  vbert_coef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">coef</span>(vbert_fit)))</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This section fails, can't find namespace/obhect "length_age_dat"</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Use bootstrapping for confidence intervals:</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vbert_boot &lt;- Boot(vbert_fit)  # Be patient! Be aware of some non-convergence</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vbert_conf &lt;- confint(vbert_boot)</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output list</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  out_l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"model"</span> <span class="ot">=</span> vbert_fit,</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coef"</span>  <span class="ot">=</span> vbert_coef<span class="co">#,</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"conf"  = vbert_conf</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the list</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out_l)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code in this next section is just a wrapper that controls which species is being fit</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Second Function for running that for a single Species, split by a factor column</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>estimate_species_vbert <span class="ot">&lt;-</span> <span class="cf">function</span>(spec_name, split_col, min_obs){</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the data using the species</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  spec_dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(all_vonbert, comname <span class="sc">==</span> spec_name)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get starting points from all data</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  test_starts <span class="ot">&lt;-</span>  <span class="fu">vbStarts</span>(length_cm <span class="sc">~</span> age, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> spec_dat)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get coefficients for groups</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  spec_dat <span class="sc">%&gt;%</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(.[split_col]) <span class="sc">%&gt;%</span> </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="at">.f =</span> vonbert_coef,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">start_points =</span> test_starts, </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_obs =</span> min_obs) <span class="sc">%&gt;%</span> </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(pluck,<span class="st">"coef"</span>, <span class="at">.id =</span> split_col) <span class="sc">%&gt;%</span> </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comname =</span> spec_name)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Once everything is prepped we can then fun the von Bert parameter estimation for all the species we are interested using the desired groups.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running everything?</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#species_coef &lt;- key_species %&gt;% </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>species_coef <span class="ot">&lt;-</span> vonbert_species <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">estimate_species_vbert</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">spec_name =</span> x, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">split_col =</span>  <span class="st">"regime"</span>, </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_obs =</span> <span class="dv">30</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate Coefficients from the bootstrapped confidence intervals</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Everything</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>species_coef <span class="sc">%&gt;%</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"vbcoef"</span>, <span class="at">values_to =</span> <span class="st">"val"</span>, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"K"</span>, <span class="st">"Linf"</span>, <span class="st">"t0"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(vbcoef <span class="sc">!=</span> <span class="st">"t0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> val, <span class="at">y =</span> <span class="fu">fct_rev</span>(comname), <span class="at">fill =</span> <span class="fu">fct_rev</span>(regime))) <span class="sc">+</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>vbcoef, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient Estimate"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Temperature Regime:"</span>) <span class="sc">+</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="growth-curves" class="level1">
<h1>Growth Curves</h1>
</section>
<section id="vb-fits-to-data" class="level1">
<h1>VB Fits to Data:</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the plot for each species</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>vb_fits_plot <span class="ot">=</span> <span class="cf">function</span>(spec_name){</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The raw size/age data:</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  t_dat <span class="ot">&lt;-</span> all_vonbert <span class="sc">%&gt;%</span> <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name)  </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The group coefficients, augmented with x values across a range</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  age_max <span class="ot">&lt;-</span> <span class="fu">max</span>(t_dat<span class="sc">$</span>age)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> age_max, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name) <span class="sc">%&gt;%</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">regime =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime), <span class="fu">length</span>(x_range)),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> <span class="fu">rep</span>(x_range, <span class="fu">length</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime)))),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"regime"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the length at age</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_length =</span> Linf <span class="sc">*</span> (<span class="dv">1</span>  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> K <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make plot?</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(t_dat, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> length_cm)) <span class="sc">+</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">#facet_wrap(~regime, ncol = 1) +</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> t_coef,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred_length, <span class="at">group =</span> regime, <span class="at">color =</span> regime), </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, age_max, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, age_max),</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, .<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>() <span class="sc">+</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="at">data =</span> t_coef, </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred_length, <span class="at">label =</span> regime, <span class="at">color =</span> regime), </span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">method=</span> <span class="fu">list</span>(<span class="st">"last.qp"</span>, <span class="at">cex =</span> <span class="fl">0.65</span>, <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">15</span>),</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Length (cm)"</span>,</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> spec_name,</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Temperature Regime:"</span>,</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Length at Age Regimes"</span>)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panelset">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     plot_panelset, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot_fun =</span> vb_fits_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="american-plaice-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="american-plaice-4">american plaice</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-cod-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-cod-4">atlantic cod</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="atlantic-herring-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="atlantic-herring-4">atlantic herring</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="butterfish-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="butterfish-4">butterfish</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-4.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="haddock-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="haddock-4">haddock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-5.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="pollock-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="pollock-4">pollock</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-6.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="scup-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="scup-4">scup</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-7.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="silver-hake-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="silver-hake-4">silver hake</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-8.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="summer-flounder-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="summer-flounder-4">summer flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-9.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="winter-flounder-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="winter-flounder-4">winter flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-10.png" class="img-fluid" width="672"></p>
</div>
</section>
<section id="yellowtail-flounder-4" class="level2 panel-name panel">
<h2 class="panel-name anchored" data-anchor-id="yellowtail-flounder-4">yellowtail flounder</h2>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-11-11.png" class="img-fluid" width="672"></p>
</div>
</section>
</div>
</section>
<section id="shifts-in-growth" class="level1">
<h1>Shifts in Growth</h1>
<p>Goal is to find some way to show all of them together in one form:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the first part from the previous plot:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># takes each species</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for age 0 - max_age, solve what the size would be based on vb fit</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>regime_curve_prep <span class="ot">&lt;-</span> <span class="cf">function</span>(spec_name){</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The raw size/age data:</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  t_dat <span class="ot">&lt;-</span> all_vonbert <span class="sc">%&gt;%</span> <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name)  </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The group coefficients, augmented with x values across a range</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  age_max <span class="ot">&lt;-</span> <span class="fu">max</span>(t_dat<span class="sc">$</span>age)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> age_max, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name) <span class="sc">%&gt;%</span> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">regime =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime), <span class="fu">length</span>(x_range)),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> <span class="fu">rep</span>(x_range, <span class="fu">length</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime)))),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"regime"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the length at age</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_length =</span> Linf <span class="sc">*</span> (<span class="dv">1</span>  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> K <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot wider?</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Take the size at age from each regime and get the difference</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> t_coef <span class="sc">%&gt;%</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Linf, K, t0)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"regime"</span>, <span class="at">values_from =</span> <span class="st">"pred_length"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_shift =</span> <span class="st">`</span><span class="at">Warm Regime</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>,</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_frac =</span> (growth_shift <span class="sc">/</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>),</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">size_change  =</span> <span class="fu">ifelse</span>(growth_shift <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Increase"</span>, <span class="st">"Decrease"</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(t_coef)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Do it for all the species</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>regime_comparison <span class="ot">&lt;-</span> vonbert_species <span class="sc">%&gt;%</span> </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="at">.f =</span> regime_curve_prep, <span class="at">.id =</span> <span class="st">"comname"</span>) </span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot their growth curves</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>regime_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(comname %in% key_species) %&gt;% </span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> growth_frac)) <span class="sc">+</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> comname), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"orange"</span>)<span class="sc">+</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>comname, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Shift in Length Moving to Warm Regime"</span>, </span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Thermal Regime Impacts on Growth"</span>,</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Changes in Size at Age (Warm Regime - Historic Regime)"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kathy requested the curve data.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Going to save both the coefficients and the fitted data for all species</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(regime_comparison, <span class="fu">here</span>(<span class="st">"data/growth_results/growth_regime_fits.csv"</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(species_coef, <span class="fu">here</span>(<span class="st">"data/growth_results/growth_regime_coefs.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try horizons</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggHoriPlot)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter outliers beyond 5th and 95th quantile</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> regime_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">between</span>(</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      growth_frac,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(growth_frac, <span class="fl">0.05</span>, <span class="at">na.rm =</span> T)<span class="sc">-</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">IQR</span>(growth_frac, <span class="at">na.rm =</span> T),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(growth_frac, <span class="fl">0.95</span>, <span class="at">na.rm =</span> T)<span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">IQR</span>(growth_frac, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outlier)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Set origin</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually pick cut points</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>sca <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">9</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>sca_bins <span class="ot">&lt;-</span> <span class="fu">str_c</span>(sca[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(sca)<span class="sc">-</span><span class="dv">1</span>)], <span class="st">" to "</span>, sca[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(sca)], <span class="st">"%"</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>sca_labels <span class="ot">&lt;-</span> <span class="fu">rev</span>(sca_bins)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Titles</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>), <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="st">"lines"</span>),</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Axes</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.y =</span> <span class="fu">element_line</span>(), </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), </span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">rect =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Facets</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>              <span class="at">strip.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype=</span><span class="st">"solid"</span>)))</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it all</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(regime_comparison, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> growth_frac)) <span class="sc">+</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_horizon</span>(</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(age, </span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> growth_frac,</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> ..Cutpoints..), </span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin =</span> ori, </span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">horizonscale =</span> sca) <span class="sc">+</span></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hcl</span>(<span class="at">palette =</span> <span class="st">'RdBu'</span>, <span class="at">reverse =</span> T, <span class="at">labels =</span> sca_labels) <span class="sc">+</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(comname<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Titles</span></span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>, </span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>), </span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="st">"lines"</span>),</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Axes</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), </span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">rect =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Facets</span></span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype=</span><span class="st">"solid"</span>),</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing.y=</span><span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="st">"lines"</span>),</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"left"</span>)  <span class="sc">+</span></span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Age'</span>, </span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Change in Body Size at Age"</span>) <span class="sc">+</span></span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="all-age-size-differences" class="level1">
<h1>All Age Size Differences</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Try geom_waffle to just count each species as an individual and show that they are growing to smaller sizes in new regime:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggwaffle)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">waffle_iron</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">filter</span>(regime_comparison, age <span class="sc">==</span> <span class="dv">5</span>), </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes_d</span>(<span class="at">group =</span> size_change), <span class="at">rows =</span> <span class="dv">2</span>), </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(x, y, <span class="at">fill =</span> <span class="fu">fct_rev</span>(group))) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_waffle</span>() <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_waffle</span>() <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Warm Regime Impact on Age 5 Body Length:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="size_at_age_regimes_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="average-body-sizes" class="level1">
<h1>Average Body Sizes</h1>

<!---- Rmarkdown Custom Footer for Author Details - Modify personal info as needed ------>

<!---- Custom Footer ------->
&nbsp;

<!---- Add GMRI Logo to footer ---->

<!--
<p style="text-align: center;">
    <img src="presentations/gmri_logo.png" alt="GMRI Logo" height="91" width="248">
</p>
-->

<!---- Author Details  ------>
<hr>
<p style="text-align: center; font-size: 60%; padding: 0px;">A work by <a href="https://github.com/adamkemberling/">Adam A. Kemberling</a></p>
<p style="text-align: center; font-size: 60%; padding: 0px;"><span style="color: #808080;"><em>Akemberling@gmri.org</em></span></p>





<!-- Add Font-Awesome Icon Library -->
<!--

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

-->

<!-- Add Icons with Personal Links -->
<!--

<p style="text-align: center;">
    <a href="https://twitter.com/r_graph_gallery?lang=en" class="fa fa-twitter"></a>
    <a href="https://www.linkedin.com/in/yan-holtz-2477534a/" class="fa fa-linkedin"></a>
    <a href="https://github.com/holtzy/" class="fa fa-github"></a>
</p>

-->

&nbsp;

<!--- End Custom Footer --->




</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb24" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Size at Age Regimes"</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">    name: "Adam Kemberling"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://github.com/adamkemberling</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Gulf of Maine Research Institute</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> | </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">  Differential Growth Rates Under Different Temperature Regimes</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "Updated on: `r Sys.Date()`"</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">  fig.height: 6</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co">  fig.width: 6</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">  fig.align: "center"</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">  comment: ""</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r packages and functions}</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| include = FALSE,</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo = FALSE</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="do">####  Packages  ####</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FSAdata)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FSA)</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmRi)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xaringanExtra)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geomtextpath)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme</span></span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_gmri</span>())</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Acitvate panelset</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>xaringanExtra<span class="sc">::</span><span class="fu">use_panelset</span>()</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate panels using a key word and a plot function</span></span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>plot_panelset <span class="ot">&lt;-</span> <span class="cf">function</span>(spec, plot_fun, ...) {</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Open panel</span></span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"::: {.panel}</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create header for panel name</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"##"</span>, spec, <span class="st">"{.panel-name}</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Text as a plot description</span></span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("Plot of", spec, "\n")</span></span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make plot</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">plot_fun</span>(spec, ...)</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add linebreak</span></span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Close panel</span></span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">":::</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a><span class="in">`r gmRi::use_gmri_style_rmd(css_file = "gmri_rmarkdown.css")`</span></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing Growth Regimes in the NW Atlantic</span></span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>Recent changes in Gulf stream positioning have altered the relative influences of the Gulf stream and Labrador current on temperature and salinity regimes for the region. Understanding that this new temperature and salinity regime should alter both the energetics of the region as well as food-web dynamics, we seek to identify whether these changes have had a measurable impact on the growth of several groundfish species.</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a><span class="fu">## Temperature Regimes</span></span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>The change in thermal regimes occurred around 2010. Following this regime change, annual temperatures have been several degrees warmer than the previous 3+ decades.</span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r temp regimes}</span></span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the regional temperatures from {targets}</span></span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(regional_oisst))</span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Get regional averages</span></span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>temp_regimes <span class="ot">&lt;-</span> regional_oisst <span class="sc">%&gt;%</span> </span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(yr <span class="sc">&gt;</span> <span class="dv">1981</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regime =</span> <span class="fu">ifelse</span>(yr <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"1982-2009 Average"</span>, <span class="st">"2010-2021 Average"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(survey_area, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey_area =</span> <span class="fu">ifelse</span>(survey_area <span class="sc">==</span> <span class="st">"all"</span>, <span class="st">"Full Region"</span>, survey_area),</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">survey_area =</span> <span class="fu">factor</span>(survey_area, </span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a>                         <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Full Region"</span>, <span class="st">"GoM"</span>, <span class="st">"GB"</span>, <span class="st">"SNE"</span>, <span class="st">"MAB"</span>)),</span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_temp_c =</span> <span class="fu">round</span>(<span class="fu">mean</span>(sst), <span class="dv">2</span>),</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">temp_label =</span> <span class="fu">str_c</span>(avg_temp_c, <span class="st">"\u00b0C"</span>),</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_anom_c =</span> <span class="fu">mean</span>(sst_anom),</span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_anom_c = ifelse(regime == "1982-2009 Regime", 0, avg_anom_c),</span></span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>, <span class="fl">1981.5</span>, <span class="fl">2009.5</span>),</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">xend =</span> <span class="fu">ifelse</span>(regime <span class="sc">==</span> <span class="st">"1982-2009 Average"</span>, <span class="fl">2009.5</span>, <span class="fl">2021.5</span>),</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot how each one exhibits a break in the</span></span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>temp_regimes <span class="sc">%&gt;%</span> </span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(survey_area <span class="sc">==</span> <span class="st">"Full Region"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(yr, sst_anom)) <span class="sc">+</span></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> regime),  <span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Using geomtextpath for label</span></span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textpath</span>(</span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> yr, </span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> avg_anom_c, </span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> temp_label, </span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">linecolor =</span> regime,</span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">colour =</span> regime), </span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">4</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line segments for the regime averages:</span></span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, </span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a>        <span class="at">xend =</span> xend,</span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> avg_anom_c, </span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>        <span class="at">yend =</span> avg_anom_c,</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> regime),</span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> .<span class="dv">8</span>,</span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="fl">0.25</span>,<span class="fl">0.25</span>))) <span class="sc">+</span></span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">number_format</span>(<span class="at">suffix =</span> <span class="st">" \u00b0C"</span>)) <span class="sc">+</span></span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gmri</span>() <span class="sc">+</span></span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>),</span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"transparent"</span>)) <span class="sc">+</span> </span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Northwest-Atlantic Temperature Regime Shift"</span>,</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>, </span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Surface Temperature Anomaly"</span>,</span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Anomalies calculated using 1982-2011 reference period."</span>) <span class="sc">+</span></span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">label =</span> <span class="st">"none"</span>)</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a><span class="fu">## Groundfish Biological Data</span></span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>The data on groundfish size-at-age is obtained as part of the NEFSC's northeast trawl survey. The age data specifically is a subset of the overall catch data, the biological dataset, which contains additional information on individuals such as age/sex/histology.</span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r bio data prep}</span></span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Access Biological Data with {targets}</span></span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(rprojroot<span class="sc">::</span><span class="fu">find_root</span>(<span class="st">'_targets.R'</span>), </span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>                <span class="fu">tar_load</span>(survdat_biological))</span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Prepare Bio Data for Age analysis for regimes:</span></span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NA age data, restrict to summer and fall</span></span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>nmfs_bio <span class="ot">&lt;-</span> survdat_biological <span class="sc">%&gt;%</span></span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(age) <span class="sc">==</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a>         season <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Spring"</span>, <span class="st">"Fall"</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a><span class="co">#Add regime and decade labels</span></span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a>nmfs_bio <span class="ot">&lt;-</span> nmfs_bio <span class="sc">%&gt;%</span> </span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">yearclass =</span> est_year <span class="sc">-</span> (age<span class="dv">-1</span>),</span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a>    <span class="at">regime =</span> <span class="fu">ifelse</span>(est_year <span class="sc">&lt;</span> <span class="dv">2010</span>, <span class="st">"Early Regime"</span>, <span class="st">"Warm Regime"</span>),</span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a>    <span class="at">decade =</span> <span class="fu">floor_decade</span>(est_year)) </span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(survdat_biological)</span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a><span class="fu">### Studying Regimes</span></span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a>To ensure enough age data is available for deriving growth characteristics, the data is grouped into regimes that match the regional temperature regimes. Despite these species living at or near the bottom, research suggests that the forces driving these thermal regimes would have far-reaching impacts biological impacts. These impacts may directly change the near-bottom environment through mixing patterns, and/or indirectly through food-web impacts.</span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a>Through this lens we will assess changes to body size, size-at-age, and growth characteristics derived using the von-bertalanffy growth equation.</span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r year filter}</span></span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to just the data for the two regimes</span></span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>regime_dat <span class="ot">&lt;-</span> <span class="fu">filter</span>(nmfs_bio, est_year <span class="sc">&gt;=</span> <span class="dv">2000</span>, est_year <span class="sc">&lt;=</span> <span class="dv">2019</span>)</span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a><span class="fu">### Species Selected</span></span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a>The biological data is then separated into lists organized by species. The lists contain all data for a given species, broken into groups at a set interval of time. In this case it is ten-year thermal regimes we seek to compare.</span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a>In the original proposal it was stated that 17 species would be used, species that are regularly measured and aged. Ordering all species by the number aged we can pull out the following top species:</span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r vbert species selection}</span></span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a><span class="do">####  Data Prep  #### </span></span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Rank species by how many measurements there are</span></span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a>species_abunds <span class="ot">&lt;-</span> regime_dat <span class="sc">%&gt;%</span> </span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(comname) <span class="sc">%&gt;%</span> </span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="co"># ordered by number measured</span></span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder alphabetically</span></span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a>vonbert_species <span class="ot">&lt;-</span> <span class="fu">sort</span>(species_abunds<span class="sc">$</span>comname[<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>])</span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a>These will be the species that we assess length-at-age characteristics for our meta-analysis:</span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a>**`r pander::pander(vonbert_species)`.**</span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a>Unfortunately; despite being major players in the regions ecology, age data is not available for spiny dogfish and other elasmobranch species.</span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r panel species}</span></span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a><span class="co"># Name the list so it carries through</span></span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vonbert_species) <span class="ot">&lt;-</span> vonbert_species</span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a><span class="do">##### Pull species data into the list, and make group id for later</span></span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a>all_vonbert <span class="ot">&lt;-</span>  <span class="fu">map_dfr</span>(vonbert_species, <span class="cf">function</span>(species_name){</span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to the vonbert species</span></span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a>  regime_dat <span class="sc">%&gt;%</span></span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> species_name) <span class="sc">%&gt;%</span> </span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group_id =</span> <span class="fu">str_c</span>(regime, comname, <span class="at">sep =</span> <span class="st">"-"</span>)) </span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a>}, <span class="at">.id =</span> <span class="st">"common name"</span>) </span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-235"><a href="#cb24-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-236"><a href="#cb24-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Species we want panels for:</span></span>
<span id="cb24-237"><a href="#cb24-237" aria-hidden="true" tabindex="-1"></a>key_species <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">c</span>(</span>
<span id="cb24-238"><a href="#cb24-238" aria-hidden="true" tabindex="-1"></a>  <span class="st">"american plaice"</span>,</span>
<span id="cb24-239"><a href="#cb24-239" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic cod"</span>,</span>
<span id="cb24-240"><a href="#cb24-240" aria-hidden="true" tabindex="-1"></a>  <span class="st">"atlantic herring"</span>,</span>
<span id="cb24-241"><a href="#cb24-241" aria-hidden="true" tabindex="-1"></a>  <span class="st">"butterfish"</span>,</span>
<span id="cb24-242"><a href="#cb24-242" aria-hidden="true" tabindex="-1"></a>  <span class="st">"haddock"</span>, </span>
<span id="cb24-243"><a href="#cb24-243" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pollock"</span>,</span>
<span id="cb24-244"><a href="#cb24-244" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scup"</span>,</span>
<span id="cb24-245"><a href="#cb24-245" aria-hidden="true" tabindex="-1"></a>  <span class="st">"silver hake"</span>,</span>
<span id="cb24-246"><a href="#cb24-246" aria-hidden="true" tabindex="-1"></a>  <span class="st">"summer flounder"</span>,</span>
<span id="cb24-247"><a href="#cb24-247" aria-hidden="true" tabindex="-1"></a>  <span class="st">"winter flounder"</span>,</span>
<span id="cb24-248"><a href="#cb24-248" aria-hidden="true" tabindex="-1"></a>  <span class="st">"yellowtail flounder"</span></span>
<span id="cb24-249"><a href="#cb24-249" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb24-250"><a href="#cb24-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-251"><a href="#cb24-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-252"><a href="#cb24-252" aria-hidden="true" tabindex="-1"></a><span class="fu">### Growth Increment Estimation</span></span>
<span id="cb24-253"><a href="#cb24-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-254"><a href="#cb24-254" aria-hidden="true" tabindex="-1"></a>One aspect of growth beyond size-at-age is the annual growth between years of a specific age, or the growth increment.</span>
<span id="cb24-255"><a href="#cb24-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-258"><a href="#cb24-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-259"><a href="#cb24-259" aria-hidden="true" tabindex="-1"></a><span class="co"># Age-Size Increments Differences</span></span>
<span id="cb24-260"><a href="#cb24-260" aria-hidden="true" tabindex="-1"></a>vb_incs <span class="ot">&lt;-</span> all_vonbert <span class="sc">%&gt;%</span> </span>
<span id="cb24-261"><a href="#cb24-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, est_year,  age, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb24-262"><a href="#cb24-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_len =</span> <span class="fu">mean</span>(length_cm, <span class="at">na.rm =</span> T),</span>
<span id="cb24-263"><a href="#cb24-263" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_wt  =</span> <span class="fu">mean</span>(indwt, <span class="at">na.rm =</span> T),</span>
<span id="cb24-264"><a href="#cb24-264" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-265"><a href="#cb24-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, age) <span class="sc">%&gt;%</span> </span>
<span id="cb24-266"><a href="#cb24-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span>, est_year) <span class="sc">%&gt;%</span> </span>
<span id="cb24-267"><a href="#cb24-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){</span>
<span id="cb24-268"><a href="#cb24-268" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%&gt;%</span> </span>
<span id="cb24-269"><a href="#cb24-269" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb24-270"><a href="#cb24-270" aria-hidden="true" tabindex="-1"></a>        <span class="co"># What age is being subtracted from</span></span>
<span id="cb24-271"><a href="#cb24-271" aria-hidden="true" tabindex="-1"></a>        <span class="at">lead_age   =</span> <span class="fu">lead</span>(age, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb24-272"><a href="#cb24-272" aria-hidden="true" tabindex="-1"></a>        <span class="co"># String built from the value to confirm</span></span>
<span id="cb24-273"><a href="#cb24-273" aria-hidden="true" tabindex="-1"></a>        <span class="at">diff_name  =</span> <span class="fu">str_c</span>(age, <span class="st">" - "</span>, lead_age),</span>
<span id="cb24-274"><a href="#cb24-274" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Length/Weight at age + 1</span></span>
<span id="cb24-275"><a href="#cb24-275" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_age_p1 =</span> <span class="fu">lead</span>(avg_len, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb24-276"><a href="#cb24-276" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_age_p1  =</span> <span class="fu">lead</span>(avg_wt, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb24-277"><a href="#cb24-277" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Length/Weight Growth Increments</span></span>
<span id="cb24-278"><a href="#cb24-278" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_inc    =</span> len_age_p1 <span class="sc">-</span> avg_len,</span>
<span id="cb24-279"><a href="#cb24-279" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_inc     =</span> wt_age_p1 <span class="sc">-</span> avg_wt,</span>
<span id="cb24-280"><a href="#cb24-280" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Percent change in bodymass for going from age to age+1</span></span>
<span id="cb24-281"><a href="#cb24-281" aria-hidden="true" tabindex="-1"></a>        <span class="at">len_perc_change =</span> (len_inc <span class="sc">/</span> avg_len) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb24-282"><a href="#cb24-282" aria-hidden="true" tabindex="-1"></a>        <span class="at">wt_perc_change =</span> (wt_inc <span class="sc">/</span> avg_wt) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-283"><a href="#cb24-283" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>((lead_age <span class="sc">-</span> age <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb24-284"><a href="#cb24-284" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb24-285"><a href="#cb24-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-286"><a href="#cb24-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-287"><a href="#cb24-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-288"><a href="#cb24-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-289"><a href="#cb24-289" aria-hidden="true" tabindex="-1"></a><span class="fu">## Age Data Frequencies</span></span>
<span id="cb24-290"><a href="#cb24-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-291"><a href="#cb24-291" aria-hidden="true" tabindex="-1"></a>Just looking at the raw data available, it becomes obvious that there are differences in the number of fish at various ages through time.</span>
<span id="cb24-292"><a href="#cb24-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-293"><a href="#cb24-293" aria-hidden="true" tabindex="-1"></a>With cases of large cohorts passing through, or older individuals being caught less frequently. Particularly large cohorts of haddock are a good example.</span>
<span id="cb24-294"><a href="#cb24-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-295"><a href="#cb24-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ridgeplot fun}</span></span>
<span id="cb24-296"><a href="#cb24-296" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting age distribution as ggridges</span></span>
<span id="cb24-297"><a href="#cb24-297" aria-hidden="true" tabindex="-1"></a>plot_age_ridgeplot <span class="ot">&lt;-</span> <span class="cf">function</span>(species){</span>
<span id="cb24-298"><a href="#cb24-298" aria-hidden="true" tabindex="-1"></a>  all_vonbert <span class="sc">%&gt;%</span> </span>
<span id="cb24-299"><a href="#cb24-299" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> species,</span>
<span id="cb24-300"><a href="#cb24-300" aria-hidden="true" tabindex="-1"></a>           age <span class="sc">&lt;=</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-301"><a href="#cb24-301" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">yr =</span> <span class="fu">factor</span>(est_year),</span>
<span id="cb24-302"><a href="#cb24-302" aria-hidden="true" tabindex="-1"></a>           <span class="at">yr =</span> <span class="fu">fct_rev</span>(yr)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-303"><a href="#cb24-303" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> yr)) <span class="sc">+</span></span>
<span id="cb24-304"><a href="#cb24-304" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_density_ridges</span>(<span class="fu">aes</span>(<span class="at">fill =</span> regime), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb24-305"><a href="#cb24-305" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb24-306"><a href="#cb24-306" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>comname) <span class="sc">+</span></span>
<span id="cb24-307"><a href="#cb24-307" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>), </span>
<span id="cb24-308"><a href="#cb24-308" aria-hidden="true" tabindex="-1"></a>                         <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb24-309"><a href="#cb24-309" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb24-310"><a href="#cb24-310" aria-hidden="true" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">title.position =</span> <span class="st">"top"</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb24-311"><a href="#cb24-311" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-312"><a href="#cb24-312" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-313"><a href="#cb24-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-314"><a href="#cb24-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-315"><a href="#cb24-315" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb24-316"><a href="#cb24-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ridge panels, results="asis", fig.height=8}</span></span>
<span id="cb24-317"><a href="#cb24-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-318"><a href="#cb24-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb24-319"><a href="#cb24-319" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_age_ridgeplot)</span>
<span id="cb24-320"><a href="#cb24-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-321"><a href="#cb24-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-322"><a href="#cb24-322" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-323"><a href="#cb24-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-324"><a href="#cb24-324" aria-hidden="true" tabindex="-1"></a>Strong age classes were particularly prominent in the following species, showing lasting numbers in subsequent years.</span>
<span id="cb24-325"><a href="#cb24-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-326"><a href="#cb24-326" aria-hidden="true" tabindex="-1"></a>| Species          | Strong Year Classes |</span>
<span id="cb24-327"><a href="#cb24-327" aria-hidden="true" tabindex="-1"></a>|------------------|---------------------|</span>
<span id="cb24-328"><a href="#cb24-328" aria-hidden="true" tabindex="-1"></a>| Atlantic Cod     | 2003, 2013          |</span>
<span id="cb24-329"><a href="#cb24-329" aria-hidden="true" tabindex="-1"></a>| Haddock          | 2003, 2010, 2013    |</span>
<span id="cb24-330"><a href="#cb24-330" aria-hidden="true" tabindex="-1"></a>| Atlantic Herring | 2008, 2011          |</span>
<span id="cb24-331"><a href="#cb24-331" aria-hidden="true" tabindex="-1"></a>| Pollock          | 2000, 2012          |</span>
<span id="cb24-332"><a href="#cb24-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-333"><a href="#cb24-333" aria-hidden="true" tabindex="-1"></a><span class="fu"># Growth Increment Changes</span></span>
<span id="cb24-334"><a href="#cb24-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-335"><a href="#cb24-335" aria-hidden="true" tabindex="-1"></a>Age specific growth (annual growth increments) help detail where in a species life cycle it may be experiencing favorable or less-favorable conditions for growth. These can be a result of differences in habitat use or prey resources at different ages, and/or a change in exposure to temperature or other stressors that inflict a metabolic cost.</span>
<span id="cb24-336"><a href="#cb24-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-339"><a href="#cb24-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-340"><a href="#cb24-340" aria-hidden="true" tabindex="-1"></a><span class="co"># Put together a timeseries of:</span></span>
<span id="cb24-341"><a href="#cb24-341" aria-hidden="true" tabindex="-1"></a><span class="co"># how big were the age 0's,</span></span>
<span id="cb24-342"><a href="#cb24-342" aria-hidden="true" tabindex="-1"></a><span class="co"># how big were the age 1's</span></span>
<span id="cb24-343"><a href="#cb24-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-344"><a href="#cb24-344" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Age Increments</span></span>
<span id="cb24-345"><a href="#cb24-345" aria-hidden="true" tabindex="-1"></a>plot_age_increments <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb24-346"><a href="#cb24-346" aria-hidden="true" tabindex="-1"></a>    spec_choice, </span>
<span id="cb24-347"><a href="#cb24-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">var_choice =</span> <span class="st">"length"</span>, </span>
<span id="cb24-348"><a href="#cb24-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">gam_knots =</span> <span class="dv">15</span>, </span>
<span id="cb24-349"><a href="#cb24-349" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_prefix =</span> <span class="st">"Age Increment: "</span>,</span>
<span id="cb24-350"><a href="#cb24-350" aria-hidden="true" tabindex="-1"></a>    <span class="at">facet_suffix =</span> <span class="st">""</span>){</span>
<span id="cb24-351"><a href="#cb24-351" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-352"><a href="#cb24-352" aria-hidden="true" tabindex="-1"></a><span class="co"># Code to switch variables and their labels:</span></span>
<span id="cb24-353"><a href="#cb24-353" aria-hidden="true" tabindex="-1"></a>  var_sym <span class="ot">&lt;-</span> <span class="cf">switch</span>(var_choice,</span>
<span id="cb24-354"><a href="#cb24-354" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"len_inc"</span>),</span>
<span id="cb24-355"><a href="#cb24-355" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"wt_inc"</span>))</span>
<span id="cb24-356"><a href="#cb24-356" aria-hidden="true" tabindex="-1"></a>  var_label <span class="ot">&lt;-</span> <span class="cf">switch</span>(var_choice,</span>
<span id="cb24-357"><a href="#cb24-357" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"length"</span> <span class="ot">=</span> <span class="st">"Annual Growth  (cm)"</span>,</span>
<span id="cb24-358"><a href="#cb24-358" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"weight"</span> <span class="ot">=</span> <span class="st">"Annual Growth  (kg)"</span>)</span>
<span id="cb24-359"><a href="#cb24-359" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-360"><a href="#cb24-360" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-361"><a href="#cb24-361" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add pre/suffix to facet labels</span></span>
<span id="cb24-362"><a href="#cb24-362" aria-hidden="true" tabindex="-1"></a>  appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">prefix =</span> facet_prefix, <span class="at">suffix =</span> facet_suffix) {</span>
<span id="cb24-363"><a href="#cb24-363" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(prefix, string)}</span>
<span id="cb24-364"><a href="#cb24-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-365"><a href="#cb24-365" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make the plot</span></span>
<span id="cb24-366"><a href="#cb24-366" aria-hidden="true" tabindex="-1"></a>  vb_incs <span class="sc">%&gt;%</span> </span>
<span id="cb24-367"><a href="#cb24-367" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="st">`</span><span class="at">common name</span><span class="st">`</span> <span class="sc">==</span> spec_choice,</span>
<span id="cb24-368"><a href="#cb24-368" aria-hidden="true" tabindex="-1"></a>           lead_age <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-369"><a href="#cb24-369" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>({{var_sym}}) <span class="sc">%&gt;%</span> </span>
<span id="cb24-370"><a href="#cb24-370" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(est_year, {{var_sym}})) <span class="sc">+</span></span>
<span id="cb24-371"><a href="#cb24-371" aria-hidden="true" tabindex="-1"></a>      <span class="co"># geom_col(fill = gmri_cols("gmri blue")) +</span></span>
<span id="cb24-372"><a href="#cb24-372" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"gmri blue"</span>)) <span class="sc">+</span></span>
<span id="cb24-373"><a href="#cb24-373" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"gmri blue"</span>), <span class="at">group =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb24-374"><a href="#cb24-374" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"gam"</span>,</span>
<span id="cb24-375"><a href="#cb24-375" aria-hidden="true" tabindex="-1"></a>                  <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">s</span>(x, <span class="at">bs =</span> <span class="st">"cs"</span>, <span class="at">k =</span> gam_knots),</span>
<span id="cb24-376"><a href="#cb24-376" aria-hidden="true" tabindex="-1"></a>                  <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-377"><a href="#cb24-377" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb24-378"><a href="#cb24-378" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">gmri_cols</span>(<span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb24-379"><a href="#cb24-379" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>diff_name, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free"</span>,</span>
<span id="cb24-380"><a href="#cb24-380" aria-hidden="true" tabindex="-1"></a>                 <span class="at">labeller =</span> <span class="fu">as_labeller</span>(appender))  <span class="sc">+</span></span>
<span id="cb24-381"><a href="#cb24-381" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb24-382"><a href="#cb24-382" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb24-383"><a href="#cb24-383" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> var_label,</span>
<span id="cb24-384"><a href="#cb24-384" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"Age Increment"</span>,</span>
<span id="cb24-385"><a href="#cb24-385" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">str_to_title</span>(spec_choice),</span>
<span id="cb24-386"><a href="#cb24-386" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">"Changes in annual "</span>, var_choice, <span class="st">" growth increments."</span>))</span>
<span id="cb24-387"><a href="#cb24-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-388"><a href="#cb24-388" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-389"><a href="#cb24-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-390"><a href="#cb24-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-391"><a href="#cb24-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-392"><a href="#cb24-392" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb24-393"><a href="#cb24-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results="asis", fig.height = 8}</span></span>
<span id="cb24-394"><a href="#cb24-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-395"><a href="#cb24-395" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb24-396"><a href="#cb24-396" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_age_increments, <span class="at">var_choice =</span> <span class="st">"weight"</span>, <span class="at">gam_knots =</span> <span class="dv">5</span>)</span>
<span id="cb24-397"><a href="#cb24-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-398"><a href="#cb24-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-399"><a href="#cb24-399" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-400"><a href="#cb24-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-401"><a href="#cb24-401" aria-hidden="true" tabindex="-1"></a><span class="fu"># Length at Age Changes</span></span>
<span id="cb24-402"><a href="#cb24-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-403"><a href="#cb24-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r regime size plots}</span></span>
<span id="cb24-404"><a href="#cb24-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-405"><a href="#cb24-405" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribution of Length/Weight Across Regimes </span></span>
<span id="cb24-406"><a href="#cb24-406" aria-hidden="true" tabindex="-1"></a>plot_regime_sizes <span class="ot">&lt;-</span> <span class="cf">function</span>(spec, <span class="at">var =</span> <span class="st">"length"</span>, <span class="at">age_lim =</span> <span class="dv">5</span>, <span class="at">facet_prefix =</span> <span class="st">"Age - "</span>, <span class="at">facet_suffix =</span> <span class="st">""</span>){</span>
<span id="cb24-407"><a href="#cb24-407" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-408"><a href="#cb24-408" aria-hidden="true" tabindex="-1"></a>  <span class="co"># switches for length or width</span></span>
<span id="cb24-409"><a href="#cb24-409" aria-hidden="true" tabindex="-1"></a>  var_col <span class="ot">&lt;-</span> <span class="cf">switch</span> (var,</span>
<span id="cb24-410"><a href="#cb24-410" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"length_cm"</span>),</span>
<span id="cb24-411"><a href="#cb24-411" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="fu">sym</span>(<span class="st">"indwt"</span>))</span>
<span id="cb24-412"><a href="#cb24-412" aria-hidden="true" tabindex="-1"></a>  var_lab <span class="ot">&lt;-</span> <span class="cf">switch</span> (var,</span>
<span id="cb24-413"><a href="#cb24-413" aria-hidden="true" tabindex="-1"></a>    <span class="st">"length"</span> <span class="ot">=</span> <span class="st">"Individual Length (cm)"</span>,</span>
<span id="cb24-414"><a href="#cb24-414" aria-hidden="true" tabindex="-1"></a>    <span class="st">"weight"</span> <span class="ot">=</span> <span class="st">"Individual Weight (kg)"</span>)</span>
<span id="cb24-415"><a href="#cb24-415" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-416"><a href="#cb24-416" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add pre/suffix to facet labels</span></span>
<span id="cb24-417"><a href="#cb24-417" aria-hidden="true" tabindex="-1"></a>  appender <span class="ot">&lt;-</span> <span class="cf">function</span>(string, <span class="at">prefix =</span> facet_prefix, <span class="at">suffix =</span> facet_suffix) {</span>
<span id="cb24-418"><a href="#cb24-418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(prefix, string)}</span>
<span id="cb24-419"><a href="#cb24-419" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-420"><a href="#cb24-420" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select Ages, Prep data</span></span>
<span id="cb24-421"><a href="#cb24-421" aria-hidden="true" tabindex="-1"></a>  size_changes <span class="ot">&lt;-</span> regime_dat <span class="sc">%&gt;%</span> </span>
<span id="cb24-422"><a href="#cb24-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb24-423"><a href="#cb24-423" aria-hidden="true" tabindex="-1"></a>    comname <span class="sc">==</span> spec,</span>
<span id="cb24-424"><a href="#cb24-424" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&lt;=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-425"><a href="#cb24-425" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Calculate group averages</span></span>
<span id="cb24-426"><a href="#cb24-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, regime) <span class="sc">%&gt;%</span> </span>
<span id="cb24-427"><a href="#cb24-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-428"><a href="#cb24-428" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_size =</span> <span class="fu">median</span>(<span class="sc">!!</span>{{var_col}})) <span class="sc">%&gt;%</span> </span>
<span id="cb24-429"><a href="#cb24-429" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() </span>
<span id="cb24-430"><a href="#cb24-430" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-431"><a href="#cb24-431" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make median dataframe</span></span>
<span id="cb24-432"><a href="#cb24-432" aria-hidden="true" tabindex="-1"></a>  median_df <span class="ot">&lt;-</span> size_changes <span class="sc">%&gt;%</span></span>
<span id="cb24-433"><a href="#cb24-433" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(age, regime, median_size) <span class="sc">%&gt;%</span></span>
<span id="cb24-434"><a href="#cb24-434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"regime"</span>, <span class="at">values_from =</span> <span class="st">"median_size"</span>)</span>
<span id="cb24-435"><a href="#cb24-435" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-436"><a href="#cb24-436" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make Plot</span></span>
<span id="cb24-437"><a href="#cb24-437" aria-hidden="true" tabindex="-1"></a>  size_changes <span class="sc">%&gt;%</span> </span>
<span id="cb24-438"><a href="#cb24-438" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">!!</span>{{var_col}})) <span class="sc">+</span></span>
<span id="cb24-439"><a href="#cb24-439" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-440"><a href="#cb24-440" aria-hidden="true" tabindex="-1"></a>    <span class="do">## distribution</span></span>
<span id="cb24-441"><a href="#cb24-441" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime, </span>
<span id="cb24-442"><a href="#cb24-442" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> <span class="fu">after_scale</span>(color)),</span>
<span id="cb24-443"><a href="#cb24-443" aria-hidden="true" tabindex="-1"></a>                 <span class="at">slab_alpha =</span> .<span class="dv">5</span>, </span>
<span id="cb24-444"><a href="#cb24-444" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.width =</span> <span class="dv">0</span>, </span>
<span id="cb24-445"><a href="#cb24-445" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trim =</span> T, </span>
<span id="cb24-446"><a href="#cb24-446" aria-hidden="true" tabindex="-1"></a>                 <span class="at">shape =</span> <span class="dv">21</span>, </span>
<span id="cb24-447"><a href="#cb24-447" aria-hidden="true" tabindex="-1"></a>                 <span class="at">point_colour =</span> <span class="st">"gray25"</span>,</span>
<span id="cb24-448"><a href="#cb24-448" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stroke =</span> <span class="fl">1.6</span>,</span>
<span id="cb24-449"><a href="#cb24-449" aria-hidden="true" tabindex="-1"></a>                 <span class="at">scale =</span> .<span class="dv">86</span>) <span class="sc">+</span></span>
<span id="cb24-450"><a href="#cb24-450" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-451"><a href="#cb24-451" aria-hidden="true" tabindex="-1"></a>    <span class="co"># median line</span></span>
<span id="cb24-452"><a href="#cb24-452" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(</span>
<span id="cb24-453"><a href="#cb24-453" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> median_df,</span>
<span id="cb24-454"><a href="#cb24-454" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>,</span>
<span id="cb24-455"><a href="#cb24-455" aria-hidden="true" tabindex="-1"></a>          <span class="at">xend =</span> <span class="st">`</span><span class="at">Warm Regime</span><span class="st">`</span>,</span>
<span id="cb24-456"><a href="#cb24-456" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="dv">0</span>,</span>
<span id="cb24-457"><a href="#cb24-457" aria-hidden="true" tabindex="-1"></a>          <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb24-458"><a href="#cb24-458" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> .<span class="dv">8</span>,</span>
<span id="cb24-459"><a href="#cb24-459" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"grey25"</span>, <span class="co"># , position = position_nudge(y = -.15)</span></span>
<span id="cb24-460"><a href="#cb24-460" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb24-461"><a href="#cb24-461" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-462"><a href="#cb24-462" aria-hidden="true" tabindex="-1"></a>    <span class="do">## median points - not working</span></span>
<span id="cb24-463"><a href="#cb24-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">color =</span> regime), <span class="at">.width =</span> <span class="fu">c</span>(<span class="dv">0</span>), <span class="at">slab_fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb24-464"><a href="#cb24-464" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-465"><a href="#cb24-465" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb24-466"><a href="#cb24-466" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>age, <span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb24-467"><a href="#cb24-467" aria-hidden="true" tabindex="-1"></a>               <span class="at">labeller =</span> <span class="fu">as_labeller</span>(appender), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb24-468"><a href="#cb24-468" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>() <span class="sc">+</span> </span>
<span id="cb24-469"><a href="#cb24-469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb24-470"><a href="#cb24-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb24-471"><a href="#cb24-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb24-472"><a href="#cb24-472" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> var_lab,</span>
<span id="cb24-473"><a href="#cb24-473" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Proportion"</span>,</span>
<span id="cb24-474"><a href="#cb24-474" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> spec,</span>
<span id="cb24-475"><a href="#cb24-475" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Temperature Regime"</span>,</span>
<span id="cb24-476"><a href="#cb24-476" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Temperature Regime"</span>,</span>
<span id="cb24-477"><a href="#cb24-477" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape =</span> <span class="st">"Median"</span></span>
<span id="cb24-478"><a href="#cb24-478" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb24-479"><a href="#cb24-479" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-480"><a href="#cb24-480" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-481"><a href="#cb24-481" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-482"><a href="#cb24-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-483"><a href="#cb24-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-484"><a href="#cb24-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester: </span></span>
<span id="cb24-485"><a href="#cb24-485" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_regime_sizes(key_species[[1]], var = "length")</span></span>
<span id="cb24-486"><a href="#cb24-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-487"><a href="#cb24-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-488"><a href="#cb24-488" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb24-489"><a href="#cb24-489" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results="asis", fig.height = 8}</span></span>
<span id="cb24-490"><a href="#cb24-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-491"><a href="#cb24-491" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb24-492"><a href="#cb24-492" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_regime_sizes, <span class="at">var =</span> <span class="st">"length"</span>)</span>
<span id="cb24-493"><a href="#cb24-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-494"><a href="#cb24-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-495"><a href="#cb24-495" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-496"><a href="#cb24-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-497"><a href="#cb24-497" aria-hidden="true" tabindex="-1"></a><span class="fu"># Weight at Age Changes</span></span>
<span id="cb24-498"><a href="#cb24-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-499"><a href="#cb24-499" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb24-500"><a href="#cb24-500" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results="asis", fig.height = 8}</span></span>
<span id="cb24-501"><a href="#cb24-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-502"><a href="#cb24-502" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb24-503"><a href="#cb24-503" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, plot_panelset, <span class="at">plot_fun =</span> plot_regime_sizes, <span class="at">var =</span> <span class="st">"weight"</span>)</span>
<span id="cb24-504"><a href="#cb24-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-505"><a href="#cb24-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-506"><a href="#cb24-506" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-507"><a href="#cb24-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-508"><a href="#cb24-508" aria-hidden="true" tabindex="-1"></a><span class="fu"># Changes in Growth</span></span>
<span id="cb24-509"><a href="#cb24-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-510"><a href="#cb24-510" aria-hidden="true" tabindex="-1"></a>Growth in fishes is commonly modeled using the "Von-Bertalanffy" growth function to capture how a fishes size (length or weight) changes with age. To give a coarse glimpse into how this relationship may have changed over time we can look at how the parameters have changed between regimes.</span>
<span id="cb24-511"><a href="#cb24-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-514"><a href="#cb24-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-515"><a href="#cb24-515" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the function for nls() to solve</span></span>
<span id="cb24-516"><a href="#cb24-516" aria-hidden="true" tabindex="-1"></a>vb <span class="ot">&lt;-</span> <span class="fu">vbFuns</span>(<span class="at">param=</span><span class="st">"Typical"</span>) </span>
<span id="cb24-517"><a href="#cb24-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-518"><a href="#cb24-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-521"><a href="#cb24-521" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-522"><a href="#cb24-522" aria-hidden="true" tabindex="-1"></a><span class="co"># Debugging:</span></span>
<span id="cb24-523"><a href="#cb24-523" aria-hidden="true" tabindex="-1"></a><span class="co"># length_age_dat_test &lt;- filter(all_vonbert, comname == "scup", regime == "Early Regime")</span></span>
<span id="cb24-524"><a href="#cb24-524" aria-hidden="true" tabindex="-1"></a><span class="co"># start_points_test &lt;- vbStarts(length_cm ~ age, data = length_age_dat_test)</span></span>
<span id="cb24-525"><a href="#cb24-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-526"><a href="#cb24-526" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to Pull Vonbert Coefficients, and boot strapped intervals</span></span>
<span id="cb24-527"><a href="#cb24-527" aria-hidden="true" tabindex="-1"></a>vonbert_coef <span class="ot">&lt;-</span> <span class="cf">function</span>(length_age_dat, start_points, <span class="at">min_obs =</span> <span class="dv">20</span>){</span>
<span id="cb24-528"><a href="#cb24-528" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-529"><a href="#cb24-529" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Von Bert Fitting Using: {FSA}</span></span>
<span id="cb24-530"><a href="#cb24-530" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-531"><a href="#cb24-531" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-532"><a href="#cb24-532" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Don't run on fewer than a minimum number of observations</span></span>
<span id="cb24-533"><a href="#cb24-533" aria-hidden="true" tabindex="-1"></a>  num_aged <span class="ot">&lt;-</span> <span class="fu">nrow</span>(length_age_dat)</span>
<span id="cb24-534"><a href="#cb24-534" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-535"><a href="#cb24-535" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-536"><a href="#cb24-536" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If number aged less than the minimum observations, fill output with NA's</span></span>
<span id="cb24-537"><a href="#cb24-537" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(num_aged <span class="sc">&lt;</span> min_obs){</span>
<span id="cb24-538"><a href="#cb24-538" aria-hidden="true" tabindex="-1"></a>    na_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"Linf"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb24-539"><a href="#cb24-539" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"K"</span> <span class="ot">=</span> <span class="cn">NA</span>,</span>
<span id="cb24-540"><a href="#cb24-540" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"t0"</span> <span class="ot">=</span> <span class="cn">NA</span>)</span>
<span id="cb24-541"><a href="#cb24-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-542"><a href="#cb24-542" aria-hidden="true" tabindex="-1"></a>    <span class="co"># What to return when it fails:</span></span>
<span id="cb24-543"><a href="#cb24-543" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">"model"</span> <span class="ot">=</span> <span class="cn">NA</span>, <span class="st">"coef"</span> <span class="ot">=</span> na_df, <span class="st">"conf"</span> <span class="ot">=</span> <span class="cn">NA</span>))}</span>
<span id="cb24-544"><a href="#cb24-544" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-545"><a href="#cb24-545" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use nls to estimate VBGF parameters using starting points</span></span>
<span id="cb24-546"><a href="#cb24-546" aria-hidden="true" tabindex="-1"></a>  vbert_fit <span class="ot">&lt;-</span> <span class="fu">nls</span>(length_cm <span class="sc">~</span> <span class="fu">vb</span>(age, Linf, K, t0),</span>
<span id="cb24-547"><a href="#cb24-547" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> length_age_dat,</span>
<span id="cb24-548"><a href="#cb24-548" aria-hidden="true" tabindex="-1"></a>                   <span class="at">start =</span> start_points)</span>
<span id="cb24-549"><a href="#cb24-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-550"><a href="#cb24-550" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Access parameters with coef()</span></span>
<span id="cb24-551"><a href="#cb24-551" aria-hidden="true" tabindex="-1"></a>  vbert_coef <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">coef</span>(vbert_fit)))</span>
<span id="cb24-552"><a href="#cb24-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-553"><a href="#cb24-553" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-554"><a href="#cb24-554" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This section fails, can't find namespace/obhect "length_age_dat"</span></span>
<span id="cb24-555"><a href="#cb24-555" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-556"><a href="#cb24-556" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-557"><a href="#cb24-557" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Use bootstrapping for confidence intervals:</span></span>
<span id="cb24-558"><a href="#cb24-558" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vbert_boot &lt;- Boot(vbert_fit)  # Be patient! Be aware of some non-convergence</span></span>
<span id="cb24-559"><a href="#cb24-559" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vbert_conf &lt;- confint(vbert_boot)</span></span>
<span id="cb24-560"><a href="#cb24-560" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-561"><a href="#cb24-561" aria-hidden="true" tabindex="-1"></a>  <span class="co"># output list</span></span>
<span id="cb24-562"><a href="#cb24-562" aria-hidden="true" tabindex="-1"></a>  out_l <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-563"><a href="#cb24-563" aria-hidden="true" tabindex="-1"></a>    <span class="st">"model"</span> <span class="ot">=</span> vbert_fit,</span>
<span id="cb24-564"><a href="#cb24-564" aria-hidden="true" tabindex="-1"></a>    <span class="st">"coef"</span>  <span class="ot">=</span> vbert_coef<span class="co">#,</span></span>
<span id="cb24-565"><a href="#cb24-565" aria-hidden="true" tabindex="-1"></a>    <span class="co">#"conf"  = vbert_conf</span></span>
<span id="cb24-566"><a href="#cb24-566" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-567"><a href="#cb24-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-568"><a href="#cb24-568" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the list</span></span>
<span id="cb24-569"><a href="#cb24-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out_l)</span>
<span id="cb24-570"><a href="#cb24-570" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-571"><a href="#cb24-571" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-572"><a href="#cb24-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-573"><a href="#cb24-573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-574"><a href="#cb24-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-575"><a href="#cb24-575" aria-hidden="true" tabindex="-1"></a>The code in this next section is just a wrapper that controls which species is being fit</span>
<span id="cb24-576"><a href="#cb24-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-579"><a href="#cb24-579" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-580"><a href="#cb24-580" aria-hidden="true" tabindex="-1"></a><span class="co"># Second Function for running that for a single Species, split by a factor column</span></span>
<span id="cb24-581"><a href="#cb24-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-582"><a href="#cb24-582" aria-hidden="true" tabindex="-1"></a><span class="co"># Function does these things:</span></span>
<span id="cb24-583"><a href="#cb24-583" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. grab data for one species</span></span>
<span id="cb24-584"><a href="#cb24-584" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Get starting points for VB using all data on that species</span></span>
<span id="cb24-585"><a href="#cb24-585" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fit Vonbert to  both Regimes</span></span>
<span id="cb24-586"><a href="#cb24-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-587"><a href="#cb24-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-588"><a href="#cb24-588" aria-hidden="true" tabindex="-1"></a>estimate_species_vbert <span class="ot">&lt;-</span> <span class="cf">function</span>(spec_name, split_col, min_obs){</span>
<span id="cb24-589"><a href="#cb24-589" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-590"><a href="#cb24-590" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the data using the species</span></span>
<span id="cb24-591"><a href="#cb24-591" aria-hidden="true" tabindex="-1"></a>  spec_dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(all_vonbert, comname <span class="sc">==</span> spec_name)</span>
<span id="cb24-592"><a href="#cb24-592" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-593"><a href="#cb24-593" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get starting points from all data</span></span>
<span id="cb24-594"><a href="#cb24-594" aria-hidden="true" tabindex="-1"></a>  test_starts <span class="ot">&lt;-</span>  <span class="fu">vbStarts</span>(length_cm <span class="sc">~</span> age, </span>
<span id="cb24-595"><a href="#cb24-595" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> spec_dat)</span>
<span id="cb24-596"><a href="#cb24-596" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-597"><a href="#cb24-597" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get coefficients for groups</span></span>
<span id="cb24-598"><a href="#cb24-598" aria-hidden="true" tabindex="-1"></a>  spec_dat <span class="sc">%&gt;%</span> </span>
<span id="cb24-599"><a href="#cb24-599" aria-hidden="true" tabindex="-1"></a>    <span class="fu">split</span>(.[split_col]) <span class="sc">%&gt;%</span> </span>
<span id="cb24-600"><a href="#cb24-600" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(<span class="at">.f =</span> vonbert_coef,</span>
<span id="cb24-601"><a href="#cb24-601" aria-hidden="true" tabindex="-1"></a>            <span class="at">start_points =</span> test_starts, </span>
<span id="cb24-602"><a href="#cb24-602" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_obs =</span> min_obs) <span class="sc">%&gt;%</span> </span>
<span id="cb24-603"><a href="#cb24-603" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_dfr</span>(pluck,<span class="st">"coef"</span>, <span class="at">.id =</span> split_col) <span class="sc">%&gt;%</span> </span>
<span id="cb24-604"><a href="#cb24-604" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">comname =</span> spec_name)</span>
<span id="cb24-605"><a href="#cb24-605" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-606"><a href="#cb24-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-607"><a href="#cb24-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-608"><a href="#cb24-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-609"><a href="#cb24-609" aria-hidden="true" tabindex="-1"></a>Once everything is prepped we can then fun the von Bert parameter estimation for all the species we are interested using the desired groups.</span>
<span id="cb24-610"><a href="#cb24-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-611"><a href="#cb24-611" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height = 6}</span></span>
<span id="cb24-612"><a href="#cb24-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-613"><a href="#cb24-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Running everything?</span></span>
<span id="cb24-614"><a href="#cb24-614" aria-hidden="true" tabindex="-1"></a><span class="co">#species_coef &lt;- key_species %&gt;% </span></span>
<span id="cb24-615"><a href="#cb24-615" aria-hidden="true" tabindex="-1"></a>species_coef <span class="ot">&lt;-</span> vonbert_species <span class="sc">%&gt;%</span> </span>
<span id="cb24-616"><a href="#cb24-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="cf">function</span>(x){</span>
<span id="cb24-617"><a href="#cb24-617" aria-hidden="true" tabindex="-1"></a>    <span class="fu">estimate_species_vbert</span>(</span>
<span id="cb24-618"><a href="#cb24-618" aria-hidden="true" tabindex="-1"></a>      <span class="at">spec_name =</span> x, </span>
<span id="cb24-619"><a href="#cb24-619" aria-hidden="true" tabindex="-1"></a>      <span class="at">split_col =</span>  <span class="st">"regime"</span>, </span>
<span id="cb24-620"><a href="#cb24-620" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_obs =</span> <span class="dv">30</span>)</span>
<span id="cb24-621"><a href="#cb24-621" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-622"><a href="#cb24-622" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb24-623"><a href="#cb24-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-624"><a href="#cb24-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-625"><a href="#cb24-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-626"><a href="#cb24-626" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate Coefficients from the bootstrapped confidence intervals</span></span>
<span id="cb24-627"><a href="#cb24-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-628"><a href="#cb24-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-629"><a href="#cb24-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-630"><a href="#cb24-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-631"><a href="#cb24-631" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting Everything</span></span>
<span id="cb24-632"><a href="#cb24-632" aria-hidden="true" tabindex="-1"></a>species_coef <span class="sc">%&gt;%</span></span>
<span id="cb24-633"><a href="#cb24-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"vbcoef"</span>, <span class="at">values_to =</span> <span class="st">"val"</span>, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"K"</span>, <span class="st">"Linf"</span>, <span class="st">"t0"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-634"><a href="#cb24-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(vbcoef <span class="sc">!=</span> <span class="st">"t0"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-635"><a href="#cb24-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> val, <span class="at">y =</span> <span class="fu">fct_rev</span>(comname), <span class="at">fill =</span> <span class="fu">fct_rev</span>(regime))) <span class="sc">+</span></span>
<span id="cb24-636"><a href="#cb24-636" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb24-637"><a href="#cb24-637" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>vbcoef, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb24-638"><a href="#cb24-638" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_gmri</span>(<span class="at">reverse =</span> T) <span class="sc">+</span></span>
<span id="cb24-639"><a href="#cb24-639" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient Estimate"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Temperature Regime:"</span>) <span class="sc">+</span></span>
<span id="cb24-640"><a href="#cb24-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb24-641"><a href="#cb24-641" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb24-642"><a href="#cb24-642" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"lines"</span>),</span>
<span id="cb24-643"><a href="#cb24-643" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">size =</span> <span class="dv">1</span>))</span>
<span id="cb24-644"><a href="#cb24-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-645"><a href="#cb24-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-646"><a href="#cb24-646" aria-hidden="true" tabindex="-1"></a><span class="fu"># Growth Curves</span></span>
<span id="cb24-647"><a href="#cb24-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-648"><a href="#cb24-648" aria-hidden="true" tabindex="-1"></a><span class="fu"># VB Fits to Data:</span></span>
<span id="cb24-649"><a href="#cb24-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-652"><a href="#cb24-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-653"><a href="#cb24-653" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the plot for each species</span></span>
<span id="cb24-654"><a href="#cb24-654" aria-hidden="true" tabindex="-1"></a>vb_fits_plot <span class="ot">=</span> <span class="cf">function</span>(spec_name){</span>
<span id="cb24-655"><a href="#cb24-655" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-656"><a href="#cb24-656" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The raw size/age data:</span></span>
<span id="cb24-657"><a href="#cb24-657" aria-hidden="true" tabindex="-1"></a>  t_dat <span class="ot">&lt;-</span> all_vonbert <span class="sc">%&gt;%</span> <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name)  </span>
<span id="cb24-658"><a href="#cb24-658" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-659"><a href="#cb24-659" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The group coefficients, augmented with x values across a range</span></span>
<span id="cb24-660"><a href="#cb24-660" aria-hidden="true" tabindex="-1"></a>  age_max <span class="ot">&lt;-</span> <span class="fu">max</span>(t_dat<span class="sc">$</span>age)</span>
<span id="cb24-661"><a href="#cb24-661" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> age_max, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb24-662"><a href="#cb24-662" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb24-663"><a href="#cb24-663" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name) <span class="sc">%&gt;%</span> </span>
<span id="cb24-664"><a href="#cb24-664" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(</span>
<span id="cb24-665"><a href="#cb24-665" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-666"><a href="#cb24-666" aria-hidden="true" tabindex="-1"></a>        <span class="at">regime =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime), <span class="fu">length</span>(x_range)),</span>
<span id="cb24-667"><a href="#cb24-667" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> <span class="fu">rep</span>(x_range, <span class="fu">length</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime)))),</span>
<span id="cb24-668"><a href="#cb24-668" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"regime"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-669"><a href="#cb24-669" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb24-670"><a href="#cb24-670" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the length at age</span></span>
<span id="cb24-671"><a href="#cb24-671" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_length =</span> Linf <span class="sc">*</span> (<span class="dv">1</span>  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> K <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb24-672"><a href="#cb24-672" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-673"><a href="#cb24-673" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-674"><a href="#cb24-674" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-675"><a href="#cb24-675" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make plot?</span></span>
<span id="cb24-676"><a href="#cb24-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(t_dat, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> length_cm)) <span class="sc">+</span></span>
<span id="cb24-677"><a href="#cb24-677" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb24-678"><a href="#cb24-678" aria-hidden="true" tabindex="-1"></a>    <span class="co">#facet_wrap(~regime, ncol = 1) +</span></span>
<span id="cb24-679"><a href="#cb24-679" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> t_coef,</span>
<span id="cb24-680"><a href="#cb24-680" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred_length, <span class="at">group =</span> regime, <span class="at">color =</span> regime), </span>
<span id="cb24-681"><a href="#cb24-681" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb24-682"><a href="#cb24-682" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, age_max, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb24-683"><a href="#cb24-683" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, age_max),</span>
<span id="cb24-684"><a href="#cb24-684" aria-hidden="true" tabindex="-1"></a>                       <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, .<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb24-685"><a href="#cb24-685" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gmri</span>() <span class="sc">+</span></span>
<span id="cb24-686"><a href="#cb24-686" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="at">data =</span> t_coef, </span>
<span id="cb24-687"><a href="#cb24-687" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred_length, <span class="at">label =</span> regime, <span class="at">color =</span> regime), </span>
<span id="cb24-688"><a href="#cb24-688" aria-hidden="true" tabindex="-1"></a>            <span class="at">method=</span> <span class="fu">list</span>(<span class="st">"last.qp"</span>, <span class="at">cex =</span> <span class="fl">0.65</span>, <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">15</span>),</span>
<span id="cb24-689"><a href="#cb24-689" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb24-690"><a href="#cb24-690" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb24-691"><a href="#cb24-691" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Length (cm)"</span>,</span>
<span id="cb24-692"><a href="#cb24-692" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> spec_name,</span>
<span id="cb24-693"><a href="#cb24-693" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Temperature Regime:"</span>,</span>
<span id="cb24-694"><a href="#cb24-694" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Length at Age Regimes"</span>)</span>
<span id="cb24-695"><a href="#cb24-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-696"><a href="#cb24-696" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-697"><a href="#cb24-697" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-698"><a href="#cb24-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-699"><a href="#cb24-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-700"><a href="#cb24-700" aria-hidden="true" tabindex="-1"></a>::: panelset</span>
<span id="cb24-701"><a href="#cb24-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results="asis", fig.height = 6}</span></span>
<span id="cb24-702"><a href="#cb24-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-703"><a href="#cb24-703" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the key species:</span></span>
<span id="cb24-704"><a href="#cb24-704" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(key_species, </span>
<span id="cb24-705"><a href="#cb24-705" aria-hidden="true" tabindex="-1"></a>     plot_panelset, </span>
<span id="cb24-706"><a href="#cb24-706" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot_fun =</span> vb_fits_plot)</span>
<span id="cb24-707"><a href="#cb24-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-708"><a href="#cb24-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-709"><a href="#cb24-709" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb24-710"><a href="#cb24-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-711"><a href="#cb24-711" aria-hidden="true" tabindex="-1"></a><span class="fu"># Shifts in Growth</span></span>
<span id="cb24-712"><a href="#cb24-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-713"><a href="#cb24-713" aria-hidden="true" tabindex="-1"></a>Goal is to find some way to show all of them together in one form:</span>
<span id="cb24-714"><a href="#cb24-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-717"><a href="#cb24-717" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-718"><a href="#cb24-718" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height = 8,</span></span>
<span id="cb24-719"><a href="#cb24-719" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width = 8</span></span>
<span id="cb24-720"><a href="#cb24-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-721"><a href="#cb24-721" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the first part from the previous plot:</span></span>
<span id="cb24-722"><a href="#cb24-722" aria-hidden="true" tabindex="-1"></a><span class="co"># takes each species</span></span>
<span id="cb24-723"><a href="#cb24-723" aria-hidden="true" tabindex="-1"></a><span class="co"># for age 0 - max_age, solve what the size would be based on vb fit</span></span>
<span id="cb24-724"><a href="#cb24-724" aria-hidden="true" tabindex="-1"></a>regime_curve_prep <span class="ot">&lt;-</span> <span class="cf">function</span>(spec_name){</span>
<span id="cb24-725"><a href="#cb24-725" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-726"><a href="#cb24-726" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The raw size/age data:</span></span>
<span id="cb24-727"><a href="#cb24-727" aria-hidden="true" tabindex="-1"></a>  t_dat <span class="ot">&lt;-</span> all_vonbert <span class="sc">%&gt;%</span> <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name)  </span>
<span id="cb24-728"><a href="#cb24-728" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-729"><a href="#cb24-729" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The group coefficients, augmented with x values across a range</span></span>
<span id="cb24-730"><a href="#cb24-730" aria-hidden="true" tabindex="-1"></a>  age_max <span class="ot">&lt;-</span> <span class="fu">max</span>(t_dat<span class="sc">$</span>age)</span>
<span id="cb24-731"><a href="#cb24-731" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> age_max, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb24-732"><a href="#cb24-732" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> species_coef <span class="sc">%&gt;%</span> </span>
<span id="cb24-733"><a href="#cb24-733" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(comname <span class="sc">==</span> spec_name) <span class="sc">%&gt;%</span> </span>
<span id="cb24-734"><a href="#cb24-734" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(</span>
<span id="cb24-735"><a href="#cb24-735" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-736"><a href="#cb24-736" aria-hidden="true" tabindex="-1"></a>        <span class="at">regime =</span> <span class="fu">rep</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime), <span class="fu">length</span>(x_range)),</span>
<span id="cb24-737"><a href="#cb24-737" aria-hidden="true" tabindex="-1"></a>        <span class="at">age =</span> <span class="fu">rep</span>(x_range, <span class="fu">length</span>(<span class="fu">unique</span>(t_dat<span class="sc">$</span>regime)))),</span>
<span id="cb24-738"><a href="#cb24-738" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"regime"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-739"><a href="#cb24-739" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb24-740"><a href="#cb24-740" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the length at age</span></span>
<span id="cb24-741"><a href="#cb24-741" aria-hidden="true" tabindex="-1"></a>      <span class="at">pred_length =</span> Linf <span class="sc">*</span> (<span class="dv">1</span>  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> K <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb24-742"><a href="#cb24-742" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-743"><a href="#cb24-743" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-744"><a href="#cb24-744" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot wider?</span></span>
<span id="cb24-745"><a href="#cb24-745" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Take the size at age from each regime and get the difference</span></span>
<span id="cb24-746"><a href="#cb24-746" aria-hidden="true" tabindex="-1"></a>  t_coef <span class="ot">&lt;-</span> t_coef <span class="sc">%&gt;%</span></span>
<span id="cb24-747"><a href="#cb24-747" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Linf, K, t0)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-748"><a href="#cb24-748" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"regime"</span>, <span class="at">values_from =</span> <span class="st">"pred_length"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-749"><a href="#cb24-749" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb24-750"><a href="#cb24-750" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_shift =</span> <span class="st">`</span><span class="at">Warm Regime</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>,</span>
<span id="cb24-751"><a href="#cb24-751" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_frac =</span> (growth_shift <span class="sc">/</span> <span class="st">`</span><span class="at">Early Regime</span><span class="st">`</span>),</span>
<span id="cb24-752"><a href="#cb24-752" aria-hidden="true" tabindex="-1"></a>      <span class="at">size_change  =</span> <span class="fu">ifelse</span>(growth_shift <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Increase"</span>, <span class="st">"Decrease"</span>)</span>
<span id="cb24-753"><a href="#cb24-753" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-754"><a href="#cb24-754" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-755"><a href="#cb24-755" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(t_coef)</span>
<span id="cb24-756"><a href="#cb24-756" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-757"><a href="#cb24-757" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-758"><a href="#cb24-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-759"><a href="#cb24-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-760"><a href="#cb24-760" aria-hidden="true" tabindex="-1"></a><span class="co"># Do it for all the species</span></span>
<span id="cb24-761"><a href="#cb24-761" aria-hidden="true" tabindex="-1"></a>regime_comparison <span class="ot">&lt;-</span> vonbert_species <span class="sc">%&gt;%</span> </span>
<span id="cb24-762"><a href="#cb24-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="at">.f =</span> regime_curve_prep, <span class="at">.id =</span> <span class="st">"comname"</span>) </span>
<span id="cb24-763"><a href="#cb24-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-764"><a href="#cb24-764" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot their growth curves</span></span>
<span id="cb24-765"><a href="#cb24-765" aria-hidden="true" tabindex="-1"></a>regime_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb24-766"><a href="#cb24-766" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(comname %in% key_species) %&gt;% </span></span>
<span id="cb24-767"><a href="#cb24-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> growth_frac)) <span class="sc">+</span></span>
<span id="cb24-768"><a href="#cb24-768" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb24-769"><a href="#cb24-769" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> comname), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"orange"</span>)<span class="sc">+</span></span>
<span id="cb24-770"><a href="#cb24-770" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb24-771"><a href="#cb24-771" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>comname, <span class="at">scales =</span> <span class="st">"free_x"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb24-772"><a href="#cb24-772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Shift in Length Moving to Warm Regime"</span>, </span>
<span id="cb24-773"><a href="#cb24-773" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Thermal Regime Impacts on Growth"</span>,</span>
<span id="cb24-774"><a href="#cb24-774" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Changes in Size at Age (Warm Regime - Historic Regime)"</span>) </span>
<span id="cb24-775"><a href="#cb24-775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-776"><a href="#cb24-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-779"><a href="#cb24-779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-780"><a href="#cb24-780" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval = FALSE</span></span>
<span id="cb24-781"><a href="#cb24-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-782"><a href="#cb24-782" aria-hidden="true" tabindex="-1"></a><span class="co"># Kathy requested the curve data.</span></span>
<span id="cb24-783"><a href="#cb24-783" aria-hidden="true" tabindex="-1"></a><span class="co"># Going to save both the coefficients and the fitted data for all species</span></span>
<span id="cb24-784"><a href="#cb24-784" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb24-785"><a href="#cb24-785" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(regime_comparison, <span class="fu">here</span>(<span class="st">"data/growth_results/growth_regime_fits.csv"</span>))</span>
<span id="cb24-786"><a href="#cb24-786" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(species_coef, <span class="fu">here</span>(<span class="st">"data/growth_results/growth_regime_coefs.csv"</span>))</span>
<span id="cb24-787"><a href="#cb24-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-788"><a href="#cb24-788" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-789"><a href="#cb24-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-792"><a href="#cb24-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-793"><a href="#cb24-793" aria-hidden="true" tabindex="-1"></a><span class="co"># Try horizons</span></span>
<span id="cb24-794"><a href="#cb24-794" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggHoriPlot)</span>
<span id="cb24-795"><a href="#cb24-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-796"><a href="#cb24-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-797"><a href="#cb24-797" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter outliers beyond 5th and 95th quantile</span></span>
<span id="cb24-798"><a href="#cb24-798" aria-hidden="true" tabindex="-1"></a>cutpoints <span class="ot">&lt;-</span> regime_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb24-799"><a href="#cb24-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-800"><a href="#cb24-800" aria-hidden="true" tabindex="-1"></a>    <span class="at">outlier =</span> <span class="fu">between</span>(</span>
<span id="cb24-801"><a href="#cb24-801" aria-hidden="true" tabindex="-1"></a>      growth_frac,</span>
<span id="cb24-802"><a href="#cb24-802" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(growth_frac, <span class="fl">0.05</span>, <span class="at">na.rm =</span> T)<span class="sc">-</span></span>
<span id="cb24-803"><a href="#cb24-803" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">IQR</span>(growth_frac, <span class="at">na.rm =</span> T),</span>
<span id="cb24-804"><a href="#cb24-804" aria-hidden="true" tabindex="-1"></a>      <span class="fu">quantile</span>(growth_frac, <span class="fl">0.95</span>, <span class="at">na.rm =</span> T)<span class="sc">+</span></span>
<span id="cb24-805"><a href="#cb24-805" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.5</span> <span class="sc">*</span> <span class="fu">IQR</span>(growth_frac, <span class="at">na.rm =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb24-806"><a href="#cb24-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outlier)</span>
<span id="cb24-807"><a href="#cb24-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-808"><a href="#cb24-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-809"><a href="#cb24-809" aria-hidden="true" tabindex="-1"></a><span class="co"># Set origin</span></span>
<span id="cb24-810"><a href="#cb24-810" aria-hidden="true" tabindex="-1"></a>ori <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-811"><a href="#cb24-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-812"><a href="#cb24-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-813"><a href="#cb24-813" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually pick cut points</span></span>
<span id="cb24-814"><a href="#cb24-814" aria-hidden="true" tabindex="-1"></a>sca <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">9</span>)</span>
<span id="cb24-815"><a href="#cb24-815" aria-hidden="true" tabindex="-1"></a>sca_bins <span class="ot">&lt;-</span> <span class="fu">str_c</span>(sca[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(sca)<span class="sc">-</span><span class="dv">1</span>)], <span class="st">" to "</span>, sca[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(sca)], <span class="st">"%"</span>)</span>
<span id="cb24-816"><a href="#cb24-816" aria-hidden="true" tabindex="-1"></a>sca_labels <span class="ot">&lt;-</span> <span class="fu">rev</span>(sca_bins)</span>
<span id="cb24-817"><a href="#cb24-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-818"><a href="#cb24-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-819"><a href="#cb24-819" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb24-820"><a href="#cb24-820" aria-hidden="true" tabindex="-1"></a>            <span class="fu">theme</span>(</span>
<span id="cb24-821"><a href="#cb24-821" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Titles</span></span>
<span id="cb24-822"><a href="#cb24-822" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb24-823"><a href="#cb24-823" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb24-824"><a href="#cb24-824" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>), <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb24-825"><a href="#cb24-825" aria-hidden="true" tabindex="-1"></a>              <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="st">"lines"</span>),</span>
<span id="cb24-826"><a href="#cb24-826" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb24-827"><a href="#cb24-827" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb24-828"><a href="#cb24-828" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Axes</span></span>
<span id="cb24-829"><a href="#cb24-829" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb24-830"><a href="#cb24-830" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.y =</span> <span class="fu">element_line</span>(), </span>
<span id="cb24-831"><a href="#cb24-831" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb24-832"><a href="#cb24-832" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), </span>
<span id="cb24-833"><a href="#cb24-833" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb24-834"><a href="#cb24-834" aria-hidden="true" tabindex="-1"></a>              <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb24-835"><a href="#cb24-835" aria-hidden="true" tabindex="-1"></a>              <span class="at">rect =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb24-836"><a href="#cb24-836" aria-hidden="true" tabindex="-1"></a>              <span class="co"># Facets</span></span>
<span id="cb24-837"><a href="#cb24-837" aria-hidden="true" tabindex="-1"></a>              <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb24-838"><a href="#cb24-838" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb24-839"><a href="#cb24-839" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb24-840"><a href="#cb24-840" aria-hidden="true" tabindex="-1"></a>              <span class="at">strip.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb24-841"><a href="#cb24-841" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb24-842"><a href="#cb24-842" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb24-843"><a href="#cb24-843" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb24-844"><a href="#cb24-844" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype=</span><span class="st">"solid"</span>)))</span>
<span id="cb24-845"><a href="#cb24-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-846"><a href="#cb24-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-847"><a href="#cb24-847" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot it all</span></span>
<span id="cb24-848"><a href="#cb24-848" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(regime_comparison, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> growth_frac)) <span class="sc">+</span></span>
<span id="cb24-849"><a href="#cb24-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_horizon</span>(</span>
<span id="cb24-850"><a href="#cb24-850" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(age, </span>
<span id="cb24-851"><a href="#cb24-851" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> growth_frac,</span>
<span id="cb24-852"><a href="#cb24-852" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> ..Cutpoints..), </span>
<span id="cb24-853"><a href="#cb24-853" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin =</span> ori, </span>
<span id="cb24-854"><a href="#cb24-854" aria-hidden="true" tabindex="-1"></a>    <span class="at">horizonscale =</span> sca) <span class="sc">+</span></span>
<span id="cb24-855"><a href="#cb24-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hcl</span>(<span class="at">palette =</span> <span class="st">'RdBu'</span>, <span class="at">reverse =</span> T, <span class="at">labels =</span> sca_labels) <span class="sc">+</span></span>
<span id="cb24-856"><a href="#cb24-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(comname<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb24-857"><a href="#cb24-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb24-858"><a href="#cb24-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))) <span class="sc">+</span></span>
<span id="cb24-859"><a href="#cb24-859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-860"><a href="#cb24-860" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Titles</span></span>
<span id="cb24-861"><a href="#cb24-861" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb24-862"><a href="#cb24-862" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb24-863"><a href="#cb24-863" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(</span>
<span id="cb24-864"><a href="#cb24-864" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>, </span>
<span id="cb24-865"><a href="#cb24-865" aria-hidden="true" tabindex="-1"></a>      <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">20</span>), </span>
<span id="cb24-866"><a href="#cb24-866" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"gray40"</span>),</span>
<span id="cb24-867"><a href="#cb24-867" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="st">"lines"</span>),</span>
<span id="cb24-868"><a href="#cb24-868" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb24-869"><a href="#cb24-869" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb24-870"><a href="#cb24-870" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Axes</span></span>
<span id="cb24-871"><a href="#cb24-871" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb24-872"><a href="#cb24-872" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb24-873"><a href="#cb24-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), </span>
<span id="cb24-874"><a href="#cb24-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb24-875"><a href="#cb24-875" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb24-876"><a href="#cb24-876" aria-hidden="true" tabindex="-1"></a>    <span class="at">rect =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb24-877"><a href="#cb24-877" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Facets</span></span>
<span id="cb24-878"><a href="#cb24-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb24-879"><a href="#cb24-879" aria-hidden="true" tabindex="-1"></a>                              <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb24-880"><a href="#cb24-880" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb24-881"><a href="#cb24-881" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(</span>
<span id="cb24-882"><a href="#cb24-882" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb24-883"><a href="#cb24-883" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"#00736D"</span>, </span>
<span id="cb24-884"><a href="#cb24-884" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span>, </span>
<span id="cb24-885"><a href="#cb24-885" aria-hidden="true" tabindex="-1"></a>      <span class="at">linetype=</span><span class="st">"solid"</span>),</span>
<span id="cb24-886"><a href="#cb24-886" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-887"><a href="#cb24-887" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.spacing.y=</span><span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="st">"lines"</span>),</span>
<span id="cb24-888"><a href="#cb24-888" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb24-889"><a href="#cb24-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-890"><a href="#cb24-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-891"><a href="#cb24-891" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-892"><a href="#cb24-892" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-893"><a href="#cb24-893" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"left"</span>)  <span class="sc">+</span></span>
<span id="cb24-894"><a href="#cb24-894" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Age'</span>, </span>
<span id="cb24-895"><a href="#cb24-895" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Change in Body Size at Age"</span>) <span class="sc">+</span></span>
<span id="cb24-896"><a href="#cb24-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>))</span>
<span id="cb24-897"><a href="#cb24-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-898"><a href="#cb24-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-899"><a href="#cb24-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-900"><a href="#cb24-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-901"><a href="#cb24-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-902"><a href="#cb24-902" aria-hidden="true" tabindex="-1"></a><span class="fu"># All Age Size Differences</span></span>
<span id="cb24-903"><a href="#cb24-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-906"><a href="#cb24-906" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb24-907"><a href="#cb24-907" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval = TRUE,</span></span>
<span id="cb24-908"><a href="#cb24-908" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height = 2</span></span>
<span id="cb24-909"><a href="#cb24-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-910"><a href="#cb24-910" aria-hidden="true" tabindex="-1"></a><span class="co"># Try geom_waffle to just count each species as an individual and show that they are growing to smaller sizes in new regime:</span></span>
<span id="cb24-911"><a href="#cb24-911" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggwaffle)</span>
<span id="cb24-912"><a href="#cb24-912" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">waffle_iron</span>(</span>
<span id="cb24-913"><a href="#cb24-913" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">filter</span>(regime_comparison, age <span class="sc">==</span> <span class="dv">5</span>), </span>
<span id="cb24-914"><a href="#cb24-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes_d</span>(<span class="at">group =</span> size_change), <span class="at">rows =</span> <span class="dv">2</span>), </span>
<span id="cb24-915"><a href="#cb24-915" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(x, y, <span class="at">fill =</span> <span class="fu">fct_rev</span>(group))) <span class="sc">+</span></span>
<span id="cb24-916"><a href="#cb24-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_waffle</span>() <span class="sc">+</span></span>
<span id="cb24-917"><a href="#cb24-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_waffle</span>() <span class="sc">+</span></span>
<span id="cb24-918"><a href="#cb24-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gmri</span>() <span class="sc">+</span></span>
<span id="cb24-919"><a href="#cb24-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-920"><a href="#cb24-920" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-921"><a href="#cb24-921" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-922"><a href="#cb24-922" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb24-923"><a href="#cb24-923" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb24-924"><a href="#cb24-924" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb24-925"><a href="#cb24-925" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Warm Regime Impact on Age 5 Body Length:"</span>)</span>
<span id="cb24-926"><a href="#cb24-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-927"><a href="#cb24-927" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb24-928"><a href="#cb24-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-929"><a href="#cb24-929" aria-hidden="true" tabindex="-1"></a><span class="fu"># Average Body Sizes</span></span>
<span id="cb24-930"><a href="#cb24-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-931"><a href="#cb24-931" aria-hidden="true" tabindex="-1"></a><span class="in">`r insert_gmri_footer()`</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>